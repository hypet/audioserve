var app=function(){"use strict";function noop(){}function assign(e,t){for(const n in t)e[n]=t[n];return e}function run(e){return e()}function blank_object(){return Object.create(null)}function run_all(e){e.forEach(run)}function is_function(e){return"function"==typeof e}function safe_not_equal(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function is_empty(e){return 0===Object.keys(e).length}function subscribe(e,...t){if(null==e)return noop;const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function get_store_value(e){let t;return subscribe(e,(e=>t=e))(),t}function component_subscribe(e,t,n){e.$$.on_destroy.push(subscribe(t,n))}function create_slot(e,t,n,r){if(e){const o=get_slot_context(e,t,n,r);return e[0](o)}}function get_slot_context(e,t,n,r){return e[1]&&r?assign(n.ctx.slice(),e[1](r(t))):n.ctx}function get_slot_changes(e,t,n,r){if(e[2]&&r){const o=e[2](r(n));if(void 0===t.dirty)return o;if("object"==typeof o){const e=[],n=Math.max(t.dirty.length,o.length);for(let r=0;r<n;r+=1)e[r]=t.dirty[r]|o[r];return e}return t.dirty|o}return t.dirty}function update_slot_base(e,t,n,r,o,a){if(o){const i=get_slot_context(t,n,r,a);e.p(i,o)}}function get_all_dirty_from_scope(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let e=0;e<n;e++)t[e]=-1;return t}return-1}function set_store_value(e,t,n){return e.set(n),t}function action_destroyer(e){return e&&is_function(e.destroy)?e.destroy:noop}const is_client="undefined"!=typeof window;let raf=is_client?e=>requestAnimationFrame(e):noop,current_component;function append(e,t){e.appendChild(t)}function insert(e,t,n){e.insertBefore(t,n||null)}function detach(e){e.parentNode.removeChild(e)}function destroy_each(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function element(e){return document.createElement(e)}function svg_element(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function text(e){return document.createTextNode(e)}function space(){return text(" ")}function empty(){return text("")}function listen(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function prevent_default(e){return function(t){return t.preventDefault(),e.call(this,t)}}function stop_propagation(e){return function(t){return t.stopPropagation(),e.call(this,t)}}function attr(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function to_number(e){return""===e?null:+e}function children(e){return Array.from(e.childNodes)}function set_data(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function set_input_value(e,t){e.value=null==t?"":t}function set_style(e,t,n,r){null===n?e.style.removeProperty(t):e.style.setProperty(t,n,r?"important":"")}function select_option(e,t){for(let n=0;n<e.options.length;n+=1){const r=e.options[n];if(r.__value===t)return void(r.selected=!0)}e.selectedIndex=-1}function select_value(e){const t=e.querySelector(":checked")||e.options[0];return t&&t.__value}function toggle_class(e,t,n){e.classList[n?"add":"remove"](t)}function custom_event(e,t,{bubbles:n=!1,cancelable:r=!1}={}){const o=document.createEvent("CustomEvent");return o.initCustomEvent(e,n,r,t),o}function set_current_component(e){current_component=e}function get_current_component(){if(!current_component)throw new Error("Function called outside component initialization");return current_component}function beforeUpdate(e){get_current_component().$$.before_update.push(e)}function onMount(e){get_current_component().$$.on_mount.push(e)}function onDestroy(e){get_current_component().$$.on_destroy.push(e)}function createEventDispatcher(){const e=get_current_component();return(t,n,{cancelable:r=!1}={})=>{const o=e.$$.callbacks[t];if(o){const a=custom_event(t,n,{cancelable:r});return o.slice().forEach((t=>{t.call(e,a)})),!a.defaultPrevented}return!0}}function setContext(e,t){return get_current_component().$$.context.set(e,t),t}function getContext(e){return get_current_component().$$.context.get(e)}const dirty_components=[],binding_callbacks=[],render_callbacks=[],flush_callbacks=[],resolved_promise=Promise.resolve();let update_scheduled=!1;function schedule_update(){update_scheduled||(update_scheduled=!0,resolved_promise.then(flush))}function add_render_callback(e){render_callbacks.push(e)}const seen_callbacks=new Set;let flushidx=0;function flush(){const e=current_component;do{for(;flushidx<dirty_components.length;){const e=dirty_components[flushidx];flushidx++,set_current_component(e),update(e.$$)}for(set_current_component(null),dirty_components.length=0,flushidx=0;binding_callbacks.length;)binding_callbacks.pop()();for(let e=0;e<render_callbacks.length;e+=1){const t=render_callbacks[e];seen_callbacks.has(t)||(seen_callbacks.add(t),t())}render_callbacks.length=0}while(dirty_components.length);for(;flush_callbacks.length;)flush_callbacks.pop()();update_scheduled=!1,seen_callbacks.clear(),set_current_component(e)}function update(e){if(null!==e.fragment){e.update(),run_all(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(add_render_callback)}}const outroing=new Set;let outros;function group_outros(){outros={r:0,c:[],p:outros}}function check_outros(){outros.r||run_all(outros.c),outros=outros.p}function transition_in(e,t){e&&e.i&&(outroing.delete(e),e.i(t))}function transition_out(e,t,n,r){if(e&&e.o){if(outroing.has(e))return;outroing.add(e),outros.c.push((()=>{outroing.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}else r&&r()}const globals="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function create_component(e){e&&e.c()}function mount_component(e,t,n,r){const{fragment:o,on_mount:a,on_destroy:i,after_update:s}=e.$$;o&&o.m(t,n),r||add_render_callback((()=>{const t=a.map(run).filter(is_function);i?i.push(...t):run_all(t),e.$$.on_mount=[]})),s.forEach(add_render_callback)}function destroy_component(e,t){const n=e.$$;null!==n.fragment&&(run_all(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function make_dirty(e,t){-1===e.$$.dirty[0]&&(dirty_components.push(e),schedule_update(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function init(e,t,n,r,o,a,i,s=[-1]){const l=current_component;set_current_component(e);const c=e.$$={fragment:null,ctx:null,props:a,update:noop,not_equal:o,bound:blank_object(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:blank_object(),dirty:s,skip_bound:!1,root:t.target||l.$$.root};i&&i(c.root);let u=!1;if(c.ctx=n?n(e,t.props||{},((t,n,...r)=>{const a=r.length?r[0]:n;return c.ctx&&o(c.ctx[t],c.ctx[t]=a)&&(!c.skip_bound&&c.bound[t]&&c.bound[t](a),u&&make_dirty(e,t)),n})):[],c.update(),u=!0,run_all(c.before_update),c.fragment=!!r&&r(c.ctx),t.target){if(t.hydrate){const e=children(t.target);c.fragment&&c.fragment.l(e),e.forEach(detach)}else c.fragment&&c.fragment.c();t.intro&&transition_in(e.$$.fragment),mount_component(e,t.target,t.anchor,t.customElement),flush()}set_current_component(l)}class SvelteComponent{$destroy(){destroy_component(this,1),this.$destroy=noop}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){this.$$set&&!is_empty(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const subscriber_queue=[];function readable(e,t){return{subscribe:writable(e,t).subscribe}}function writable(e,t=noop){let n;const r=new Set;function o(t){if(safe_not_equal(e,t)&&(e=t,n)){const t=!subscriber_queue.length;for(const t of r)t[1](),subscriber_queue.push(t,e);if(t){for(let e=0;e<subscriber_queue.length;e+=2)subscriber_queue[e][0](subscriber_queue[e+1]);subscriber_queue.length=0}}}return{set:o,update:function(t){o(t(e))},subscribe:function(a,i=noop){const s=[a,i];return r.add(s),1===r.size&&(n=t(o)||noop),a(e),()=>{r.delete(s),0===r.size&&(n(),n=null)}}}}function derived(e,t,n){const r=!Array.isArray(e),o=r?[e]:e,a=t.length<2;return readable(n,(e=>{let n=!1;const i=[];let s=0,l=noop;const c=()=>{if(s)return;l();const n=t(r?i[0]:i,e);a?e(n):l=is_function(n)?n:noop},u=o.map(((e,t)=>subscribe(e,(e=>{i[t]=e,s&=~(1<<t),n&&c()}),(()=>{s|=1<<t}))));return n=!0,c(),function(){run_all(u),l()}}))}const defaultConfig={maxParallelDownload:1,cacheAheadFiles:3,cacheAheadDelay:15,transcodingTolerance:.15,positionReportingPeriod:10,sleepTimerPeriod:30,sleepTimerExtend:15,jumpBackTime:15,jumpForwardTime:10,transcodingJumpLimit:300,autorewind:!1,recentDays:365,alwaysTranscode:""},BASE_PATH="https://audioserve.zderadicka.eu".replace(/\/+$/,""),isBlob=e=>"undefined"!=typeof Blob&&e instanceof Blob;class BaseAPI{constructor(e=new Configuration){this.configuration=e,this.fetchApi=async(e,t)=>{let n={url:e,init:t};for(const e of this.middleware)e.pre&&(n=await e.pre(Object.assign({fetch:this.fetchApi},n))||n);let r=await(this.configuration.fetchApi||fetch)(n.url,n.init);for(const e of this.middleware)e.post&&(r=await e.post({fetch:this.fetchApi,url:n.url,init:n.init,response:r.clone()})||r);return r},this.middleware=e.middleware}withMiddleware(...e){const t=this.clone();return t.middleware=t.middleware.concat(...e),t}withPreMiddleware(...e){const t=e.map((e=>({pre:e})));return this.withMiddleware(...t)}withPostMiddleware(...e){const t=e.map((e=>({post:e})));return this.withMiddleware(...t)}async request(e,t){const{url:n,init:r}=this.createFetchParams(e,t),o=await this.fetchApi(n,r);if(o.status>=200&&o.status<300)return o;throw o}createFetchParams(e,t){let n=this.configuration.basePath+e.path;void 0!==e.query&&0!==Object.keys(e.query).length&&(n+="?"+this.configuration.queryParamsStringify(e.query));const r="undefined"!=typeof FormData&&e.body instanceof FormData||e.body instanceof URLSearchParams||isBlob(e.body)?e.body:JSON.stringify(e.body),o=Object.assign({},this.configuration.headers,e.headers);return{url:n,init:Object.assign({method:e.method,headers:o,body:r,credentials:this.configuration.credentials},t)}}clone(){const e=new(0,this.constructor)(this.configuration);return e.middleware=this.middleware.slice(),e}}class RequiredError extends Error{constructor(e,t){super(t),this.field=e,this.name="RequiredError"}}class Configuration{constructor(e={}){this.configuration=e}get basePath(){return null!=this.configuration.basePath?this.configuration.basePath:BASE_PATH}get fetchApi(){return this.configuration.fetchApi}get middleware(){return this.configuration.middleware||[]}get queryParamsStringify(){return this.configuration.queryParamsStringify||querystring}get username(){return this.configuration.username}get password(){return this.configuration.password}get apiKey(){const e=this.configuration.apiKey;if(e)return"function"==typeof e?e:()=>e}get accessToken(){const e=this.configuration.accessToken;if(e)return"function"==typeof e?e:async()=>e}get headers(){return this.configuration.headers}get credentials(){return this.configuration.credentials}}function exists(e,t){const n=e[t];return null!=n}function querystring(e,t=""){return Object.keys(e).map((n=>{const r=t+(t.length?`[${n}]`:n),o=e[n];if(o instanceof Array){const e=o.map((e=>encodeURIComponent(String(e)))).join(`&${encodeURIComponent(r)}=`);return`${encodeURIComponent(r)}=${e}`}return o instanceof Date?`${encodeURIComponent(r)}=${encodeURIComponent(o.toISOString())}`:o instanceof Object?querystring(o,r):`${encodeURIComponent(r)}=${encodeURIComponent(String(o))}`})).filter((e=>e.length>0)).join("&")}function canConsumeForm(e){for(const t of e)if("multipart/form-data"===t.contentType)return!0;return!1}class JSONApiResponse{constructor(e,t=(e=>e)){this.raw=e,this.transformer=t}async value(){return this.transformer(await this.raw.json())}}class VoidApiResponse{constructor(e){this.raw=e}async value(){}}class BlobApiResponse{constructor(e){this.raw=e}async value(){return await this.raw.blob()}}class TextApiResponse{constructor(e){this.raw=e}async value(){return await this.raw.text()}}class AuthenticationApi extends BaseAPI{async authenticatePostRaw(e,t){if(null===e.secret||void 0===e.secret)throw new RequiredError("secret","Required parameter requestParameters.secret was null or undefined when calling authenticatePost.");let n;canConsumeForm([{contentType:"application/x-www-form-urlencoded"},{contentType:"application/json"}]),n=new URLSearchParams,void 0!==e.secret&&n.append("secret",e.secret);const r=await this.request({path:"/authenticate",method:"POST",headers:{},query:{},body:n},t);return new TextApiResponse(r)}async authenticatePost(e,t){const n=await this.authenticatePostRaw(e,t);return await n.value()}}function AudioFileMetaFromJSON(e){return AudioFileMetaFromJSONTyped(e)}function AudioFileMetaFromJSONTyped(e,t){return null==e?e:{duration:exists(e,"duration")?e.duration:void 0,bitrate:exists(e,"bitrate")?e.bitrate:void 0,tags:exists(e,"tags")?e.tags:void 0}}function AudioFileSectionFromJSON(e){return AudioFileSectionFromJSONTyped(e)}function AudioFileSectionFromJSONTyped(e,t){return null==e?e:{start:exists(e,"start")?e.start:void 0,duration:exists(e,"duration")?e.duration:void 0}}function AudioFileFromJSON(e){return AudioFileFromJSONTyped(e)}function AudioFileFromJSONTyped(e,t){return null==e?e:{name:e.name,path:e.path,meta:exists(e,"meta")?AudioFileMetaFromJSON(e.meta):void 0,mime:e.mime,section:exists(e,"section")?AudioFileSectionFromJSON(e.section):void 0}}function PositionShortFromJSON(e){return PositionShortFromJSONTyped(e)}function PositionShortFromJSONTyped(e,t){return null==e?e:{timestamp:e.timestamp,path:e.path,position:e.position}}function SubfolderFromJSON(e){return SubfolderFromJSONTyped(e)}function SubfolderFromJSONTyped(e,t){return null==e?e:{name:e.name,path:e.path,isFile:exists(e,"is_file")?e.is_file:void 0,modified:exists(e,"modified")?e.modified:void 0,finished:exists(e,"finished")?e.finished:void 0}}function TypedFileFromJSON(e){return TypedFileFromJSONTyped(e)}function TypedFileFromJSONTyped(e,t){return null==e?e:{path:e.path,mime:e.mime}}function AudioFolderFromJSON(e){return AudioFolderFromJSONTyped(e)}function AudioFolderFromJSONTyped(e,t){return null==e?e:{isFile:exists(e,"is_file")?e.is_file:void 0,isCollapsed:exists(e,"is_collapsed")?e.is_collapsed:void 0,modified:exists(e,"modified")?e.modified:void 0,totalTime:exists(e,"total_time")?e.total_time:void 0,subfolders:exists(e,"subfolders")?e.subfolders.map(SubfolderFromJSON):void 0,files:exists(e,"files")?e.files.map(AudioFileFromJSON):void 0,cover:exists(e,"cover")?TypedFileFromJSON(e.cover):void 0,description:exists(e,"description")?TypedFileFromJSON(e.description):void 0,tags:exists(e,"tags")?e.tags:void 0,position:exists(e,"position")?PositionShortFromJSON(e.position):void 0}}function CollectionsInfoFromJSON(e){return CollectionsInfoFromJSONTyped(e)}function CollectionsInfoFromJSONTyped(e,t){return null==e?e:{names:exists(e,"names")?e.names:void 0,count:exists(e,"count")?e.count:void 0,folderDownload:exists(e,"folder_download")?e.folder_download:void 0,sharedPositions:exists(e,"shared_positions")?e.shared_positions:void 0,version:exists(e,"version")?e.version:void 0}}function PositionFromJSON(e){return PositionFromJSONTyped(e)}function PositionFromJSONTyped(e,t){return null==e?e:{timestamp:e.timestamp,collection:e.collection,folder:e.folder,file:e.file,folderFinished:exists(e,"folder_finished")?e.folder_finished:void 0,position:e.position}}function PositionToJSON(e){if(void 0!==e)return null===e?null:{timestamp:e.timestamp,collection:e.collection,folder:e.folder,file:e.file,folder_finished:e.folderFinished,position:e.position}}function SearchResultFromJSON(e){return SearchResultFromJSONTyped(e)}function SearchResultFromJSONTyped(e,t){return null==e?e:{files:exists(e,"files")?e.files.map(AudioFileFromJSON):void 0,subfolders:exists(e,"subfolders")?e.subfolders.map(SubfolderFromJSON):void 0}}class CollectionsApi extends BaseAPI{async colIdAudioPathGetRaw(e,t){if(null===e.colId||void 0===e.colId)throw new RequiredError("colId","Required parameter requestParameters.colId was null or undefined when calling colIdAudioPathGet.");if(null===e.path||void 0===e.path)throw new RequiredError("path","Required parameter requestParameters.path was null or undefined when calling colIdAudioPathGet.");const n={};void 0!==e.seek&&(n.seek=e.seek),void 0!==e.trans&&(n.trans=e.trans);const r={};if(void 0!==e.range&&null!==e.range&&(r.range=String(e.range)),this.configuration&&this.configuration.accessToken){const e=this.configuration.accessToken,t=await e("bearerAuth",[]);t&&(r.Authorization=`Bearer ${t}`)}const o=await this.request({path:"/{col_id}/audio/{path}".replace("{col_id}",encodeURIComponent(String(e.colId))).replace("{path}",encodeURIComponent(String(e.path))),method:"GET",headers:r,query:n},t);return new BlobApiResponse(o)}async colIdAudioPathGet(e,t){const n=await this.colIdAudioPathGetRaw(e,t);return await n.value()}async colIdCoverPathGetRaw(e,t){if(null===e.colId||void 0===e.colId)throw new RequiredError("colId","Required parameter requestParameters.colId was null or undefined when calling colIdCoverPathGet.");if(null===e.path||void 0===e.path)throw new RequiredError("path","Required parameter requestParameters.path was null or undefined when calling colIdCoverPathGet.");const n={};if(this.configuration&&this.configuration.accessToken){const e=this.configuration.accessToken,t=await e("bearerAuth",[]);t&&(n.Authorization=`Bearer ${t}`)}const r=await this.request({path:"/{col_id}/cover/{path}".replace("{col_id}",encodeURIComponent(String(e.colId))).replace("{path}",encodeURIComponent(String(e.path))),method:"GET",headers:n,query:{}},t);return new BlobApiResponse(r)}async colIdCoverPathGet(e,t){const n=await this.colIdCoverPathGetRaw(e,t);return await n.value()}async colIdDescPathGetRaw(e,t){if(null===e.colId||void 0===e.colId)throw new RequiredError("colId","Required parameter requestParameters.colId was null or undefined when calling colIdDescPathGet.");if(null===e.path||void 0===e.path)throw new RequiredError("path","Required parameter requestParameters.path was null or undefined when calling colIdDescPathGet.");const n={};if(this.configuration&&this.configuration.accessToken){const e=this.configuration.accessToken,t=await e("bearerAuth",[]);t&&(n.Authorization=`Bearer ${t}`)}const r=await this.request({path:"/{col_id}/desc/{path}".replace("{col_id}",encodeURIComponent(String(e.colId))).replace("{path}",encodeURIComponent(String(e.path))),method:"GET",headers:n,query:{}},t);return new TextApiResponse(r)}async colIdDescPathGet(e,t){const n=await this.colIdDescPathGetRaw(e,t);return await n.value()}async colIdDownloadPathGetRaw(e,t){if(null===e.colId||void 0===e.colId)throw new RequiredError("colId","Required parameter requestParameters.colId was null or undefined when calling colIdDownloadPathGet.");if(null===e.path||void 0===e.path)throw new RequiredError("path","Required parameter requestParameters.path was null or undefined when calling colIdDownloadPathGet.");const n={};void 0!==e.fmt&&(n.fmt=e.fmt);const r={};if(this.configuration&&this.configuration.accessToken){const e=this.configuration.accessToken,t=await e("bearerAuth",[]);t&&(r.Authorization=`Bearer ${t}`)}const o=await this.request({path:"/{col_id}/download/{path}".replace("{col_id}",encodeURIComponent(String(e.colId))).replace("{path}",encodeURIComponent(String(e.path))),method:"GET",headers:r,query:n},t);return new BlobApiResponse(o)}async colIdDownloadPathGet(e,t){const n=await this.colIdDownloadPathGetRaw(e,t);return await n.value()}async colIdFolderGetRaw(e,t){if(null===e.colId||void 0===e.colId)throw new RequiredError("colId","Required parameter requestParameters.colId was null or undefined when calling colIdFolderGet.");const n={};void 0!==e.ord&&(n.ord=e.ord),void 0!==e.group&&(n.group=e.group);const r={};if(this.configuration&&this.configuration.accessToken){const e=this.configuration.accessToken,t=await e("bearerAuth",[]);t&&(r.Authorization=`Bearer ${t}`)}const o=await this.request({path:"/{col_id}/folder/".replace("{col_id}",encodeURIComponent(String(e.colId))),method:"GET",headers:r,query:n},t);return new JSONApiResponse(o,(e=>AudioFolderFromJSON(e)))}async colIdFolderGet(e,t){const n=await this.colIdFolderGetRaw(e,t);return await n.value()}async colIdFolderPathGetRaw(e,t){if(null===e.colId||void 0===e.colId)throw new RequiredError("colId","Required parameter requestParameters.colId was null or undefined when calling colIdFolderPathGet.");if(null===e.path||void 0===e.path)throw new RequiredError("path","Required parameter requestParameters.path was null or undefined when calling colIdFolderPathGet.");const n={};void 0!==e.ord&&(n.ord=e.ord),void 0!==e.group&&(n.group=e.group);const r={};if(this.configuration&&this.configuration.accessToken){const e=this.configuration.accessToken,t=await e("bearerAuth",[]);t&&(r.Authorization=`Bearer ${t}`)}const o=await this.request({path:"/{col_id}/folder/{path}".replace("{col_id}",encodeURIComponent(String(e.colId))).replace("{path}",encodeURIComponent(String(e.path))),method:"GET",headers:r,query:n},t);return new JSONApiResponse(o,(e=>AudioFolderFromJSON(e)))}async colIdFolderPathGet(e,t){const n=await this.colIdFolderPathGetRaw(e,t);return await n.value()}async colIdRecentGetRaw(e,t){if(null===e.colId||void 0===e.colId)throw new RequiredError("colId","Required parameter requestParameters.colId was null or undefined when calling colIdRecentGet.");const n={};void 0!==e.group&&(n.group=e.group);const r={};if(this.configuration&&this.configuration.accessToken){const e=this.configuration.accessToken,t=await e("bearerAuth",[]);t&&(r.Authorization=`Bearer ${t}`)}const o=await this.request({path:"/{col_id}/recent".replace("{col_id}",encodeURIComponent(String(e.colId))),method:"GET",headers:r,query:n},t);return new JSONApiResponse(o,(e=>SearchResultFromJSON(e)))}async colIdRecentGet(e,t){const n=await this.colIdRecentGetRaw(e,t);return await n.value()}async colIdSearchGetRaw(e,t){if(null===e.colId||void 0===e.colId)throw new RequiredError("colId","Required parameter requestParameters.colId was null or undefined when calling colIdSearchGet.");if(null===e.q||void 0===e.q)throw new RequiredError("q","Required parameter requestParameters.q was null or undefined when calling colIdSearchGet.");const n={};void 0!==e.ord&&(n.ord=e.ord),void 0!==e.group&&(n.group=e.group),void 0!==e.q&&(n.q=e.q);const r={};if(this.configuration&&this.configuration.accessToken){const e=this.configuration.accessToken,t=await e("bearerAuth",[]);t&&(r.Authorization=`Bearer ${t}`)}const o=await this.request({path:"/{col_id}/search".replace("{col_id}",encodeURIComponent(String(e.colId))),method:"GET",headers:r,query:n},t);return new JSONApiResponse(o,(e=>SearchResultFromJSON(e)))}async colIdSearchGet(e,t){const n=await this.colIdSearchGetRaw(e,t);return await n.value()}async collectionsGetRaw(e){const t={};if(this.configuration&&this.configuration.accessToken){const e=this.configuration.accessToken,n=await e("bearerAuth",[]);n&&(t.Authorization=`Bearer ${n}`)}const n=await this.request({path:"/collections/",method:"GET",headers:t,query:{}},e);return new JSONApiResponse(n,(e=>CollectionsInfoFromJSON(e)))}async collectionsGet(e){const t=await this.collectionsGetRaw(e);return await t.value()}}var ColIdAudioPathGetTransEnum,ColIdDownloadPathGetFmtEnum,ColIdFolderGetOrdEnum,ColIdFolderPathGetOrdEnum,ColIdSearchGetOrdEnum,StorageKeys,FolderType,NavigateTarget,TranscodingCode;!function(e){e.L="l",e.M="m",e.H="h",e._0="0"}(ColIdAudioPathGetTransEnum||(ColIdAudioPathGetTransEnum={})),function(e){e.Zip="zip",e.Tar="tar"}(ColIdDownloadPathGetFmtEnum||(ColIdDownloadPathGetFmtEnum={})),function(e){e.A="a",e.M="m"}(ColIdFolderGetOrdEnum||(ColIdFolderGetOrdEnum={})),function(e){e.A="a",e.M="m"}(ColIdFolderPathGetOrdEnum||(ColIdFolderPathGetOrdEnum={})),function(e){e.A="a",e.M="m"}(ColIdSearchGetOrdEnum||(ColIdSearchGetOrdEnum={}));class PositionsApi extends BaseAPI{async positionsGroupColIdPathGetRaw(e,t){if(null===e.group||void 0===e.group)throw new RequiredError("group","Required parameter requestParameters.group was null or undefined when calling positionsGroupColIdPathGet.");if(null===e.colId||void 0===e.colId)throw new RequiredError("colId","Required parameter requestParameters.colId was null or undefined when calling positionsGroupColIdPathGet.");if(null===e.path||void 0===e.path)throw new RequiredError("path","Required parameter requestParameters.path was null or undefined when calling positionsGroupColIdPathGet.");const n={};void 0!==e.finished&&(n.finished=e.finished),void 0!==e.unfinished&&(n.unfinished=e.unfinished),void 0!==e.from&&(n.from=e.from),void 0!==e.to&&(n.to=e.to),void 0!==e.rec&&(n.rec=e.rec);const r={};if(this.configuration&&this.configuration.accessToken){const e=this.configuration.accessToken,t=await e("bearerAuth",[]);t&&(r.Authorization=`Bearer ${t}`)}const o=await this.request({path:"/positions/{group}/{col_id}/{path}".replace("{group}",encodeURIComponent(String(e.group))).replace("{col_id}",encodeURIComponent(String(e.colId))).replace("{path}",encodeURIComponent(String(e.path))),method:"GET",headers:r,query:n},t);return new JSONApiResponse(o,(e=>PositionFromJSON(e)))}async positionsGroupColIdPathGet(e,t){const n=await this.positionsGroupColIdPathGetRaw(e,t);return await n.value()}async positionsGroupGetRaw(e,t){if(null===e.group||void 0===e.group)throw new RequiredError("group","Required parameter requestParameters.group was null or undefined when calling positionsGroupGet.");const n={};void 0!==e.finished&&(n.finished=e.finished),void 0!==e.unfinished&&(n.unfinished=e.unfinished),void 0!==e.from&&(n.from=e.from),void 0!==e.to&&(n.to=e.to);const r={};if(this.configuration&&this.configuration.accessToken){const e=this.configuration.accessToken,t=await e("bearerAuth",[]);t&&(r.Authorization=`Bearer ${t}`)}const o=await this.request({path:"/positions/{group}".replace("{group}",encodeURIComponent(String(e.group))),method:"GET",headers:r,query:n},t);return new JSONApiResponse(o,(e=>e.map(PositionFromJSON)))}async positionsGroupGet(e,t){const n=await this.positionsGroupGetRaw(e,t);return await n.value()}async positionsGroupLastGetRaw(e,t){if(null===e.group||void 0===e.group)throw new RequiredError("group","Required parameter requestParameters.group was null or undefined when calling positionsGroupLastGet.");const n={};if(this.configuration&&this.configuration.accessToken){const e=this.configuration.accessToken,t=await e("bearerAuth",[]);t&&(n.Authorization=`Bearer ${t}`)}const r=await this.request({path:"/positions/{group}/last".replace("{group}",encodeURIComponent(String(e.group))),method:"GET",headers:n,query:{}},t);return new JSONApiResponse(r,(e=>PositionFromJSON(e)))}async positionsGroupLastGet(e,t){const n=await this.positionsGroupLastGetRaw(e,t);return await n.value()}async positionsGroupPostRaw(e,t){if(null===e.group||void 0===e.group)throw new RequiredError("group","Required parameter requestParameters.group was null or undefined when calling positionsGroupPost.");if(null===e.position||void 0===e.position)throw new RequiredError("position","Required parameter requestParameters.position was null or undefined when calling positionsGroupPost.");const n={"Content-Type":"application/json"};if(this.configuration&&this.configuration.accessToken){const e=this.configuration.accessToken,t=await e("bearerAuth",[]);t&&(n.Authorization=`Bearer ${t}`)}const r=await this.request({path:"/positions/{group}".replace("{group}",encodeURIComponent(String(e.group))),method:"POST",headers:n,query:{},body:PositionToJSON(e.position)},t);return new VoidApiResponse(r)}async positionsGroupPost(e,t){await this.positionsGroupPostRaw(e,t)}}!function(e){e.LAST_FOLDER="AUDIOSERVE_LAST_FOLDER",e.LAST_COLLECTION="AUDIOSERVE_LAST_COLLECTION",e.LAST_FILE="AUDIOSERVE_LAST_FILE",e.LAST_POSITION="AUDIOSERVE_LAST_POSITION",e.LAST_PAUSE="AUDIOSERVE_LAST_PAUSE",e.THEME="AUDIOSERVE_THEME",e.TRANSCODING="AUDIOSERVE_TRANSCODING",e.GROUP="AUDIOSERVE_GROUP",e.PREFERENCES="AUDIOSERVE_PREFERENCES",e.PLAYBACK_SPEED="AUDIOSERVE_PLAYBACK_SPEED",e.PLAYBACK_VOLUME="AUDIOSERVE_PLAYBACK_VOLUME"}(StorageKeys||(StorageKeys={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.SEARCH=1]="SEARCH",e[e.RECENT=2]="RECENT"}(FolderType||(FolderType={})),function(e){e[e.PLAYLIST_FOLDER=0]="PLAYLIST_FOLDER",e[e.PLAY_ITEM=1]="PLAY_ITEM"}(NavigateTarget||(NavigateTarget={})),function(e){e.Low="l",e.Medium="m",e.High="h",e.None="0"}(TranscodingCode||(TranscodingCode={}));const reverseTranscoding=new Map;Object.keys(TranscodingCode).forEach((e=>reverseTranscoding.set(TranscodingCode[e],e)));const transcodingNameToCode=e=>TranscodingCode[e],transcodingCodeToName=e=>reverseTranscoding.get(e);var WSMessageInType,WSMessageOutType;function otherTheme(){return"light"===(localStorage.getItem(StorageKeys.THEME)||"light")?"dark":"light"}function getLocationPath(){let e=location.pathname;return e=e.replace(/index.html$/,""),e.replace(/\/+$/,"")}function baseUrl(e){let t;t=e?"http://localhost:3000":`${location.protocol}//${location.host}`;const n=getLocationPath();return n&&(t+=n),t}function mapWsProtocol(e){return"http:"==e?"ws:":"https:"==e?"wss:":void 0}function baseWsUrl(e,t){let n=e?`${mapWsProtocol(window.location.protocol)}//${window.location.hostname}:${t}`:`${mapWsProtocol(window.location.protocol)}//${window.location.host}`;const r=getLocationPath();return r&&(n+=r),n}function deviceName(){const{userAgent:e}=navigator;let t,n=e.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(n[1]))return t=/\brv[ :]+(\d+)/g.exec(e)||[],`IE ${t[1]||""}`;if("Chrome"===n[1]){if(t=e.match(/\b(OPR|Edge)\/(\d+)/),null!==t)return t.slice(1).join(" ").replace("OPR","Opera");if(t=e.match(/\b(Edg)\/(\d+)/),null!==t)return t.slice(1).join(" ").replace("Edg","Edge (Chromium)")}return n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],t=e.match(/version\/(\d+)/i),null!==t&&n.splice(1,1,t[1]),n.join(" ").concat(" on ",navigator.platform)}!function(e){e[e.RegisterDeviceEvent=0]="RegisterDeviceEvent",e[e.DevicesOnlineEvent=1]="DevicesOnlineEvent",e[e.MakeDeviceActiveEvent=2]="MakeDeviceActiveEvent",e[e.PlayTrackEvent=3]="PlayTrackEvent",e[e.PauseEvent=4]="PauseEvent",e[e.ResumeEvent=5]="ResumeEvent",e[e.SwitchShuffleEvent=6]="SwitchShuffleEvent",e[e.CurrentPosEvent=7]="CurrentPosEvent",e[e.RewindToEvent=8]="RewindToEvent",e[e.VolumeChangeEvent=9]="VolumeChangeEvent"}(WSMessageInType||(WSMessageInType={})),function(e){e[e.RegisterDevice=0]="RegisterDevice",e[e.MakeDeviceActive=1]="MakeDeviceActive",e[e.PlayTrack=2]="PlayTrack",e[e.Pause=3]="Pause",e[e.Resume=4]="Resume",e[e.SwitchShuffle=5]="SwitchShuffle",e[e.CurrentPos=6]="CurrentPos",e[e.RewindTo=7]="RewindTo",e[e.VolumeChange=8]="VolumeChange"}(WSMessageOutType||(WSMessageOutType={}));class PlaybackSync{constructor(e){this.pendingOpen=null,this.socketUrl=baseWsUrl(e.development,e.developmentPort)+"/position",this.closed=!1,this.filePath=null,this._groupPrefix=null,this.failures=0,this._enabled=!0,this._groupPrefix=e.group,this.config=e}get groupPrefix(){return this._enabled?this._groupPrefix:null}set groupPrefix(e){this._groupPrefix=e}disable(){this._enabled=!1}try_open(){null!=this.pendingOpen||this.opening||(this.pendingOpen=window.setTimeout((()=>{this.open(),this.pendingOpen=null}),Math.min(1e4,this.failures<3?0:500*(this.failures-2))))}open(){this.closed=!1,console.debug("Opening ws on url "+this.socketUrl);const e=new WebSocket(this.socketUrl);e.addEventListener("error",(e=>{console.error(`Web socket error (in row ${this.failures})`,e),this.failures+=1})),e.addEventListener("close",(e=>{this.socket=null,console.debug("Web socket closed",e)})),e.addEventListener("open",(e=>{this.failures=0,this.filePath=null,this.lastSend=null,console.debug("Web socket is ready"),this.pendingPosition&&((new Date).getTime()-this.pendingPosition.timestamp.getTime()<3e8&&this.enqueuePosition(this.pendingPosition.filePath,this.pendingPosition.position,this.pendingPosition.timestamp),this.pendingPosition=null),this.pendingQuery&&(this.socket.send(this.pendingQuery),this.pendingQuery=null)})),e.addEventListener("message",(e=>{console.debug("Got message "+e.data);const t=JSON.parse(e.data),n=e=>{if(e&&e.folder){const[t,n]=/^(\d+)\//.exec(e.folder);e.folder=e.folder.substr(t.length),e.collection=parseInt(n)}};n(t.folder),n(t.last),this.pendingQueryAnswer&&(this.pendingQueryTimeout&&clearInterval(this.pendingQueryTimeout),this.pendingQueryTimeout=null,this.pendingQueryAnswer(t),this.pendingQueryAnswer=null,this.pendingQueryReject=null)})),this.socket=e}close(){this.closed=!0,this.socket.close(),this.socket=null}enqueuePosition(e,t,n=null){if(this.pendingPositionTimeout&&(window.clearTimeout(this.pendingPositionTimeout),this.pendingPositionTimeout=null),this.groupPrefix){if(!this.active)return this.pendingPosition={filePath:e,position:t,timestamp:new Date},void this.try_open();if(e=this.groupPrefix+e,this.filePath&&this.lastSend&&e==this.filePath){const e=(Date.now()-this.lastSend.timestamp.getTime())/1e3,n=Math.abs(t-this.lastSend.position);e>=this.config.positionReportingPeriod||n>this.config.positionReportingPeriod?this.sendMessage(t):this.pendingPositionTimeout=window.setTimeout((()=>{this.sendMessage(t),this.pendingPositionTimeout=null}),1e3*this.config.positionReportingPeriod)}else this.filePath=e,this.sendMessage(t,e,n)}}sendMessage(e,t,n){if(this.active){let r=(e=Math.round(10*e)/10).toString()+"|";t&&(r+=t),n&&(r+="|"+Math.round(n.getTime()/1e3)),this.socket.send(r),this.lastSend={position:e,timestamp:new Date}}else console.error("Cannot send message, socket not ready")}queryPosition(e){if(this.pendingQueryReject&&(this.pendingQueryTimeout&&(clearTimeout(this.pendingQueryTimeout),this.pendingQueryTimeout=null),this.pendingQueryReject(new Error("Canceled by next query")),this.pendingQueryAnswer=null,this.pendingQueryReject=null),this.groupPrefix&&this.active){const t=this._makeQueryPromise();return this.socket.send(e?this.groupPrefix+e:"?"),t}return this.groupPrefix&&!this.active?(this.pendingQuery=e?this.groupPrefix+e:"?",this.try_open(),this._makeQueryPromise()):Promise.resolve(null)}_makeQueryPromise(){return new Promise(((e,t)=>{this.pendingQueryAnswer=e,this.pendingQueryReject=t,this.pendingQueryTimeout=window.setTimeout((()=>{t(new Error("Timeout")),this.pendingQueryTimeout=null,this.pendingQueryReject=null,this.pendingQueryAnswer=null,this.pendingQuery=null}),3e3)}))}get active(){return!this.closed&&this.socket&&this.socket.readyState==WebSocket.OPEN}get opening(){return this.socket&&this.socket.readyState==WebSocket.CONNECTING}}const ENVIRONMENT="PRODUCTION",APP_VERSION="0.2.1",APP_COMMIT="c120cdd8",isDevelopment="DEVELOPMENT"===ENVIRONMENT,isAuthenticated=writable(!0),apiConfig=writable(new Configuration),group=writable(localStorage.getItem(StorageKeys.GROUP)),collections=writable(),selectedCollection=writable(),transcodings=writable(),initialTranscoding=localStorage.getItem(StorageKeys.TRANSCODING)||TranscodingCode.Medium,selectedTranscoding=writable(initialTranscoding),selectedTranscodingDetails=derived([transcodings,selectedTranscoding],(([e,t])=>{const n=t,r=transcodingCodeToName(n).toLocaleLowerCase();if(e&&r in e){const t=e[r];return{code:n,bitrate:t.bitrate,name:t.name}}return{code:n,bitrate:0}})),currentFolder=writable(void 0),playItem=writable(void 0),playList=writable(void 0),pendingDownloads=writable(0),deviceId=writable(void 0),activeDeviceId=writable(void 0),colApi=derived(apiConfig,(e=>new CollectionsApi(e))),positionsApi=derived([apiConfig,group],(([e,t])=>group?new PositionsApi(e):null)),getInitialConfig=()=>{const e=localStorage.getItem(StorageKeys.PREFERENCES);let t=defaultConfig;if(e)try{const n=JSON.parse(e);t=Object.assign(t,n)}catch(e){console.error("Invalid preferences")}return t},config=writable(getInitialConfig()),positionWsApi=derived([config,apiConfig,group],(([e,t,n])=>new PlaybackSync({development:isDevelopment,developmentPort:3e3,positionReportingPeriod:e.positionReportingPeriod,group:n})));function getWindowSize(){return{width:window.innerWidth,height:window.innerHeight}}const windowSize=readable(getWindowSize(),(e=>{window.addEventListener("resize",(()=>e(getWindowSize())))}));for(var byteLength_1=byteLength,toByteArray_1=toByteArray,fromByteArray_1=fromByteArray,lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;function getLens(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function byteLength(e){var t=getLens(e),n=t[0],r=t[1];return 3*(n+r)/4-r}function _byteLength(e,t,n){return 3*(t+n)/4-n}function toByteArray(e){var t,n,r=getLens(e),o=r[0],a=r[1],i=new Arr(_byteLength(e,o,a)),s=0,l=a>0?o-4:o;for(n=0;n<l;n+=4)t=revLookup[e.charCodeAt(n)]<<18|revLookup[e.charCodeAt(n+1)]<<12|revLookup[e.charCodeAt(n+2)]<<6|revLookup[e.charCodeAt(n+3)],i[s++]=t>>16&255,i[s++]=t>>8&255,i[s++]=255&t;return 2===a&&(t=revLookup[e.charCodeAt(n)]<<2|revLookup[e.charCodeAt(n+1)]>>4,i[s++]=255&t),1===a&&(t=revLookup[e.charCodeAt(n)]<<10|revLookup[e.charCodeAt(n+1)]<<4|revLookup[e.charCodeAt(n+2)]>>2,i[s++]=t>>8&255,i[s++]=255&t),i}function tripletToBase64(e){return lookup[e>>18&63]+lookup[e>>12&63]+lookup[e>>6&63]+lookup[63&e]}function encodeChunk(e,t,n){for(var r,o=[],a=t;a<n;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(tripletToBase64(r));return o.join("")}function fromByteArray(e){for(var t,n=e.length,r=n%3,o=[],a=16383,i=0,s=n-r;i<s;i+=a)o.push(encodeChunk(e,i,i+a>s?s:i+a));return 1===r?(t=e[n-1],o.push(lookup[t>>2]+lookup[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],o.push(lookup[t>>10]+lookup[t>>4&63]+lookup[t<<2&63]+"=")),o.join("")}revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63;var base64Js={byteLength:byteLength_1,toByteArray:toByteArray_1,fromByteArray:fromByteArray_1},commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(e){var t={exports:{}};return e(t,t.exports),t.exports
/**
     * [js-sha256]{@link https://github.com/emn178/js-sha256}
     *
     * @version 0.9.0
     * @author Chen, Yi-Cyuan [emn178@gmail.com]
     * @copyright Chen, Yi-Cyuan 2014-2017
     * @license MIT
     */}var sha256=createCommonjsModule((function(module){(function(){var ERROR="input is invalid type",WINDOW="object"==typeof window,root=WINDOW?window:{};root.JS_SHA256_NO_WINDOW&&(WINDOW=!1);var WEB_WORKER=!WINDOW&&"object"==typeof self,NODE_JS=!root.JS_SHA256_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;NODE_JS?root=commonjsGlobal:WEB_WORKER&&(root=self);var COMMON_JS=!root.JS_SHA256_NO_COMMON_JS&&module.exports,ARRAY_BUFFER=!root.JS_SHA256_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,HEX_CHARS="0123456789abcdef".split(""),EXTRA=[-2147483648,8388608,32768,128],SHIFT=[24,16,8,0],K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],OUTPUT_TYPES=["hex","array","digest","arrayBuffer"],blocks=[];!root.JS_SHA256_NO_NODE_JS&&Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),!ARRAY_BUFFER||!root.JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return"object"==typeof e&&e.buffer&&e.buffer.constructor===ArrayBuffer});var createOutputMethod=function(e,t){return function(n){return new Sha256(t,!0).update(n)[e]()}},createMethod=function(e){var t=createOutputMethod("hex",e);NODE_JS&&(t=nodeWrap(t,e)),t.create=function(){return new Sha256(e)},t.update=function(e){return t.create().update(e)};for(var n=0;n<OUTPUT_TYPES.length;++n){var r=OUTPUT_TYPES[n];t[r]=createOutputMethod(r,e)}return t},nodeWrap=function(method,is224){var crypto=eval("require('crypto')"),Buffer=eval("require('buffer').Buffer"),algorithm=is224?"sha224":"sha256",nodeMethod=function(e){if("string"==typeof e)return crypto.createHash(algorithm).update(e,"utf8").digest("hex");if(null==e)throw new Error(ERROR);return e.constructor===ArrayBuffer&&(e=new Uint8Array(e)),Array.isArray(e)||ArrayBuffer.isView(e)||e.constructor===Buffer?crypto.createHash(algorithm).update(new Buffer(e)).digest("hex"):method(e)};return nodeMethod},createHmacOutputMethod=function(e,t){return function(n,r){return new HmacSha256(n,t,!0).update(r)[e]()}},createHmacMethod=function(e){var t=createHmacOutputMethod("hex",e);t.create=function(t){return new HmacSha256(t,e)},t.update=function(e,n){return t.create(e).update(n)};for(var n=0;n<OUTPUT_TYPES.length;++n){var r=OUTPUT_TYPES[n];t[r]=createHmacOutputMethod(r,e)}return t};function Sha256(e,t){t?(blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=e}function HmacSha256(e,t,n){var r,o=typeof e;if("string"===o){var a,i=[],s=e.length,l=0;for(r=0;r<s;++r)(a=e.charCodeAt(r))<128?i[l++]=a:a<2048?(i[l++]=192|a>>6,i[l++]=128|63&a):a<55296||a>=57344?(i[l++]=224|a>>12,i[l++]=128|a>>6&63,i[l++]=128|63&a):(a=65536+((1023&a)<<10|1023&e.charCodeAt(++r)),i[l++]=240|a>>18,i[l++]=128|a>>12&63,i[l++]=128|a>>6&63,i[l++]=128|63&a);e=i}else{if("object"!==o)throw new Error(ERROR);if(null===e)throw new Error(ERROR);if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||ARRAY_BUFFER&&ArrayBuffer.isView(e)))throw new Error(ERROR)}e.length>64&&(e=new Sha256(t,!0).update(e).array());var c=[],u=[];for(r=0;r<64;++r){var d=e[r]||0;c[r]=92^d,u[r]=54^d}Sha256.call(this,t,n),this.update(u),this.oKeyPad=c,this.inner=!0,this.sharedMemory=n}Sha256.prototype.update=function(e){if(!this.finalized){var t,n=typeof e;if("string"!==n){if("object"!==n)throw new Error(ERROR);if(null===e)throw new Error(ERROR);if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||ARRAY_BUFFER&&ArrayBuffer.isView(e)))throw new Error(ERROR);t=!0}for(var r,o,a=0,i=e.length,s=this.blocks;a<i;){if(this.hashed&&(this.hashed=!1,s[0]=this.block,s[16]=s[1]=s[2]=s[3]=s[4]=s[5]=s[6]=s[7]=s[8]=s[9]=s[10]=s[11]=s[12]=s[13]=s[14]=s[15]=0),t)for(o=this.start;a<i&&o<64;++a)s[o>>2]|=e[a]<<SHIFT[3&o++];else for(o=this.start;a<i&&o<64;++a)(r=e.charCodeAt(a))<128?s[o>>2]|=r<<SHIFT[3&o++]:r<2048?(s[o>>2]|=(192|r>>6)<<SHIFT[3&o++],s[o>>2]|=(128|63&r)<<SHIFT[3&o++]):r<55296||r>=57344?(s[o>>2]|=(224|r>>12)<<SHIFT[3&o++],s[o>>2]|=(128|r>>6&63)<<SHIFT[3&o++],s[o>>2]|=(128|63&r)<<SHIFT[3&o++]):(r=65536+((1023&r)<<10|1023&e.charCodeAt(++a)),s[o>>2]|=(240|r>>18)<<SHIFT[3&o++],s[o>>2]|=(128|r>>12&63)<<SHIFT[3&o++],s[o>>2]|=(128|r>>6&63)<<SHIFT[3&o++],s[o>>2]|=(128|63&r)<<SHIFT[3&o++]);this.lastByteIndex=o,this.bytes+=o-this.start,o>=64?(this.block=s[16],this.start=o-64,this.hash(),this.hashed=!0):this.start=o}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Sha256.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=EXTRA[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},Sha256.prototype.hash=function(){var e,t,n,r,o,a,i,s,l,c=this.h0,u=this.h1,d=this.h2,p=this.h3,h=this.h4,m=this.h5,_=this.h6,f=this.h7,g=this.blocks;for(e=16;e<64;++e)t=((o=g[e-15])>>>7|o<<25)^(o>>>18|o<<14)^o>>>3,n=((o=g[e-2])>>>17|o<<15)^(o>>>19|o<<13)^o>>>10,g[e]=g[e-16]+t+g[e-7]+n<<0;for(l=u&d,e=0;e<64;e+=4)this.first?(this.is224?(a=300032,f=(o=g[0]-1413257819)-150054599<<0,p=o+24177077<<0):(a=704751109,f=(o=g[0]-210244248)-1521486534<<0,p=o+143694565<<0),this.first=!1):(t=(c>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),r=(a=c&u)^c&d^l,f=p+(o=f+(n=(h>>>6|h<<26)^(h>>>11|h<<21)^(h>>>25|h<<7))+(h&m^~h&_)+K[e]+g[e])<<0,p=o+(t+r)<<0),t=(p>>>2|p<<30)^(p>>>13|p<<19)^(p>>>22|p<<10),r=(i=p&c)^p&u^a,_=d+(o=_+(n=(f>>>6|f<<26)^(f>>>11|f<<21)^(f>>>25|f<<7))+(f&h^~f&m)+K[e+1]+g[e+1])<<0,t=((d=o+(t+r)<<0)>>>2|d<<30)^(d>>>13|d<<19)^(d>>>22|d<<10),r=(s=d&p)^d&c^i,m=u+(o=m+(n=(_>>>6|_<<26)^(_>>>11|_<<21)^(_>>>25|_<<7))+(_&f^~_&h)+K[e+2]+g[e+2])<<0,t=((u=o+(t+r)<<0)>>>2|u<<30)^(u>>>13|u<<19)^(u>>>22|u<<10),r=(l=u&d)^u&p^s,h=c+(o=h+(n=(m>>>6|m<<26)^(m>>>11|m<<21)^(m>>>25|m<<7))+(m&_^~m&f)+K[e+3]+g[e+3])<<0,c=o+(t+r)<<0;this.h0=this.h0+c<<0,this.h1=this.h1+u<<0,this.h2=this.h2+d<<0,this.h3=this.h3+p<<0,this.h4=this.h4+h<<0,this.h5=this.h5+m<<0,this.h6=this.h6+_<<0,this.h7=this.h7+f<<0},Sha256.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,n=this.h2,r=this.h3,o=this.h4,a=this.h5,i=this.h6,s=this.h7,l=HEX_CHARS[e>>28&15]+HEX_CHARS[e>>24&15]+HEX_CHARS[e>>20&15]+HEX_CHARS[e>>16&15]+HEX_CHARS[e>>12&15]+HEX_CHARS[e>>8&15]+HEX_CHARS[e>>4&15]+HEX_CHARS[15&e]+HEX_CHARS[t>>28&15]+HEX_CHARS[t>>24&15]+HEX_CHARS[t>>20&15]+HEX_CHARS[t>>16&15]+HEX_CHARS[t>>12&15]+HEX_CHARS[t>>8&15]+HEX_CHARS[t>>4&15]+HEX_CHARS[15&t]+HEX_CHARS[n>>28&15]+HEX_CHARS[n>>24&15]+HEX_CHARS[n>>20&15]+HEX_CHARS[n>>16&15]+HEX_CHARS[n>>12&15]+HEX_CHARS[n>>8&15]+HEX_CHARS[n>>4&15]+HEX_CHARS[15&n]+HEX_CHARS[r>>28&15]+HEX_CHARS[r>>24&15]+HEX_CHARS[r>>20&15]+HEX_CHARS[r>>16&15]+HEX_CHARS[r>>12&15]+HEX_CHARS[r>>8&15]+HEX_CHARS[r>>4&15]+HEX_CHARS[15&r]+HEX_CHARS[o>>28&15]+HEX_CHARS[o>>24&15]+HEX_CHARS[o>>20&15]+HEX_CHARS[o>>16&15]+HEX_CHARS[o>>12&15]+HEX_CHARS[o>>8&15]+HEX_CHARS[o>>4&15]+HEX_CHARS[15&o]+HEX_CHARS[a>>28&15]+HEX_CHARS[a>>24&15]+HEX_CHARS[a>>20&15]+HEX_CHARS[a>>16&15]+HEX_CHARS[a>>12&15]+HEX_CHARS[a>>8&15]+HEX_CHARS[a>>4&15]+HEX_CHARS[15&a]+HEX_CHARS[i>>28&15]+HEX_CHARS[i>>24&15]+HEX_CHARS[i>>20&15]+HEX_CHARS[i>>16&15]+HEX_CHARS[i>>12&15]+HEX_CHARS[i>>8&15]+HEX_CHARS[i>>4&15]+HEX_CHARS[15&i];return this.is224||(l+=HEX_CHARS[s>>28&15]+HEX_CHARS[s>>24&15]+HEX_CHARS[s>>20&15]+HEX_CHARS[s>>16&15]+HEX_CHARS[s>>12&15]+HEX_CHARS[s>>8&15]+HEX_CHARS[s>>4&15]+HEX_CHARS[15&s]),l},Sha256.prototype.toString=Sha256.prototype.hex,Sha256.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,n=this.h2,r=this.h3,o=this.h4,a=this.h5,i=this.h6,s=this.h7,l=[e>>24&255,e>>16&255,e>>8&255,255&e,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24&255,n>>16&255,n>>8&255,255&n,r>>24&255,r>>16&255,r>>8&255,255&r,o>>24&255,o>>16&255,o>>8&255,255&o,a>>24&255,a>>16&255,a>>8&255,255&a,i>>24&255,i>>16&255,i>>8&255,255&i];return this.is224||l.push(s>>24&255,s>>16&255,s>>8&255,255&s),l},Sha256.prototype.array=Sha256.prototype.digest,Sha256.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(this.is224?28:32),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),t.setUint32(20,this.h5),t.setUint32(24,this.h6),this.is224||t.setUint32(28,this.h7),e},HmacSha256.prototype=new Sha256,HmacSha256.prototype.finalize=function(){if(Sha256.prototype.finalize.call(this),this.inner){this.inner=!1;var e=this.array();Sha256.call(this,this.is224,this.sharedMemory),this.update(this.oKeyPad),this.update(e),Sha256.prototype.finalize.call(this)}};var exports=createMethod();exports.sha256=exports,exports.sha224=createMethod(!0),exports.sha256.hmac=createHmacMethod(),exports.sha224.hmac=createHmacMethod(!0),COMMON_JS?module.exports=exports:(root.sha256=exports.sha256,root.sha224=exports.sha224)})()}));async function encodeSecret(e){let t=(new TextEncoder).encode(e),n=new Uint8Array(32);window.crypto.getRandomValues(n);let r,o=new Uint8Array(t.length+n.length);o.set(t),o.set(n,t.length),r=window.crypto.subtle?window.crypto.subtle.digest("SHA-256",o):Promise.resolve(sha256.sha256.arrayBuffer(o));const a=await r;return base64Js.fromByteArray(n)+"|"+base64Js.fromByteArray(new Uint8Array(a))}function deleteCookie(){document.cookie="audioserve_token=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"}function create_if_block_1$6(e){let t;return{c(){t=element("p"),t.textContent="Service Worker is not available. You're probably not using secure\n      connection connection with trusted server certificate or you have old\n      browser. Some functionality (especially caching) will not be available.",attr(t,"class","warning"),attr(t,"role","alert")},m(e,n){insert(e,t,n)},d(e){e&&detach(t)}}}function create_if_block$9(e){let t;return{c(){t=element("p"),t.textContent="Login failed!",attr(t,"class","warning"),attr(t,"role","alert")},m(e,n){insert(e,t,n)},d(e){e&&detach(t)}}}function create_fragment$J(e){let t,n,r,o,a,i,s,l,c,u,d,p,h,m,_,f,g,b=null==e[3]&&create_if_block_1$6(),w=e[2]&&create_if_block$9();return{c(){t=element("div"),n=element("h1"),n.textContent="Audioserve Login",r=space(),b&&b.c(),o=space(),w&&w.c(),a=space(),i=element("form"),s=element("label"),s.textContent="Shared Secret",l=space(),c=element("input"),u=space(),d=element("label"),d.textContent="Playback Group",p=space(),h=element("input"),m=space(),_=element("button"),_.textContent="Log in",attr(s,"for","shared-secret"),attr(c,"type","password"),attr(c,"name","shared-secret"),attr(c,"id","shared-secret"),attr(d,"for","playback-group"),attr(h,"type","text"),attr(h,"name","playback-group"),attr(h,"id","playback-group"),attr(_,"id","login-button"),attr(t,"class","login")},m(v,y){insert(v,t,y),append(t,n),append(t,r),b&&b.m(t,null),append(t,o),w&&w.m(t,null),append(t,a),append(t,i),append(i,s),append(i,l),append(i,c),set_input_value(c,e[0]),append(i,u),append(i,d),append(i,p),append(i,h),set_input_value(h,e[1]),append(i,m),append(i,_),f||(g=[listen(c,"input",e[5]),listen(h,"input",e[6]),listen(i,"submit",prevent_default(e[4]))],f=!0)},p(e,[n]){e[2]?w||(w=create_if_block$9(),w.c(),w.m(t,a)):w&&(w.d(1),w=null),1&n&&c.value!==e[0]&&set_input_value(c,e[0]),2&n&&h.value!==e[1]&&set_input_value(h,e[1])},i:noop,o:noop,d(e){e&&detach(t),b&&b.d(),w&&w.d(),f=!1,run_all(g)}}}function instance$J(e,t,n){let r,o,a,i;component_subscribe(e,isAuthenticated,(e=>n(7,r=e))),component_subscribe(e,group,(e=>n(8,o=e))),component_subscribe(e,apiConfig,(e=>n(9,a=e)));let s=localStorage.getItem(StorageKeys.GROUP),l=!1;const c=getContext("cache");return[i,s,l,c,async function(){if(console.debug("Initiating client login"),n(2,l=!1),i){const e=await encodeSecret(i),t=new AuthenticationApi(a);try{await t.authenticatePost({secret:e});console.debug("Client succesfully authenticated with server"),set_store_value(isAuthenticated,r=!0,r),apiConfig.update((e=>new Configuration({basePath:e.basePath,credentials:e.credentials}))),s?(localStorage.setItem(StorageKeys.GROUP,s),set_store_value(group,o=s,o)):localStorage.removeItem(StorageKeys.GROUP)}catch(e){console.error("Login error",e),n(2,l=!0),set_store_value(isAuthenticated,r=!1,r)}n(0,i="")}},function(){i=this.value,n(0,i)},function(){s=this.value,n(1,s)}]}class Login extends SvelteComponent{constructor(e){super(),init(this,e,instance$J,create_fragment$J,safe_not_equal,{})}}function create_fragment$I(e){let t,n;return{c(){t=svg_element("svg"),n=svg_element("path"),attr(n,"d","M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z"),attr(n,"fill",e[2]),attr(t,"width",e[0]),attr(t,"height",e[1]),attr(t,"viewBox",e[3])},m(e,r){insert(e,t,r),append(t,n)},p(e,[r]){4&r&&attr(n,"fill",e[2]),1&r&&attr(t,"width",e[0]),2&r&&attr(t,"height",e[1]),8&r&&attr(t,"viewBox",e[3])},i:noop,o:noop,d(e){e&&detach(t)}}}function instance$I(e,t,n){let{size:r="1em"}=t,{width:o=r}=t,{height:a=r}=t,{color:i="currentColor"}=t,{viewBox:s="0 0 24 24"}=t;return e.$$set=e=>{"size"in e&&n(4,r=e.size),"width"in e&&n(0,o=e.width),"height"in e&&n(1,a=e.height),"color"in e&&n(2,i=e.color),"viewBox"in e&&n(3,s=e.viewBox)},[o,a,i,s,r]}class Menu extends SvelteComponent{constructor(e){super(),init(this,e,instance$I,create_fragment$I,safe_not_equal,{size:4,width:0,height:1,color:2,viewBox:3})}}function capitalize(e){return 0==e.length?"":e[0].toUpperCase()+e.slice(1)}function removeQuery(e){const t=new URL(e);return t.search="",t.toString()}function splitUrl(e,t){const n=new URL(e);let r=decodeURI(n.pathname);t&&(r=r.substring(t.length));const o=r.split("/");return{collection:parseInt(o[1]),path:o.slice(3).join("/")}}function splitPath(e){const t=e.lastIndexOf("/");return t>=0?{folder:e.substring(0,t),file:e.substring(t+1)}:{file:e}}function splitRootPath(e){const t=e.indexOf("/");return t>=0?{root:e.substring(0,t),path:e.substring(t+1)}:{path:e}}function splitExtInName(e){const t=e.path.lastIndexOf(".");if(t>=0){const n=e.path.substring(t);return{baseName:e.name.endsWith(n)?e.name.substring(0,e.name.length-n.length):e.name,extension:n.substring(1)}}return{baseName:e.name}}function fileToHumanName(e){if(/\$\$/.test(e)){const t=e.split("$$");if(2===t.length)e=e.replace("$$"," ");else{if(3===t.length)return t[0];if(4==t.length)return t[1]}}const t=e.lastIndexOf(".");return t>0?e.substring(0,t):e}function nonEmpty(e){return!!e&&(e instanceof Array?e.length>0:Object.keys(e).length>0)}function sorted(e){return[...e].sort()}const API_CACHE_NAME="api",DAY_IN_MILIS=864e5,SCROLL_OFFSET=26;function clickOutside(e,t){const n=n=>{e.contains(n.target)||t&&t.contains(n.target)||e.dispatchEvent(new CustomEvent("outclick"))};return document.addEventListener("click",n,!0),{destroy(){document.removeEventListener("click",n,!0)}}}function gainFocus(e){e.focus()}var Scroll,EventType;!function(e){e[e.UP=0]="UP",e[e.DOWN=1]="DOWN",e[e.NO=2]="NO"}(Scroll||(Scroll={}));class Scroller{constructor(e,t=SCROLL_OFFSET){this.container=e,this.scrollOffset=t}needScroll(e){const t=this.container.scrollTop,n=t+this.container.clientHeight,r=e.offsetTop,o=r+e.clientHeight;return r>=t&&o<=n?Scroll.NO:o>n?Scroll.UP:Scroll.DOWN}scrollToView(e){const t=this.needScroll(e);t!==Scroll.NO&&(e.scrollIntoView(t===Scroll.DOWN),t===Scroll.UP&&this.container.scrollBy({top:this.scrollOffset}))}}function get_each_context$5(e,t,n){const r=e.slice();return r[17]=t[n],r}function create_if_block$8(e){let t,n,r,o,a,i,s,l,c,u,d,p,h,m,_,f,g,b,w,v,y,k,$,x,S,C,A,P,E,T,R=e[4]&&create_if_block_2$4(e),L=e[2],I=[];for(let t=0;t<L.length;t+=1)I[t]=create_each_block$5(get_each_context$5(e,L,t));let M=e[5]&&create_if_block_1$5(e);return{c(){t=element("div"),n=element("aside"),r=element("nav"),o=element("ul"),R&&R.c(),a=space(),i=element("li"),s=element("a"),s.textContent="Logout",l=space(),c=element("li"),u=element("a"),u.textContent=`${capitalize(otherTheme())} Theme`,d=space(),p=element("li"),h=element("details"),m=element("summary"),_=text("Transcoding ("),f=text(e[3]),g=text(")"),b=space(),w=element("ul");for(let e=0;e<I.length;e+=1)I[e].c();v=space(),y=element("li"),k=element("a"),k.textContent="Preferences",$=space(),M&&M.c(),x=space(),S=element("li"),C=element("a"),C.textContent="About",attr(s,"href","#"),attr(s,"data-menu","logout"),attr(s,"class","svelte-18c7wvm"),attr(u,"href","#"),attr(u,"data-menu","switch-theme"),attr(u,"class","svelte-18c7wvm"),attr(m,"class","svelte-18c7wvm"),attr(k,"href","#"),attr(k,"data-menu","show-preferences"),attr(k,"class","svelte-18c7wvm"),attr(C,"href","#"),attr(C,"data-menu","about"),attr(C,"class","svelte-18c7wvm"),attr(n,"class","dropdown-content svelte-18c7wvm"),attr(n,"style",A=e[0]?"":"display:none")},m(A,L){insert(A,t,L),append(t,n),append(n,r),append(r,o),R&&R.m(o,null),append(o,a),append(o,i),append(i,s),append(o,l),append(o,c),append(c,u),append(o,d),append(o,p),append(p,h),append(h,m),append(m,_),append(m,f),append(m,g),append(h,b),append(h,w);for(let e=0;e<I.length;e+=1)I[e].m(w,null);append(o,v),append(o,y),append(y,k),append(o,$),M&&M.m(o,null),append(o,x),append(o,S),append(S,C),E||(T=[listen(s,"click",prevent_default(e[8])),listen(u,"click",prevent_default(e[8])),listen(k,"click",prevent_default(e[8])),listen(C,"click",prevent_default(e[8])),action_destroyer(P=clickOutside.call(null,t,e[1])),listen(t,"outclick",e[15])],E=!0)},p(e,t){if(e[4]?R?R.p(e,t):(R=create_if_block_2$4(e),R.c(),R.m(o,a)):R&&(R.d(1),R=null),8&t&&set_data(f,e[3]),204&t){let n;for(L=e[2],n=0;n<L.length;n+=1){const r=get_each_context$5(e,L,n);I[n]?I[n].p(r,t):(I[n]=create_each_block$5(r),I[n].c(),I[n].m(w,null))}for(;n<I.length;n+=1)I[n].d(1);I.length=L.length}e[5]&&M.p(e,t),1&t&&A!==(A=e[0]?"":"display:none")&&attr(n,"style",A),P&&is_function(P.update)&&2&t&&P.update.call(null,e[1])},d(e){e&&detach(t),R&&R.d(),destroy_each(I,e),M&&M.d(),E=!1,run_all(T)}}}function create_if_block_2$4(e){let t,n,r,o;return{c(){t=element("li"),n=element("a"),n.textContent="Recently Listened",attr(n,"href","#"),attr(n,"data-menu","recent"),attr(n,"class","svelte-18c7wvm")},m(a,i){insert(a,t,i),append(t,n),r||(o=listen(n,"click",prevent_default(e[8])),r=!0)},p:noop,d(e){e&&detach(t),r=!1,o()}}}function create_each_block$5(e){let t,n,r,o,a,i,s,l,c,u,d,p,h=e[17]+"",m=e[7](e[17])+"";return{c(){t=element("li"),n=element("input"),a=element("label"),i=text(h),s=space(),l=text(m),u=space(),attr(n,"type","radio"),attr(n,"name","transcoding"),n.__value=r=e[17],n.value=n.__value,attr(n,"id",o="radio-"+e[17]),e[14][0].push(n),attr(a,"for",c="radio-"+e[17]),attr(t,"class","option svelte-18c7wvm")},m(r,o){insert(r,t,o),append(t,n),n.checked=n.__value===e[3],append(t,a),append(a,i),append(a,s),append(a,l),append(t,u),d||(p=[listen(n,"change",e[13]),listen(n,"change",e[6])],d=!0)},p(e,t){4&t&&r!==(r=e[17])&&(n.__value=r,n.value=n.__value),4&t&&o!==(o="radio-"+e[17])&&attr(n,"id",o),8&t&&(n.checked=n.__value===e[3]),4&t&&h!==(h=e[17]+"")&&set_data(i,h),4&t&&m!==(m=e[7](e[17])+"")&&set_data(l,m),4&t&&c!==(c="radio-"+e[17])&&attr(a,"for",c)},d(r){r&&detach(t),e[14][0].splice(e[14][0].indexOf(n),1),d=!1,run_all(p)}}}function create_if_block_1$5(e){let t,n,r,o,a,i,s;return{c(){t=element("li"),n=element("a"),n.textContent="Cache Current Folder",r=space(),o=element("li"),a=element("a"),a.textContent="Clear Cache",attr(n,"href","#"),attr(n,"data-menu","download"),attr(n,"class","svelte-18c7wvm"),attr(a,"href","#"),attr(a,"data-menu","clear-cache"),attr(a,"class","svelte-18c7wvm")},m(l,c){insert(l,t,c),append(t,n),insert(l,r,c),insert(l,o,c),append(o,a),i||(s=[listen(n,"click",prevent_default(e[8])),listen(a,"click",prevent_default(e[8]))],i=!0)},p:noop,d(e){e&&detach(t),e&&detach(r),e&&detach(o),i=!1,run_all(s)}}}function create_fragment$H(e){let t,n,r,o,a,i,s;r=new Menu({props:{size:"1.9rem"}});let l=e[0]&&create_if_block$8(e);return{c(){t=element("div"),n=element("a"),create_component(r.$$.fragment),o=space(),l&&l.c(),attr(n,"href","#"),attr(n,"aria-label","Menu"),attr(n,"aria-expanded",e[0]),attr(n,"id","main-menu-button"),attr(n,"class","svelte-18c7wvm"),attr(t,"class","dropdown svelte-18c7wvm")},m(c,u){insert(c,t,u),append(t,n),mount_component(r,n,null),e[12](n),append(t,o),l&&l.m(t,null),a=!0,i||(s=listen(n,"click",prevent_default(e[11])),i=!0)},p(e,[r]){(!a||1&r)&&attr(n,"aria-expanded",e[0]),e[0]?l?l.p(e,r):(l=create_if_block$8(e),l.c(),l.m(t,null)):l&&(l.d(1),l=null)},i(e){a||(transition_in(r.$$.fragment,e),a=!0)},o(e){transition_out(r.$$.fragment,e),a=!1},d(n){n&&detach(t),destroy_component(r),e[12](null),l&&l.d(),i=!1,s()}}}function instance$H(e,t,n){let r,o,a,i;component_subscribe(e,transcodings,(e=>n(9,o=e))),component_subscribe(e,selectedTranscoding,(e=>n(10,a=e))),component_subscribe(e,group,(e=>n(4,i=e)));const s=createEventDispatcher(),l=getContext("cache");let c,u=!1,d=[];return e.$$.update=()=>{512&e.$$.dirty&&o&&n(2,d=["None","Low","Medium","High"]),1024&e.$$.dirty&&n(3,r=transcodingCodeToName(a))},[u,c,d,r,i,l,function(){set_store_value(selectedTranscoding,a=transcodingNameToCode(r),a),localStorage.setItem(StorageKeys.TRANSCODING,a),n(0,u=!1),console.debug("Transcoding changed to ",a,r)},function(e){if("None"!==e&&o){const t=e.toLocaleLowerCase();return`(${o[t].bitrate} kbps)`}return""},function(e){n(0,u=!1);const t=e.target.dataset.menu;s("menu",t)},o,a,()=>n(0,u=!u),function(e){binding_callbacks[e?"unshift":"push"]((()=>{c=e,n(1,c)}))},function(){r=this.__value,n(3,r),n(10,a)},[[]],()=>n(0,u=!1)]}class Menu_1 extends SvelteComponent{constructor(e){super(),init(this,e,instance$H,create_fragment$H,safe_not_equal,{})}}function create_fragment$G(e){let t,n;return{c(){t=svg_element("svg"),n=svg_element("path"),attr(n,"d","M22,17H18V10H22M23,8H17A1,1 0 0,0 16,9V19A1,1 0 0,0 17,20H23A1,1 0 0,0 24,19V9A1,1 0 0,0 23,8M4,6H22V4H4A2,2 0 0,0 2,6V17H0V20H14V17H4V6Z"),attr(n,"fill",e[2]),attr(t,"width",e[0]),attr(t,"height",e[1]),attr(t,"viewBox",e[3])},m(e,r){insert(e,t,r),append(t,n)},p(e,[r]){4&r&&attr(n,"fill",e[2]),1&r&&attr(t,"width",e[0]),2&r&&attr(t,"height",e[1]),8&r&&attr(t,"viewBox",e[3])},i:noop,o:noop,d(e){e&&detach(t)}}}function instance$G(e,t,n){let{size:r="1em"}=t,{width:o=r}=t,{height:a=r}=t,{color:i="currentColor"}=t,{viewBox:s="0 0 24 24"}=t;return e.$$set=e=>{"size"in e&&n(4,r=e.size),"width"in e&&n(0,o=e.width),"height"in e&&n(1,a=e.height),"color"in e&&n(2,i=e.color),"viewBox"in e&&n(3,s=e.viewBox)},[o,a,i,s,r]}class CellphoneLink extends SvelteComponent{constructor(e){super(),init(this,e,instance$G,create_fragment$G,safe_not_equal,{size:4,width:0,height:1,color:2,viewBox:3})}}function formatWSMessage(e,t){var n={};return n[WSMessageOutType[e]]=t,n}function get_each_context$4(e,t,n){const r=e.slice();return r[13]=t[n],r}function create_if_block$7(e){let t,n,r,o,a,i,s,l,c=e[0],u=[];for(let t=0;t<c.length;t+=1)u[t]=create_each_block$4(get_each_context$4(e,c,t));return{c(){t=element("div"),n=element("aside"),r=element("nav"),o=element("ul");for(let e=0;e<u.length;e+=1)u[e].c();attr(n,"class","dropdown-content svelte-16b6tle"),attr(n,"style",a=e[2]?"":"display:none")},m(a,c){insert(a,t,c),append(t,n),append(n,r),append(r,o);for(let e=0;e<u.length;e+=1)u[e].m(o,null);s||(l=[action_destroyer(i=clickOutside.call(null,t,e[3])),listen(t,"outclick",e[10])],s=!0)},p(e,t){if(51&t){let n;for(c=e[0],n=0;n<c.length;n+=1){const r=get_each_context$4(e,c,n);u[n]?u[n].p(r,t):(u[n]=create_each_block$4(r),u[n].c(),u[n].m(o,null))}for(;n<u.length;n+=1)u[n].d(1);u.length=c.length}4&t&&a!==(a=e[2]?"":"display:none")&&attr(n,"style",a),i&&is_function(i.update)&&8&t&&i.update.call(null,e[3])},d(e){e&&detach(t),destroy_each(u,e),s=!1,run_all(l)}}}function create_if_block_1$4(e){let t;return{c(){t=text("(this)")},m(e,n){insert(e,t,n)},d(e){e&&detach(t)}}}function create_each_block$4(e){let t,n,r,o,a,i,s,l,c,u,d,p=e[13].name+"",h=e[4]===e[13].id&&create_if_block_1$4();return{c(){t=element("li"),n=element("input"),a=element("label"),i=text(p),s=space(),h&&h.c(),c=space(),attr(n,"type","radio"),attr(n,"name","activeDevice"),n.__value=r=e[13].id,n.value=n.__value,attr(n,"id",o="radio-"+e[13].id),e[9][0].push(n),attr(a,"for",l="radio-"+e[13].id),attr(t,"class","option svelte-16b6tle")},m(r,o){insert(r,t,o),append(t,n),n.checked=n.__value===e[1],append(t,a),append(a,i),append(a,s),h&&h.m(a,null),append(t,c),u||(d=[listen(n,"change",e[8]),listen(n,"change",e[5])],u=!0)},p(e,t){1&t&&r!==(r=e[13].id)&&(n.__value=r,n.value=n.__value),1&t&&o!==(o="radio-"+e[13].id)&&attr(n,"id",o),2&t&&(n.checked=n.__value===e[1]),1&t&&p!==(p=e[13].name+"")&&set_data(i,p),e[4]===e[13].id?h||(h=create_if_block_1$4(),h.c(),h.m(a,null)):h&&(h.d(1),h=null),1&t&&l!==(l="radio-"+e[13].id)&&attr(a,"for",l)},d(r){r&&detach(t),e[9][0].splice(e[9][0].indexOf(n),1),h&&h.d(),u=!1,run_all(d)}}}function create_fragment$F(e){let t,n,r,o,a,i,s;r=new CellphoneLink({props:{size:"1.9rem"}});let l=e[2]&&create_if_block$7(e);return{c(){t=element("div"),n=element("a"),create_component(r.$$.fragment),o=space(),l&&l.c(),attr(n,"href","#"),attr(n,"aria-label","Device list"),attr(n,"aria-expanded",e[2]),attr(n,"id","device-list-button"),attr(n,"class","svelte-16b6tle"),attr(t,"class","dropdown svelte-16b6tle")},m(c,u){insert(c,t,u),append(t,n),mount_component(r,n,null),e[7](n),append(t,o),l&&l.m(t,null),a=!0,i||(s=listen(n,"click",prevent_default(e[6])),i=!0)},p(e,[r]){(!a||4&r)&&attr(n,"aria-expanded",e[2]),e[2]?l?l.p(e,r):(l=create_if_block$7(e),l.c(),l.m(t,null)):l&&(l.d(1),l=null)},i(e){a||(transition_in(r.$$.fragment,e),a=!0)},o(e){transition_out(r.$$.fragment,e),a=!1},d(n){n&&detach(t),destroy_component(r),e[7](null),l&&l.d(),i=!1,s()}}}function instance$F(e,t,n){let r,o;component_subscribe(e,activeDeviceId,(e=>n(1,r=e))),component_subscribe(e,deviceId,(e=>n(4,o=e))),createEventDispatcher();const a=getContext("webSocket");a.addEventListener("message",(e=>{const t=JSON.parse(e.data),a=Object.keys(t)[0],i=t[a];switch(WSMessageInType[a]){case WSMessageInType.DevicesOnlineEvent:n(0,l=i.devices);break;case WSMessageInType.RegisterDeviceEvent:set_store_value(deviceId,o=i.device_id,o),set_store_value(activeDeviceId,r=i.device_id,r);break;case WSMessageInType.MakeDeviceActiveEvent:set_store_value(activeDeviceId,r=i.device_id,r)}}));let i,s=!1,l=[];return e.$$.update=()=>{if(3&e.$$.dirty){for(let e of l)if(e.active){set_store_value(activeDeviceId,r=e.id,r);break}console.log("Selected device: "+r)}},[l,r,s,i,o,function(){let e=formatWSMessage(WSMessageOutType.MakeDeviceActive,{device_id:r});a.send(JSON.stringify(e)),console.log("Sending make device active: ",e),n(2,s=!1)},()=>n(2,s=!s),function(e){binding_callbacks[e?"unshift":"push"]((()=>{i=e,n(3,i)}))},function(){r=this.__value,activeDeviceId.set(r)},[[]],()=>n(2,s=!1)]}class DevicesOnline extends SvelteComponent{constructor(e){super(),init(this,e,instance$F,create_fragment$F,safe_not_equal,{})}}function create_fragment$E(e){let t,n;return{c(){t=svg_element("svg"),n=svg_element("path"),attr(n,"d","M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"),attr(n,"fill",e[2]),attr(t,"width",e[0]),attr(t,"height",e[1]),attr(t,"viewBox",e[3])},m(e,r){insert(e,t,r),append(t,n)},p(e,[r]){4&r&&attr(n,"fill",e[2]),1&r&&attr(t,"width",e[0]),2&r&&attr(t,"height",e[1]),8&r&&attr(t,"viewBox",e[3])},i:noop,o:noop,d(e){e&&detach(t)}}}function instance$E(e,t,n){let{size:r="1em"}=t,{width:o=r}=t,{height:a=r}=t,{color:i="currentColor"}=t,{viewBox:s="0 0 24 24"}=t;return e.$$set=e=>{"size"in e&&n(4,r=e.size),"width"in e&&n(0,o=e.width),"height"in e&&n(1,a=e.height),"color"in e&&n(2,i=e.color),"viewBox"in e&&n(3,s=e.viewBox)},[o,a,i,s,r]}class Magnify extends SvelteComponent{constructor(e){super(),init(this,e,instance$E,create_fragment$E,safe_not_equal,{size:4,width:0,height:1,color:2,viewBox:3})}}function create_fragment$D(e){let t,n;return{c(){t=svg_element("svg"),n=svg_element("path"),attr(n,"d","M19.5,9V1.5H16.5V9H13.5V1.5H10.5V9H7.5V1.5H4.65V9H3V10.5H21V9H19.5M19.5,13.5H16.5V21H13.5V13.5H10.5V21H7.5V13.5H4.65V21H3V22.5H21V21H19.5V13.5Z"),attr(n,"fill",e[2]),attr(t,"width",e[0]),attr(t,"height",e[1]),attr(t,"viewBox",e[3])},m(e,r){insert(e,t,r),append(t,n)},p(e,[r]){4&r&&attr(n,"fill",e[2]),1&r&&attr(t,"width",e[0]),2&r&&attr(t,"height",e[1]),8&r&&attr(t,"viewBox",e[3])},i:noop,o:noop,d(e){e&&detach(t)}}}function instance$D(e,t,n){let{size:r="1em"}=t,{width:o=r}=t,{height:a=r}=t,{color:i="currentColor"}=t,{viewBox:s="0 0 24 24"}=t;return e.$$set=e=>{"size"in e&&n(4,r=e.size),"width"in e&&n(0,o=e.width),"height"in e&&n(1,a=e.height),"color"in e&&n(2,i=e.color),"viewBox"in e&&n(3,s=e.viewBox)},[o,a,i,s,r]}class LibraryShelves extends SvelteComponent{constructor(e){super(),init(this,e,instance$D,create_fragment$D,safe_not_equal,{size:4,width:0,height:1,color:2,viewBox:3})}}function create_fragment$C(e){let t,n;return{c(){t=svg_element("svg"),n=svg_element("path"),attr(n,"d","M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"),attr(n,"fill",e[2]),attr(t,"width",e[0]),attr(t,"height",e[1]),attr(t,"viewBox",e[3])},m(e,r){insert(e,t,r),append(t,n)},p(e,[r]){4&r&&attr(n,"fill",e[2]),1&r&&attr(t,"width",e[0]),2&r&&attr(t,"height",e[1]),8&r&&attr(t,"viewBox",e[3])},i:noop,o:noop,d(e){e&&detach(t)}}}function instance$C(e,t,n){let{size:r="1em"}=t,{width:o=r}=t,{height:a=r}=t,{color:i="currentColor"}=t,{viewBox:s="0 0 24 24"}=t;return e.$$set=e=>{"size"in e&&n(4,r=e.size),"width"in e&&n(0,o=e.width),"height"in e&&n(1,a=e.height),"color"in e&&n(2,i=e.color),"viewBox"in e&&n(3,s=e.viewBox)},[o,a,i,s,r]}class Close extends SvelteComponent{constructor(e){super(),init(this,e,instance$C,create_fragment$C,safe_not_equal,{size:4,width:0,height:1,color:2,viewBox:3})}}function create_fragment$B(e){let t,n;return{c(){t=svg_element("svg"),n=svg_element("path"),attr(n,"d","M9,1V7H5L12,14L19,7H15V1H9M5,16V18H19V16H5M5,20V22H19V20H5Z"),attr(n,"fill",e[2]),attr(t,"width",e[0]),attr(t,"height",e[1]),attr(t,"viewBox",e[3])},m(e,r){insert(e,t,r),append(t,n)},p(e,[r]){4&r&&attr(n,"fill",e[2]),1&r&&attr(t,"width",e[0]),2&r&&attr(t,"height",e[1]),8&r&&attr(t,"viewBox",e[3])},i:noop,o:noop,d(e){e&&detach(t)}}}function instance$B(e,t,n){let{size:r="1em"}=t,{width:o=r}=t,{height:a=r}=t,{color:i="currentColor"}=t,{viewBox:s="0 0 24 24"}=t;return e.$$set=e=>{"size"in e&&n(4,r=e.size),"width"in e&&n(0,o=e.width),"height"in e&&n(1,a=e.height),"color"in e&&n(2,i=e.color),"viewBox"in e&&n(3,s=e.viewBox)},[o,a,i,s,r]}class DownloadMultiple extends SvelteComponent{constructor(e){super(),init(this,e,instance$B,create_fragment$B,safe_not_equal,{size:4,width:0,height:1,color:2,viewBox:3})}}function create_fragment$A(e){let t,n;return{c(){t=svg_element("svg"),n=svg_element("path"),attr(n,"d","M7.88,3.39L6.6,1.86L2,5.71L3.29,7.24L7.88,3.39M22,5.72L17.4,1.86L16.11,3.39L20.71,7.25L22,5.72M12,4A9,9 0 0,0 3,13A9,9 0 0,0 12,22A9,9 0 0,0 21,13A9,9 0 0,0 12,4M12,20A7,7 0 0,1 5,13A7,7 0 0,1 12,6A7,7 0 0,1 19,13A7,7 0 0,1 12,20M9,11H12.63L9,15.2V17H15V15H11.37L15,10.8V9H9V11Z"),attr(n,"fill",e[2]),attr(t,"width",e[0]),attr(t,"height",e[1]),attr(t,"viewBox",e[3])},m(e,r){insert(e,t,r),append(t,n)},p(e,[r]){4&r&&attr(n,"fill",e[2]),1&r&&attr(t,"width",e[0]),2&r&&attr(t,"height",e[1]),8&r&&attr(t,"viewBox",e[3])},i:noop,o:noop,d(e){e&&detach(t)}}}function instance$A(e,t,n){let{size:r="1em"}=t,{width:o=r}=t,{height:a=r}=t,{color:i="currentColor"}=t,{viewBox:s="0 0 24 24"}=t;return e.$$set=e=>{"size"in e&&n(4,r=e.size),"width"in e&&n(0,o=e.width),"height"in e&&n(1,a=e.height),"color"in e&&n(2,i=e.color),"viewBox"in e&&n(3,s=e.viewBox)},[o,a,i,s,r]}class AlarmSnooze extends SvelteComponent{constructor(e){super(),init(this,e,instance$A,create_fragment$A,safe_not_equal,{size:4,width:0,height:1,color:2,viewBox:3})}}function create_fragment$z(e){let t,n;return{c(){t=svg_element("svg"),n=svg_element("path"),attr(n,"d","M8,3.28L6.6,1.86L5.74,2.57L7.16,4M16.47,18.39C15.26,19.39 13.7,20 12,20A7,7 0 0,1 5,13C5,11.3 5.61,9.74 6.61,8.53M2.92,2.29L1.65,3.57L3,4.9L1.87,5.83L3.29,7.25L4.4,6.31L5.2,7.11C3.83,8.69 3,10.75 3,13A9,9 0 0,0 12,22C14.25,22 16.31,21.17 17.89,19.8L20.09,22L21.36,20.73L3.89,3.27L2.92,2.29M22,5.72L17.4,1.86L16.11,3.39L20.71,7.25L22,5.72M12,6A7,7 0 0,1 19,13C19,13.84 18.84,14.65 18.57,15.4L20.09,16.92C20.67,15.73 21,14.41 21,13A9,9 0 0,0 12,4C10.59,4 9.27,4.33 8.08,4.91L9.6,6.43C10.35,6.16 11.16,6 12,6Z"),attr(n,"fill",e[2]),attr(t,"width",e[0]),attr(t,"height",e[1]),attr(t,"viewBox",e[3])},m(e,r){insert(e,t,r),append(t,n)},p(e,[r]){4&r&&attr(n,"fill",e[2]),1&r&&attr(t,"width",e[0]),2&r&&attr(t,"height",e[1]),8&r&&attr(t,"viewBox",e[3])},i:noop,o:noop,d(e){e&&detach(t)}}}function instance$z(e,t,n){let{size:r="1em"}=t,{width:o=r}=t,{height:a=r}=t,{color:i="currentColor"}=t,{viewBox:s="0 0 24 24"}=t;return e.$$set=e=>{"size"in e&&n(4,r=e.size),"width"in e&&n(0,o=e.width),"height"in e&&n(1,a=e.height),"color"in e&&n(2,i=e.color),"viewBox"in e&&n(3,s=e.viewBox)},[o,a,i,s,r]}class AlarmOff extends SvelteComponent{constructor(e){super(),init(this,e,instance$z,create_fragment$z,safe_not_equal,{size:4,width:0,height:1,color:2,viewBox:3})}}function get_each_context$3(e,t,n){const r=e.slice();return r[6]=t[n],r[8]=n,r}function create_each_block$3(e){let t,n,r=e[6]+"";return{c(){t=element("option"),n=text(r),t.__value=e[8],t.value=t.__value},m(e,r){insert(e,t,r),append(t,n)},p(e,t){2&t&&r!==(r=e[6]+"")&&set_data(n,r)},d(e){e&&detach(t)}}}function create_fragment$y(e){let t,n,r,o=e[1],a=[];for(let t=0;t<o.length;t+=1)a[t]=create_each_block$3(get_each_context$3(e,o,t));return{c(){t=element("select");for(let e=0;e<a.length;e+=1)a[e].c();attr(t,"name","collection"),void 0===e[0]&&add_render_callback((()=>e[3].call(t)))},m(o,i){insert(o,t,i);for(let e=0;e<a.length;e+=1)a[e].m(t,null);select_option(t,e[0]),n||(r=[listen(t,"change",e[3]),listen(t,"change",e[2])],n=!0)},p(e,[n]){if(2&n){let r;for(o=e[1],r=0;r<o.length;r+=1){const i=get_each_context$3(e,o,r);a[r]?a[r].p(i,n):(a[r]=create_each_block$3(i),a[r].c(),a[r].m(t,null))}for(;r<a.length;r+=1)a[r].d(1);a.length=o.length}1&n&&select_option(t,e[0])},i:noop,o:noop,d(e){e&&detach(t),destroy_each(a,e),n=!1,run_all(r)}}}function instance$y(e,t,n){let r;component_subscribe(e,selectedCollection,(e=>n(4,r=e)));let{selected:o=0}=t,a=[];return onDestroy(collections.subscribe((e=>{e&&n(1,a=e.names)}))),e.$$set=e=>{"selected"in e&&n(0,o=e.selected)},[o,a,function(){set_store_value(selectedCollection,r=o,r)},function(){o=select_value(this),n(0,o)}]}class CollectionSelector extends SvelteComponent{constructor(e){super(),init(this,e,instance$y,create_fragment$y,safe_not_equal,{selected:0})}}function create_fragment$x(e){let t,n;return{c(){t=svg_element("svg"),n=svg_element("path"),attr(n,"d","M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M10,16.5L16,12L10,7.5V16.5Z"),attr(n,"fill",e[2]),attr(t,"width",e[0]),attr(t,"height",e[1]),attr(t,"viewBox",e[3])},m(e,r){insert(e,t,r),append(t,n)},p(e,[r]){4&r&&attr(n,"fill",e[2]),1&r&&attr(t,"width",e[0]),2&r&&attr(t,"height",e[1]),8&r&&attr(t,"viewBox",e[3])},i:noop,o:noop,d(e){e&&detach(t)}}}function instance$x(e,t,n){let{size:r="1em"}=t,{width:o=r}=t,{height:a=r}=t,{color:i="currentColor"}=t,{viewBox:s="0 0 24 24"}=t;return e.$$set=e=>{"size"in e&&n(4,r=e.size),"width"in e&&n(0,o=e.width),"height"in e&&n(1,a=e.height),"color"in e&&n(2,i=e.color),"viewBox"in e&&n(3,s=e.viewBox)},[o,a,i,s,r]}!function(e){e[e.FileCached=0]="FileCached",e[e.FileDeleted=1]="FileDeleted"}(EventType||(EventType={}));class PlayCircleOutline extends SvelteComponent{constructor(e){super(),init(this,e,instance$x,create_fragment$x,safe_not_equal,{size:4,width:0,height:1,color:2,viewBox:3})}}function create_fragment$w(e){let t,n;return{c(){t=svg_element("svg"),n=svg_element("path"),attr(n,"d","M19 17H22L18 21L14 17H17V3H19M11 13V15L7.67 19H11V21H5V19L8.33 15H5V13M9 3H7C5.9 3 5 3.9 5 5V11H7V9H9V11H11V5C11 3.9 10.11 3 9 3M9 7H7V5H9Z"),attr(n,"fill",e[2]),attr(t,"width",e[0]),attr(t,"height",e[1]),attr(t,"viewBox",e[3])},m(e,r){insert(e,t,r),append(t,n)},p(e,[r]){4&r&&attr(n,"fill",e[2]),1&r&&attr(t,"width",e[0]),2&r&&attr(t,"height",e[1]),8&r&&attr(t,"viewBox",e[3])},i:noop,o:noop,d(e){e&&detach(t)}}}function instance$w(e,t,n){let{size:r="1em"}=t,{width:o=r}=t,{height:a=r}=t,{color:i="currentColor"}=t,{viewBox:s="0 0 24 24"}=t;return e.$$set=e=>{"size"in e&&n(4,r=e.size),"width"in e&&n(0,o=e.width),"height"in e&&n(1,a=e.height),"color"in e&&n(2,i=e.color),"viewBox"in e&&n(3,s=e.viewBox)},[o,a,i,s,r]}class SortAlphabeticalAscending extends SvelteComponent{constructor(e){super(),init(this,e,instance$w,create_fragment$w,safe_not_equal,{size:4,width:0,height:1,color:2,viewBox:3})}}function create_fragment$v(e){let t,n;return{c(){t=svg_element("svg"),n=svg_element("path"),attr(n,"d","M20 17H23L19 21L15 17H18V3H20V17M8 5C4.14 5 1 8.13 1 12C1 15.87 4.13 19 8 19C11.86 19 15 15.87 15 12C15 8.13 11.87 5 8 5M8 7.15C10.67 7.15 12.85 9.32 12.85 12C12.85 14.68 10.68 16.85 8 16.85C5.32 16.85 3.15 14.68 3.15 12C3.15 9.32 5.32 7.15 8 7.15M7 9V12.69L10.19 14.53L10.94 13.23L8.5 11.82V9"),attr(n,"fill",e[2]),attr(t,"width",e[0]),attr(t,"height",e[1]),attr(t,"viewBox",e[3])},m(e,r){insert(e,t,r),append(t,n)},p(e,[r]){4&r&&attr(n,"fill",e[2]),1&r&&attr(t,"width",e[0]),2&r&&attr(t,"height",e[1]),8&r&&attr(t,"viewBox",e[3])},i:noop,o:noop,d(e){e&&detach(t)}}}function instance$v(e,t,n){let{size:r="1em"}=t,{width:o=r}=t,{height:a=r}=t,{color:i="currentColor"}=t,{viewBox:s="0 0 24 24"}=t;return e.$$set=e=>{"size"in e&&n(4,r=e.size),"width"in e&&n(0,o=e.width),"height"in e&&n(1,a=e.height),"color"in e&&n(2,i=e.color),"viewBox"in e&&n(3,s=e.viewBox)},[o,a,i,s,r]}class SortClockAscendingOutline extends SvelteComponent{constructor(e){super(),init(this,e,instance$v,create_fragment$v,safe_not_equal,{size:4,width:0,height:1,color:2,viewBox:3})}}function create_fragment$u(e){let t,n;return{c(){t=svg_element("svg"),n=svg_element("path"),attr(n,"d","M12,18L7,13H10V9H14V13H17L12,18M10,2H14A2,2 0 0,1 16,4V6H20A2,2 0 0,1 22,8V19A2,2 0 0,1 20,21H4C2.89,21 2,20.1 2,19V8C2,6.89 2.89,6 4,6H8V4C8,2.89 8.89,2 10,2M14,6V4H10V6H14M4,8V19H20V8H4Z"),attr(n,"fill",e[2]),attr(t,"width",e[0]),attr(t,"height",e[1]),attr(t,"viewBox",e[3])},m(e,r){insert(e,t,r),append(t,n)},p(e,[r]){4&r&&attr(n,"fill",e[2]),1&r&&attr(t,"width",e[0]),2&r&&attr(t,"height",e[1]),8&r&&attr(t,"viewBox",e[3])},i:noop,o:noop,d(e){e&&detach(t)}}}function instance$u(e,t,n){let{size:r="1em"}=t,{width:o=r}=t,{height:a=r}=t,{color:i="currentColor"}=t,{viewBox:s="0 0 24 24"}=t;return e.$$set=e=>{"size"in e&&n(4,r=e.size),"width"in e&&n(0,o=e.width),"height"in e&&n(1,a=e.height),"color"in e&&n(2,i=e.color),"viewBox"in e&&n(3,s=e.viewBox)},[o,a,i,s,r]}class BriefcaseDownloadOutline extends SvelteComponent{constructor(e){super(),init(this,e,instance$u,create_fragment$u,safe_not_equal,{size:4,width:0,height:1,color:2,viewBox:3})}}function create_fragment$t(e){let t,n;return{c(){t=svg_element("svg"),n=svg_element("path"),attr(n,"d","M12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22C6.47,22 2,17.5 2,12A10,10 0 0,1 12,2M12.5,7V12.25L17,14.92L16.25,16.15L11,13V7H12.5Z"),attr(n,"fill",e[2]),attr(t,"width",e[0]),attr(t,"height",e[1]),attr(t,"viewBox",e[3])},m(e,r){insert(e,t,r),append(t,n)},p(e,[r]){4&r&&attr(n,"fill",e[2]),1&r&&attr(t,"width",e[0]),2&r&&attr(t,"height",e[1]),8&r&&attr(t,"viewBox",e[3])},i:noop,o:noop,d(e){e&&detach(t)}}}function instance$t(e,t,n){let{size:r="1em"}=t,{width:o=r}=t,{height:a=r}=t,{color:i="currentColor"}=t,{viewBox:s="0 0 24 24"}=t;return e.$$set=e=>{"size"in e&&n(4,r=e.size),"width"in e&&n(0,o=e.width),"height"in e&&n(1,a=e.height),"color"in e&&n(2,i=e.color),"viewBox"in e&&n(3,s=e.viewBox)},[o,a,i,s,r]}class ClockOutline extends SvelteComponent{constructor(e){super(),init(this,e,instance$t,create_fragment$t,safe_not_equal,{size:4,width:0,height:1,color:2,viewBox:3})}}class PlayItem{constructor(e){var t;this.checkNeedsTranscoding(e.file),this.url=this.constructURL(e.file,e.collection),this.duration=null===(t=e.file.meta)||void 0===t?void 0:t.duration,this.name=e.file.name,this.path=e.file.path,this.cached=e.file.cached,this.position=e.position,this.startPlay=e.startPlay,this.time=e.time,this.mime=e.file.mime}checkNeedsTranscoding(e){const t=get_store_value(selectedTranscodingDetails),n=get_store_value(config);if(n.alwaysTranscode&&n.alwaysTranscode.indexOf(e.mime)>=0)return this.transcoding=t.code!=TranscodingCode.None?TranscodingCode.Medium:t.code,void(this.transcoded=!0);const r=n.transcodingTolerance;t.code!=TranscodingCode.None&&t.bitrate>0&&e.meta&&e.meta.bitrate>t.bitrate*(1+r)&&(this.transcoding=t.code,this.transcoded=!0)}constructURL(e,t){let n=get_store_value(apiConfig).basePath+"/"+(null!=t?t:get_store_value(selectedCollection))+"/audio/"+encodeURI(e.path);const r=new URLSearchParams;this.transcoding&&r.append("trans",this.transcoding);const o=r.toString();return o&&(n+="?"+o),n}createMediaSourceUrl(){const e=new MediaSource;return e.addEventListener("sourceopen",(t=>{console.debug("Media source opened",t),fetch(this.url,{credentials:"include"}).then((t=>{if(t.status>=400)throw new Error("Error response from server: "+t.status);let n=t.headers.get("Content-Type");if(!MediaSource.isTypeSupported(n))throw new Error(`Mime type ${n} is not supported as MediaSource`);const r=e.addSourceBuffer(n),o=t.body.getReader();let a=({done:e,value:t})=>{e?console.debug("End of stream for "+this.url):(console.debug(`Read ${t.length} bytes`),r.appendBuffer(t))};o.read().then(a),r.addEventListener("updateend",(()=>o.read().then(a))),r.addEventListener("error",(e=>{console.error("Media stream error",e)}))})).catch((t=>{console.error("Media source error",t),e.endOfStream("network")}))})),URL.createObjectURL(e)}}function formatTime(e){if(!isFinite(e))return"?";let t=0,n=Math.floor(e/60),r=Math.floor(e%60);return r=("0"+r).slice(-2),n>=60&&(t=Math.floor(n/60),n-=60*t,n=("0"+n).slice(-2)),t?`${t}:${n}:${r}`:`${n}:${r}`}const formatter=new Intl.RelativeTimeFormat(void 0,{numeric:"auto"}),DIVISIONS=[{amount:60,name:"seconds"},{amount:60,name:"minutes"},{amount:24,name:"hours"},{amount:7,name:"days"},{amount:4.34524,name:"weeks"},{amount:12,name:"months"},{amount:Number.POSITIVE_INFINITY,name:"years"}];function formatTimeAgo(e){let t=(Date.now()-e)/1e3;for(let e=0;e<=DIVISIONS.length;e++){const n=DIVISIONS[e];if(Math.abs(t)<n.amount)return formatter.format(-Math.round(t),n.name);t/=n.amount}}function create_fragment$s(e){let t,n;return{c(){t=svg_element("svg"),n=svg_element("path"),attr(n,"d","M19,8L15,12H18A6,6 0 0,1 12,18C11,18 10.03,17.75 9.2,17.3L7.74,18.76C8.97,19.54 10.43,20 12,20A8,8 0 0,0 20,12H23M6,12A6,6 0 0,1 12,6C13,6 13.97,6.25 14.8,6.7L16.26,5.24C15.03,4.46 13.57,4 12,4A8,8 0 0,0 4,12H1L5,16L9,12"),attr(n,"fill",e[2]),attr(t,"width",e[0]),attr(t,"height",e[1]),attr(t,"viewBox",e[3])},m(e,r){insert(e,t,r),append(t,n)},p(e,[r]){4&r&&attr(n,"fill",e[2]),1&r&&attr(t,"width",e[0]),2&r&&attr(t,"height",e[1]),8&r&&attr(t,"viewBox",e[3])},i:noop,o:noop,d(e){e&&detach(t)}}}function instance$s(e,t,n){let{size:r="1em"}=t,{width:o=r}=t,{height:a=r}=t,{color:i="currentColor"}=t,{viewBox:s="0 0 24 24"}=t;return e.$$set=e=>{"size"in e&&n(4,r=e.size),"width"in e&&n(0,o=e.width),"height"in e&&n(1,a=e.height),"color"in e&&n(2,i=e.color),"viewBox"in e&&n(3,s=e.viewBox)},[o,a,i,s,r]}class Cached extends SvelteComponent{constructor(e){super(),init(this,e,instance$s,create_fragment$s,safe_not_equal,{size:4,width:0,height:1,color:2,viewBox:3})}}function create_fragment$r(e){let t,n;return{c(){t=svg_element("svg"),n=svg_element("path"),attr(n,"d","M8,5.14V19.14L19,12.14L8,5.14Z"),attr(n,"fill",e[2]),attr(t,"width",e[0]),attr(t,"height",e[1]),attr(t,"viewBox",e[3])},m(e,r){insert(e,t,r),append(t,n)},p(e,[r]){4&r&&attr(n,"fill",e[2]),1&r&&attr(t,"width",e[0]),2&r&&attr(t,"height",e[1]),8&r&&attr(t,"viewBox",e[3])},i:noop,o:noop,d(e){e&&detach(t)}}}function instance$r(e,t,n){let{size:r="1em"}=t,{width:o=r}=t,{height:a=r}=t,{color:i="currentColor"}=t,{viewBox:s="0 0 24 24"}=t;return e.$$set=e=>{"size"in e&&n(4,r=e.size),"width"in e&&n(0,o=e.width),"height"in e&&n(1,a=e.height),"color"in e&&n(2,i=e.color),"viewBox"in e&&n(3,s=e.viewBox)},[o,a,i,s,r]}class Play extends SvelteComponent{constructor(e){super(),init(this,e,instance$r,create_fragment$r,safe_not_equal,{size:4,width:0,height:1,color:2,viewBox:3})}}function create_if_block_3$3(e){let t,n,r;return n=new Play({props:{size:"2rem"}}),{c(){t=element("div"),create_component(n.$$.fragment),attr(t,"aria-label","Now playing")},m(e,o){insert(e,t,o),mount_component(n,t,null),r=!0},i(e){r||(transition_in(n.$$.fragment,e),r=!0)},o(e){transition_out(n.$$.fragment,e),r=!1},d(e){e&&detach(t),destroy_component(n)}}}function create_if_block_2$3(e){let t,n;return{c(){t=element("h6"),n=text(e[5]),attr(t,"class","title svelte-1xgc6as")},m(e,r){insert(e,t,r),append(t,n)},p(e,t){32&t&&set_data(n,e[5])},d(e){e&&detach(t)}}}function create_if_block_1$3(e){let t,n;return{c(){t=element("span"),n=text(e[7]),attr(t,"class","extension svelte-1xgc6as")},m(e,r){insert(e,t,r),append(t,n)},p(e,t){128&t&&set_data(n,e[7])},d(e){e&&detach(t)}}}function create_if_block$6(e){let t,n,r;return n=new Cached({props:{size:"1.2em"}}),{c(){t=element("span"),create_component(n.$$.fragment),attr(t,"aria-label","Cached")},m(e,o){insert(e,t,o),mount_component(n,t,null),r=!0},i(e){r||(transition_in(n.$$.fragment,e),r=!0)},o(e){transition_out(n.$$.fragment,e),r=!1},d(e){e&&detach(t),destroy_component(n)}}}function create_fragment$q(e){let t,n,r,o,a,i,s,l,c,u,d,p,h,m,_,f,g,b,w,v,y,k=e[0].meta?.bitrate+"",$=e[4]&&create_if_block_3$3(),x=e[5]&&create_if_block_2$3(e),S=e[7]&&create_if_block_1$3(e),C=e[0].cached&&create_if_block$6();return{c(){t=element("li"),n=element("div"),$&&$.c(),r=space(),o=element("div"),a=element("h4"),i=text(e[6]),s=space(),x&&x.c(),l=space(),c=element("div"),u=element("span"),d=text(e[8]),p=space(),h=element("span"),m=text(k),_=text("kbps"),f=space(),S&&S.c(),g=space(),b=element("div"),C&&C.c(),attr(a,"class","file-name item-header svelte-1xgc6as"),attr(a,"role","link"),attr(u,"class","time svelte-1xgc6as"),attr(h,"class","bitrate svelte-1xgc6as"),attr(c,"class","meta svelte-1xgc6as"),attr(o,"class","info svelte-1xgc6as"),attr(b,"class","icons svelte-1xgc6as"),attr(n,"class","item svelte-1xgc6as"),toggle_class(n,"active",e[4])},m(k,A){insert(k,t,A),append(t,n),$&&$.m(n,null),append(n,r),append(n,o),append(o,a),append(a,i),append(o,s),x&&x.m(o,null),append(o,l),append(o,c),append(c,u),append(u,d),append(c,p),append(c,h),append(h,m),append(h,_),append(c,f),S&&S.m(c,null),append(n,g),append(n,b),C&&C.m(b,null),e[17](n),w=!0,v||(y=listen(t,"click",e[18]),v=!0)},p(e,[t]){e[4]?$?16&t&&transition_in($,1):($=create_if_block_3$3(),$.c(),transition_in($,1),$.m(n,r)):$&&(group_outros(),transition_out($,1,1,(()=>{$=null})),check_outros()),(!w||64&t)&&set_data(i,e[6]),e[5]?x?x.p(e,t):(x=create_if_block_2$3(e),x.c(),x.m(o,l)):x&&(x.d(1),x=null),(!w||256&t)&&set_data(d,e[8]),(!w||1&t)&&k!==(k=e[0].meta?.bitrate+"")&&set_data(m,k),e[7]?S?S.p(e,t):(S=create_if_block_1$3(e),S.c(),S.m(c,null)):S&&(S.d(1),S=null),e[0].cached?C?1&t&&transition_in(C,1):(C=create_if_block$6(),C.c(),transition_in(C,1),C.m(b,null)):C&&(group_outros(),transition_out(C,1,1,(()=>{C=null})),check_outros()),16&t&&toggle_class(n,"active",e[4])},i(e){w||(transition_in($),transition_in(C),w=!0)},o(e){transition_out($),transition_out(C),w=!1},d(n){n&&detach(t),$&&$.d(),x&&x.d(),S&&S.d(),C&&C.d(),e[17](null),v=!1,y()}}}function instance$q(e,t,n){let r,o,a,i,s,l;var c,u;component_subscribe(e,selectedCollection,(e=>n(13,a=e))),component_subscribe(e,playList,(e=>n(14,i=e))),component_subscribe(e,currentFolder,(e=>n(15,s=e))),component_subscribe(e,playItem,(e=>n(16,l=e)));let d,p,h,m,_,{file:f}=t,{position:g}=t,{container:b}=t,{playFunction:w}=t;return e.$$set=e=>{"file"in e&&n(0,f=e.file),"position"in e&&n(1,g=e.position),"container"in e&&n(9,b=e.container),"playFunction"in e&&n(2,w=e.playFunction)},e.$$.update=()=>{512&e.$$.dirty&&n(12,r=b?new Scroller(b):null),3073&e.$$.dirty&&(n(6,({baseName:p,extension:h}=splitExtInName(f)),p,(n(7,h),n(0,f),n(10,c),n(11,u))),n(5,d=function(e){let t=null==e?void 0:e.title;if(t&&t!=p&&t!=p.replace("_"," "))return t}(null===n(10,c=f.meta)||void 0===c?void 0:c.tags)),n(8,m=formatTime(null===n(11,u=f.meta)||void 0===u?void 0:u.duration))),122883&e.$$.dirty&&n(4,o=l&&i&&l.position===g&&l.path===f.path&&i.folder===s.value&&s.type===FolderType.REGULAR&&i.collection===a),4120&e.$$.dirty&&o&&_&&r&&r.scrollToView(_)},[f,g,w,_,o,d,p,h,m,b,c,u,r,a,i,s,l,function(e){binding_callbacks[e?"unshift":"push"]((()=>{_=e,n(3,_)}))},()=>w(g,!0,0)]}class FileItem extends SvelteComponent{constructor(e){super(),init(this,e,instance$q,create_fragment$q,safe_not_equal,{file:0,position:1,container:9,playFunction:2})}}function create_if_block$5(e){let t,n;return{c(){t=element("h6"),n=text(e[3]),attr(t,"class","subtitle svelte-8in5mn")},m(e,r){insert(e,t,r),append(t,n)},p(e,t){8&t&&set_data(n,e[3])},d(e){e&&detach(t)}}}function create_fragment$p(e){let t,n,r,o,a=e[0].name+"",i=e[1]&&e[3]&&create_if_block$5(e);return{c(){t=element("div"),n=element("h4"),r=text(a),o=space(),i&&i.c(),attr(n,"class","title item-header svelte-8in5mn"),attr(n,"role","link"),toggle_class(n,"finished",e[2])},m(e,a){insert(e,t,a),append(t,n),append(n,r),append(t,o),i&&i.m(t,null)},p(e,[o]){1&o&&a!==(a=e[0].name+"")&&set_data(r,a),4&o&&toggle_class(n,"finished",e[2]),e[1]&&e[3]?i?i.p(e,o):(i=create_if_block$5(e),i.c(),i.m(t,null)):i&&(i.d(1),i=null)},i:noop,o:noop,d(e){e&&detach(t),i&&i.d()}}}function instance$p(e,t,n){let r,{subfolder:o}=t,{extended:a=!1}=t,{finished:i=!1}=t;return beforeUpdate((()=>{n(3,r=splitPath(o.path).folder)})),e.$$set=e=>{"subfolder"in e&&n(0,o=e.subfolder),"extended"in e&&n(1,a=e.extended),"finished"in e&&n(2,i=e.finished)},[o,a,i,r]}class FolderItem extends SvelteComponent{constructor(e){super(),init(this,e,instance$p,create_fragment$p,safe_not_equal,{subfolder:0,extended:1,finished:2})}}var showdown=createCommonjsModule((function(e){(function(){function t(e){var t={omitExtraWLInCodeBlocks:{defaultValue:!1,describe:"Omit the default extra whiteline added to code blocks",type:"boolean"},noHeaderId:{defaultValue:!1,describe:"Turn on/off generated header id",type:"boolean"},prefixHeaderId:{defaultValue:!1,describe:"Add a prefix to the generated header ids. Passing a string will prefix that string to the header id. Setting to true will add a generic 'section-' prefix",type:"string"},rawPrefixHeaderId:{defaultValue:!1,describe:'Setting this option to true will prevent showdown from modifying the prefix. This might result in malformed IDs (if, for instance, the " char is used in the prefix)',type:"boolean"},ghCompatibleHeaderId:{defaultValue:!1,describe:"Generate header ids compatible with github style (spaces are replaced with dashes, a bunch of non alphanumeric chars are removed)",type:"boolean"},rawHeaderId:{defaultValue:!1,describe:"Remove only spaces, ' and \" from generated header ids (including prefixes), replacing them with dashes (-). WARNING: This might result in malformed ids",type:"boolean"},headerLevelStart:{defaultValue:!1,describe:"The header blocks level start",type:"integer"},parseImgDimensions:{defaultValue:!1,describe:"Turn on/off image dimension parsing",type:"boolean"},simplifiedAutoLink:{defaultValue:!1,describe:"Turn on/off GFM autolink style",type:"boolean"},excludeTrailingPunctuationFromURLs:{defaultValue:!1,describe:"Excludes trailing punctuation from links generated with autoLinking",type:"boolean"},literalMidWordUnderscores:{defaultValue:!1,describe:"Parse midword underscores as literal underscores",type:"boolean"},literalMidWordAsterisks:{defaultValue:!1,describe:"Parse midword asterisks as literal asterisks",type:"boolean"},strikethrough:{defaultValue:!1,describe:"Turn on/off strikethrough support",type:"boolean"},tables:{defaultValue:!1,describe:"Turn on/off tables support",type:"boolean"},tablesHeaderId:{defaultValue:!1,describe:"Add an id to table headers",type:"boolean"},ghCodeBlocks:{defaultValue:!0,describe:"Turn on/off GFM fenced code blocks support",type:"boolean"},tasklists:{defaultValue:!1,describe:"Turn on/off GFM tasklist support",type:"boolean"},smoothLivePreview:{defaultValue:!1,describe:"Prevents weird effects in live previews due to incomplete input",type:"boolean"},smartIndentationFix:{defaultValue:!1,describe:"Tries to smartly fix indentation in es6 strings",type:"boolean"},disableForced4SpacesIndentedSublists:{defaultValue:!1,describe:"Disables the requirement of indenting nested sublists by 4 spaces",type:"boolean"},simpleLineBreaks:{defaultValue:!1,describe:"Parses simple line breaks as <br> (GFM Style)",type:"boolean"},requireSpaceBeforeHeadingText:{defaultValue:!1,describe:"Makes adding a space between `#` and the header text mandatory (GFM Style)",type:"boolean"},ghMentions:{defaultValue:!1,describe:"Enables github @mentions",type:"boolean"},ghMentionsLink:{defaultValue:"https://github.com/{u}",describe:"Changes the link generated by @mentions. Only applies if ghMentions option is enabled.",type:"string"},encodeEmails:{defaultValue:!0,describe:"Encode e-mail addresses through the use of Character Entities, transforming ASCII e-mail addresses into its equivalent decimal entities",type:"boolean"},openLinksInNewWindow:{defaultValue:!1,describe:"Open all links in new windows",type:"boolean"},backslashEscapesHTMLTags:{defaultValue:!1,describe:"Support for HTML Tag escaping. ex: <div>foo</div>",type:"boolean"},emoji:{defaultValue:!1,describe:"Enable emoji support. Ex: `this is a :smile: emoji`",type:"boolean"},underline:{defaultValue:!1,describe:"Enable support for underline. Syntax is double or triple underscores: `__underline word__`. With this option enabled, underscores no longer parses into `<em>` and `<strong>`",type:"boolean"},ellipsis:{defaultValue:!0,describe:"Replaces three dots with the ellipsis unicode character",type:"boolean"},completeHTMLDocument:{defaultValue:!1,describe:"Outputs a complete html document, including `<html>`, `<head>` and `<body>` tags",type:"boolean"},metadata:{defaultValue:!1,describe:"Enable support for document metadata (defined at the top of the document between `«««` and `»»»` or between `---` and `---`).",type:"boolean"},splitAdjacentBlockquotes:{defaultValue:!1,describe:"Split adjacent blockquote blocks",type:"boolean"}};if(!1===e)return JSON.parse(JSON.stringify(t));var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r].defaultValue);return n}var n={},r={},o={},a=t(!0),i="vanilla",s={github:{omitExtraWLInCodeBlocks:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,disableForced4SpacesIndentedSublists:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghCompatibleHeaderId:!0,ghMentions:!0,backslashEscapesHTMLTags:!0,emoji:!0,splitAdjacentBlockquotes:!0},original:{noHeaderId:!0,ghCodeBlocks:!1},ghost:{omitExtraWLInCodeBlocks:!0,parseImgDimensions:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,smoothLivePreview:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghMentions:!1,encodeEmails:!0},vanilla:t(!0),allOn:function(){var e=t(!0),n={};for(var r in e)e.hasOwnProperty(r)&&(n[r]=!0);return n}()};function l(e,t){var r=t?"Error in "+t+" extension->":"Error in unnamed extension",o={valid:!0,error:""};n.helper.isArray(e)||(e=[e]);for(var a=0;a<e.length;++a){var i=r+" sub-extension "+a+": ",s=e[a];if("object"!=typeof s)return o.valid=!1,o.error=i+"must be an object, but "+typeof s+" given",o;if(!n.helper.isString(s.type))return o.valid=!1,o.error=i+'property "type" must be a string, but '+typeof s.type+" given",o;var l=s.type=s.type.toLowerCase();if("language"===l&&(l=s.type="lang"),"html"===l&&(l=s.type="output"),"lang"!==l&&"output"!==l&&"listener"!==l)return o.valid=!1,o.error=i+"type "+l+' is not recognized. Valid values: "lang/language", "output/html" or "listener"',o;if("listener"===l){if(n.helper.isUndefined(s.listeners))return o.valid=!1,o.error=i+'. Extensions of type "listener" must have a property called "listeners"',o}else if(n.helper.isUndefined(s.filter)&&n.helper.isUndefined(s.regex))return o.valid=!1,o.error=i+l+' extensions must define either a "regex" property or a "filter" method',o;if(s.listeners){if("object"!=typeof s.listeners)return o.valid=!1,o.error=i+'"listeners" property must be an object but '+typeof s.listeners+" given",o;for(var c in s.listeners)if(s.listeners.hasOwnProperty(c)&&"function"!=typeof s.listeners[c])return o.valid=!1,o.error=i+'"listeners" property must be an hash of [event name]: [callback]. listeners.'+c+" must be a function but "+typeof s.listeners[c]+" given",o}if(s.filter){if("function"!=typeof s.filter)return o.valid=!1,o.error=i+'"filter" must be a function, but '+typeof s.filter+" given",o}else if(s.regex){if(n.helper.isString(s.regex)&&(s.regex=new RegExp(s.regex,"g")),!(s.regex instanceof RegExp))return o.valid=!1,o.error=i+'"regex" property must either be a string or a RegExp object, but '+typeof s.regex+" given",o;if(n.helper.isUndefined(s.replace))return o.valid=!1,o.error=i+'"regex" extensions must implement a replace string or function',o}}return o}function c(e,t){return"¨E"+t.charCodeAt(0)+"E"}n.helper={},n.extensions={},n.setOption=function(e,t){return a[e]=t,this},n.getOption=function(e){return a[e]},n.getOptions=function(){return a},n.resetOptions=function(){a=t(!0)},n.setFlavor=function(e){if(!s.hasOwnProperty(e))throw Error(e+" flavor was not found");n.resetOptions();var t=s[e];for(var r in i=e,t)t.hasOwnProperty(r)&&(a[r]=t[r])},n.getFlavor=function(){return i},n.getFlavorOptions=function(e){if(s.hasOwnProperty(e))return s[e]},n.getDefaultOptions=function(e){return t(e)},n.subParser=function(e,t){if(n.helper.isString(e)){if(void 0===t){if(r.hasOwnProperty(e))return r[e];throw Error("SubParser named "+e+" not registered!")}r[e]=t}},n.extension=function(e,t){if(!n.helper.isString(e))throw Error("Extension 'name' must be a string");if(e=n.helper.stdExtName(e),n.helper.isUndefined(t)){if(!o.hasOwnProperty(e))throw Error("Extension named "+e+" is not registered!");return o[e]}"function"==typeof t&&(t=t()),n.helper.isArray(t)||(t=[t]);var r=l(t,e);if(!r.valid)throw Error(r.error);o[e]=t},n.getAllExtensions=function(){return o},n.removeExtension=function(e){delete o[e]},n.resetExtensions=function(){o={}},n.validateExtension=function(e){var t=l(e,null);return!!t.valid||(console.warn(t.error),!1)},n.hasOwnProperty("helper")||(n.helper={}),n.helper.isString=function(e){return"string"==typeof e||e instanceof String},n.helper.isFunction=function(e){return e&&"[object Function]"==={}.toString.call(e)},n.helper.isArray=function(e){return Array.isArray(e)},n.helper.isUndefined=function(e){return void 0===e},n.helper.forEach=function(e,t){if(n.helper.isUndefined(e))throw new Error("obj param is required");if(n.helper.isUndefined(t))throw new Error("callback param is required");if(!n.helper.isFunction(t))throw new Error("callback param must be a function/closure");if("function"==typeof e.forEach)e.forEach(t);else if(n.helper.isArray(e))for(var r=0;r<e.length;r++)t(e[r],r,e);else{if("object"!=typeof e)throw new Error("obj does not seem to be an array or an iterable object");for(var o in e)e.hasOwnProperty(o)&&t(e[o],o,e)}},n.helper.stdExtName=function(e){return e.replace(/[_?*+\/\\.^-]/g,"").replace(/\s/g,"").toLowerCase()},n.helper.escapeCharactersCallback=c,n.helper.escapeCharacters=function(e,t,n){var r="(["+t.replace(/([\[\]\\])/g,"\\$1")+"])";n&&(r="\\\\"+r);var o=new RegExp(r,"g");return e=e.replace(o,c)},n.helper.unescapeHTMLEntities=function(e){return e.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")};var u=function(e,t,n,r){var o,a,i,s,l,c=r||"",u=c.indexOf("g")>-1,d=new RegExp(t+"|"+n,"g"+c.replace(/g/g,"")),p=new RegExp(t,c.replace(/g/g,"")),h=[];do{for(o=0;i=d.exec(e);)if(p.test(i[0]))o++||(s=(a=d.lastIndex)-i[0].length);else if(o&&!--o){l=i.index+i[0].length;var m={left:{start:s,end:a},match:{start:a,end:i.index},right:{start:i.index,end:l},wholeMatch:{start:s,end:l}};if(h.push(m),!u)return h}}while(o&&(d.lastIndex=a));return h};n.helper.matchRecursiveRegExp=function(e,t,n,r){for(var o=u(e,t,n,r),a=[],i=0;i<o.length;++i)a.push([e.slice(o[i].wholeMatch.start,o[i].wholeMatch.end),e.slice(o[i].match.start,o[i].match.end),e.slice(o[i].left.start,o[i].left.end),e.slice(o[i].right.start,o[i].right.end)]);return a},n.helper.replaceRecursiveRegExp=function(e,t,r,o,a){if(!n.helper.isFunction(t)){var i=t;t=function(){return i}}var s=u(e,r,o,a),l=e,c=s.length;if(c>0){var d=[];0!==s[0].wholeMatch.start&&d.push(e.slice(0,s[0].wholeMatch.start));for(var p=0;p<c;++p)d.push(t(e.slice(s[p].wholeMatch.start,s[p].wholeMatch.end),e.slice(s[p].match.start,s[p].match.end),e.slice(s[p].left.start,s[p].left.end),e.slice(s[p].right.start,s[p].right.end))),p<c-1&&d.push(e.slice(s[p].wholeMatch.end,s[p+1].wholeMatch.start));s[c-1].wholeMatch.end<e.length&&d.push(e.slice(s[c-1].wholeMatch.end)),l=d.join("")}return l},n.helper.regexIndexOf=function(e,t,r){if(!n.helper.isString(e))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";if(t instanceof RegExp==!1)throw"InvalidArgumentError: second parameter of showdown.helper.regexIndexOf function must be an instance of RegExp";var o=e.substring(r||0).search(t);return o>=0?o+(r||0):o},n.helper.splitAtIndex=function(e,t){if(!n.helper.isString(e))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";return[e.substring(0,t),e.substring(t)]},n.helper.encodeEmailAddress=function(e){var t=[function(e){return"&#"+e.charCodeAt(0)+";"},function(e){return"&#x"+e.charCodeAt(0).toString(16)+";"},function(e){return e}];return e=e.replace(/./g,(function(e){if("@"===e)e=t[Math.floor(2*Math.random())](e);else{var n=Math.random();e=n>.9?t[2](e):n>.45?t[1](e):t[0](e)}return e}))},n.helper.padEnd=function(e,t,n){return t>>=0,n=String(n||" "),e.length>t?String(e):((t-=e.length)>n.length&&(n+=n.repeat(t/n.length)),String(e)+n.slice(0,t))},"undefined"==typeof console&&(console={warn:function(e){alert(e)},log:function(e){alert(e)},error:function(e){throw e}}),n.helper.regexes={asteriskDashAndColon:/([*_:~])/g},n.helper.emojis={"+1":"👍","-1":"👎",100:"💯",1234:"🔢","1st_place_medal":"🥇","2nd_place_medal":"🥈","3rd_place_medal":"🥉","8ball":"🎱",a:"🅰️",ab:"🆎",abc:"🔤",abcd:"🔡",accept:"🉑",aerial_tramway:"🚡",airplane:"✈️",alarm_clock:"⏰",alembic:"⚗️",alien:"👽",ambulance:"🚑",amphora:"🏺",anchor:"⚓️",angel:"👼",anger:"💢",angry:"😠",anguished:"😧",ant:"🐜",apple:"🍎",aquarius:"♒️",aries:"♈️",arrow_backward:"◀️",arrow_double_down:"⏬",arrow_double_up:"⏫",arrow_down:"⬇️",arrow_down_small:"🔽",arrow_forward:"▶️",arrow_heading_down:"⤵️",arrow_heading_up:"⤴️",arrow_left:"⬅️",arrow_lower_left:"↙️",arrow_lower_right:"↘️",arrow_right:"➡️",arrow_right_hook:"↪️",arrow_up:"⬆️",arrow_up_down:"↕️",arrow_up_small:"🔼",arrow_upper_left:"↖️",arrow_upper_right:"↗️",arrows_clockwise:"🔃",arrows_counterclockwise:"🔄",art:"🎨",articulated_lorry:"🚛",artificial_satellite:"🛰",astonished:"😲",athletic_shoe:"👟",atm:"🏧",atom_symbol:"⚛️",avocado:"🥑",b:"🅱️",baby:"👶",baby_bottle:"🍼",baby_chick:"🐤",baby_symbol:"🚼",back:"🔙",bacon:"🥓",badminton:"🏸",baggage_claim:"🛄",baguette_bread:"🥖",balance_scale:"⚖️",balloon:"🎈",ballot_box:"🗳",ballot_box_with_check:"☑️",bamboo:"🎍",banana:"🍌",bangbang:"‼️",bank:"🏦",bar_chart:"📊",barber:"💈",baseball:"⚾️",basketball:"🏀",basketball_man:"⛹️",basketball_woman:"⛹️&zwj;♀️",bat:"🦇",bath:"🛀",bathtub:"🛁",battery:"🔋",beach_umbrella:"🏖",bear:"🐻",bed:"🛏",bee:"🐝",beer:"🍺",beers:"🍻",beetle:"🐞",beginner:"🔰",bell:"🔔",bellhop_bell:"🛎",bento:"🍱",biking_man:"🚴",bike:"🚲",biking_woman:"🚴&zwj;♀️",bikini:"👙",biohazard:"☣️",bird:"🐦",birthday:"🎂",black_circle:"⚫️",black_flag:"🏴",black_heart:"🖤",black_joker:"🃏",black_large_square:"⬛️",black_medium_small_square:"◾️",black_medium_square:"◼️",black_nib:"✒️",black_small_square:"▪️",black_square_button:"🔲",blonde_man:"👱",blonde_woman:"👱&zwj;♀️",blossom:"🌼",blowfish:"🐡",blue_book:"📘",blue_car:"🚙",blue_heart:"💙",blush:"😊",boar:"🐗",boat:"⛵️",bomb:"💣",book:"📖",bookmark:"🔖",bookmark_tabs:"📑",books:"📚",boom:"💥",boot:"👢",bouquet:"💐",bowing_man:"🙇",bow_and_arrow:"🏹",bowing_woman:"🙇&zwj;♀️",bowling:"🎳",boxing_glove:"🥊",boy:"👦",bread:"🍞",bride_with_veil:"👰",bridge_at_night:"🌉",briefcase:"💼",broken_heart:"💔",bug:"🐛",building_construction:"🏗",bulb:"💡",bullettrain_front:"🚅",bullettrain_side:"🚄",burrito:"🌯",bus:"🚌",business_suit_levitating:"🕴",busstop:"🚏",bust_in_silhouette:"👤",busts_in_silhouette:"👥",butterfly:"🦋",cactus:"🌵",cake:"🍰",calendar:"📆",call_me_hand:"🤙",calling:"📲",camel:"🐫",camera:"📷",camera_flash:"📸",camping:"🏕",cancer:"♋️",candle:"🕯",candy:"🍬",canoe:"🛶",capital_abcd:"🔠",capricorn:"♑️",car:"🚗",card_file_box:"🗃",card_index:"📇",card_index_dividers:"🗂",carousel_horse:"🎠",carrot:"🥕",cat:"🐱",cat2:"🐈",cd:"💿",chains:"⛓",champagne:"🍾",chart:"💹",chart_with_downwards_trend:"📉",chart_with_upwards_trend:"📈",checkered_flag:"🏁",cheese:"🧀",cherries:"🍒",cherry_blossom:"🌸",chestnut:"🌰",chicken:"🐔",children_crossing:"🚸",chipmunk:"🐿",chocolate_bar:"🍫",christmas_tree:"🎄",church:"⛪️",cinema:"🎦",circus_tent:"🎪",city_sunrise:"🌇",city_sunset:"🌆",cityscape:"🏙",cl:"🆑",clamp:"🗜",clap:"👏",clapper:"🎬",classical_building:"🏛",clinking_glasses:"🥂",clipboard:"📋",clock1:"🕐",clock10:"🕙",clock1030:"🕥",clock11:"🕚",clock1130:"🕦",clock12:"🕛",clock1230:"🕧",clock130:"🕜",clock2:"🕑",clock230:"🕝",clock3:"🕒",clock330:"🕞",clock4:"🕓",clock430:"🕟",clock5:"🕔",clock530:"🕠",clock6:"🕕",clock630:"🕡",clock7:"🕖",clock730:"🕢",clock8:"🕗",clock830:"🕣",clock9:"🕘",clock930:"🕤",closed_book:"📕",closed_lock_with_key:"🔐",closed_umbrella:"🌂",cloud:"☁️",cloud_with_lightning:"🌩",cloud_with_lightning_and_rain:"⛈",cloud_with_rain:"🌧",cloud_with_snow:"🌨",clown_face:"🤡",clubs:"♣️",cocktail:"🍸",coffee:"☕️",coffin:"⚰️",cold_sweat:"😰",comet:"☄️",computer:"💻",computer_mouse:"🖱",confetti_ball:"🎊",confounded:"😖",confused:"😕",congratulations:"㊗️",construction:"🚧",construction_worker_man:"👷",construction_worker_woman:"👷&zwj;♀️",control_knobs:"🎛",convenience_store:"🏪",cookie:"🍪",cool:"🆒",policeman:"👮",copyright:"©️",corn:"🌽",couch_and_lamp:"🛋",couple:"👫",couple_with_heart_woman_man:"💑",couple_with_heart_man_man:"👨&zwj;❤️&zwj;👨",couple_with_heart_woman_woman:"👩&zwj;❤️&zwj;👩",couplekiss_man_man:"👨&zwj;❤️&zwj;💋&zwj;👨",couplekiss_man_woman:"💏",couplekiss_woman_woman:"👩&zwj;❤️&zwj;💋&zwj;👩",cow:"🐮",cow2:"🐄",cowboy_hat_face:"🤠",crab:"🦀",crayon:"🖍",credit_card:"💳",crescent_moon:"🌙",cricket:"🏏",crocodile:"🐊",croissant:"🥐",crossed_fingers:"🤞",crossed_flags:"🎌",crossed_swords:"⚔️",crown:"👑",cry:"😢",crying_cat_face:"😿",crystal_ball:"🔮",cucumber:"🥒",cupid:"💘",curly_loop:"➰",currency_exchange:"💱",curry:"🍛",custard:"🍮",customs:"🛃",cyclone:"🌀",dagger:"🗡",dancer:"💃",dancing_women:"👯",dancing_men:"👯&zwj;♂️",dango:"🍡",dark_sunglasses:"🕶",dart:"🎯",dash:"💨",date:"📅",deciduous_tree:"🌳",deer:"🦌",department_store:"🏬",derelict_house:"🏚",desert:"🏜",desert_island:"🏝",desktop_computer:"🖥",male_detective:"🕵️",diamond_shape_with_a_dot_inside:"💠",diamonds:"♦️",disappointed:"😞",disappointed_relieved:"😥",dizzy:"💫",dizzy_face:"😵",do_not_litter:"🚯",dog:"🐶",dog2:"🐕",dollar:"💵",dolls:"🎎",dolphin:"🐬",door:"🚪",doughnut:"🍩",dove:"🕊",dragon:"🐉",dragon_face:"🐲",dress:"👗",dromedary_camel:"🐪",drooling_face:"🤤",droplet:"💧",drum:"🥁",duck:"🦆",dvd:"📀","e-mail":"📧",eagle:"🦅",ear:"👂",ear_of_rice:"🌾",earth_africa:"🌍",earth_americas:"🌎",earth_asia:"🌏",egg:"🥚",eggplant:"🍆",eight_pointed_black_star:"✴️",eight_spoked_asterisk:"✳️",electric_plug:"🔌",elephant:"🐘",email:"✉️",end:"🔚",envelope_with_arrow:"📩",euro:"💶",european_castle:"🏰",european_post_office:"🏤",evergreen_tree:"🌲",exclamation:"❗️",expressionless:"😑",eye:"👁",eye_speech_bubble:"👁&zwj;🗨",eyeglasses:"👓",eyes:"👀",face_with_head_bandage:"🤕",face_with_thermometer:"🤒",fist_oncoming:"👊",factory:"🏭",fallen_leaf:"🍂",family_man_woman_boy:"👪",family_man_boy:"👨&zwj;👦",family_man_boy_boy:"👨&zwj;👦&zwj;👦",family_man_girl:"👨&zwj;👧",family_man_girl_boy:"👨&zwj;👧&zwj;👦",family_man_girl_girl:"👨&zwj;👧&zwj;👧",family_man_man_boy:"👨&zwj;👨&zwj;👦",family_man_man_boy_boy:"👨&zwj;👨&zwj;👦&zwj;👦",family_man_man_girl:"👨&zwj;👨&zwj;👧",family_man_man_girl_boy:"👨&zwj;👨&zwj;👧&zwj;👦",family_man_man_girl_girl:"👨&zwj;👨&zwj;👧&zwj;👧",family_man_woman_boy_boy:"👨&zwj;👩&zwj;👦&zwj;👦",family_man_woman_girl:"👨&zwj;👩&zwj;👧",family_man_woman_girl_boy:"👨&zwj;👩&zwj;👧&zwj;👦",family_man_woman_girl_girl:"👨&zwj;👩&zwj;👧&zwj;👧",family_woman_boy:"👩&zwj;👦",family_woman_boy_boy:"👩&zwj;👦&zwj;👦",family_woman_girl:"👩&zwj;👧",family_woman_girl_boy:"👩&zwj;👧&zwj;👦",family_woman_girl_girl:"👩&zwj;👧&zwj;👧",family_woman_woman_boy:"👩&zwj;👩&zwj;👦",family_woman_woman_boy_boy:"👩&zwj;👩&zwj;👦&zwj;👦",family_woman_woman_girl:"👩&zwj;👩&zwj;👧",family_woman_woman_girl_boy:"👩&zwj;👩&zwj;👧&zwj;👦",family_woman_woman_girl_girl:"👩&zwj;👩&zwj;👧&zwj;👧",fast_forward:"⏩",fax:"📠",fearful:"😨",feet:"🐾",female_detective:"🕵️&zwj;♀️",ferris_wheel:"🎡",ferry:"⛴",field_hockey:"🏑",file_cabinet:"🗄",file_folder:"📁",film_projector:"📽",film_strip:"🎞",fire:"🔥",fire_engine:"🚒",fireworks:"🎆",first_quarter_moon:"🌓",first_quarter_moon_with_face:"🌛",fish:"🐟",fish_cake:"🍥",fishing_pole_and_fish:"🎣",fist_raised:"✊",fist_left:"🤛",fist_right:"🤜",flags:"🎏",flashlight:"🔦",fleur_de_lis:"⚜️",flight_arrival:"🛬",flight_departure:"🛫",floppy_disk:"💾",flower_playing_cards:"🎴",flushed:"😳",fog:"🌫",foggy:"🌁",football:"🏈",footprints:"👣",fork_and_knife:"🍴",fountain:"⛲️",fountain_pen:"🖋",four_leaf_clover:"🍀",fox_face:"🦊",framed_picture:"🖼",free:"🆓",fried_egg:"🍳",fried_shrimp:"🍤",fries:"🍟",frog:"🐸",frowning:"😦",frowning_face:"☹️",frowning_man:"🙍&zwj;♂️",frowning_woman:"🙍",middle_finger:"🖕",fuelpump:"⛽️",full_moon:"🌕",full_moon_with_face:"🌝",funeral_urn:"⚱️",game_die:"🎲",gear:"⚙️",gem:"💎",gemini:"♊️",ghost:"👻",gift:"🎁",gift_heart:"💝",girl:"👧",globe_with_meridians:"🌐",goal_net:"🥅",goat:"🐐",golf:"⛳️",golfing_man:"🏌️",golfing_woman:"🏌️&zwj;♀️",gorilla:"🦍",grapes:"🍇",green_apple:"🍏",green_book:"📗",green_heart:"💚",green_salad:"🥗",grey_exclamation:"❕",grey_question:"❔",grimacing:"😬",grin:"😁",grinning:"😀",guardsman:"💂",guardswoman:"💂&zwj;♀️",guitar:"🎸",gun:"🔫",haircut_woman:"💇",haircut_man:"💇&zwj;♂️",hamburger:"🍔",hammer:"🔨",hammer_and_pick:"⚒",hammer_and_wrench:"🛠",hamster:"🐹",hand:"✋",handbag:"👜",handshake:"🤝",hankey:"💩",hatched_chick:"🐥",hatching_chick:"🐣",headphones:"🎧",hear_no_evil:"🙉",heart:"❤️",heart_decoration:"💟",heart_eyes:"😍",heart_eyes_cat:"😻",heartbeat:"💓",heartpulse:"💗",hearts:"♥️",heavy_check_mark:"✔️",heavy_division_sign:"➗",heavy_dollar_sign:"💲",heavy_heart_exclamation:"❣️",heavy_minus_sign:"➖",heavy_multiplication_x:"✖️",heavy_plus_sign:"➕",helicopter:"🚁",herb:"🌿",hibiscus:"🌺",high_brightness:"🔆",high_heel:"👠",hocho:"🔪",hole:"🕳",honey_pot:"🍯",horse:"🐴",horse_racing:"🏇",hospital:"🏥",hot_pepper:"🌶",hotdog:"🌭",hotel:"🏨",hotsprings:"♨️",hourglass:"⌛️",hourglass_flowing_sand:"⏳",house:"🏠",house_with_garden:"🏡",houses:"🏘",hugs:"🤗",hushed:"😯",ice_cream:"🍨",ice_hockey:"🏒",ice_skate:"⛸",icecream:"🍦",id:"🆔",ideograph_advantage:"🉐",imp:"👿",inbox_tray:"📥",incoming_envelope:"📨",tipping_hand_woman:"💁",information_source:"ℹ️",innocent:"😇",interrobang:"⁉️",iphone:"📱",izakaya_lantern:"🏮",jack_o_lantern:"🎃",japan:"🗾",japanese_castle:"🏯",japanese_goblin:"👺",japanese_ogre:"👹",jeans:"👖",joy:"😂",joy_cat:"😹",joystick:"🕹",kaaba:"🕋",key:"🔑",keyboard:"⌨️",keycap_ten:"🔟",kick_scooter:"🛴",kimono:"👘",kiss:"💋",kissing:"😗",kissing_cat:"😽",kissing_closed_eyes:"😚",kissing_heart:"😘",kissing_smiling_eyes:"😙",kiwi_fruit:"🥝",koala:"🐨",koko:"🈁",label:"🏷",large_blue_circle:"🔵",large_blue_diamond:"🔷",large_orange_diamond:"🔶",last_quarter_moon:"🌗",last_quarter_moon_with_face:"🌜",latin_cross:"✝️",laughing:"😆",leaves:"🍃",ledger:"📒",left_luggage:"🛅",left_right_arrow:"↔️",leftwards_arrow_with_hook:"↩️",lemon:"🍋",leo:"♌️",leopard:"🐆",level_slider:"🎚",libra:"♎️",light_rail:"🚈",link:"🔗",lion:"🦁",lips:"👄",lipstick:"💄",lizard:"🦎",lock:"🔒",lock_with_ink_pen:"🔏",lollipop:"🍭",loop:"➿",loud_sound:"🔊",loudspeaker:"📢",love_hotel:"🏩",love_letter:"💌",low_brightness:"🔅",lying_face:"🤥",m:"Ⓜ️",mag:"🔍",mag_right:"🔎",mahjong:"🀄️",mailbox:"📫",mailbox_closed:"📪",mailbox_with_mail:"📬",mailbox_with_no_mail:"📭",man:"👨",man_artist:"👨&zwj;🎨",man_astronaut:"👨&zwj;🚀",man_cartwheeling:"🤸&zwj;♂️",man_cook:"👨&zwj;🍳",man_dancing:"🕺",man_facepalming:"🤦&zwj;♂️",man_factory_worker:"👨&zwj;🏭",man_farmer:"👨&zwj;🌾",man_firefighter:"👨&zwj;🚒",man_health_worker:"👨&zwj;⚕️",man_in_tuxedo:"🤵",man_judge:"👨&zwj;⚖️",man_juggling:"🤹&zwj;♂️",man_mechanic:"👨&zwj;🔧",man_office_worker:"👨&zwj;💼",man_pilot:"👨&zwj;✈️",man_playing_handball:"🤾&zwj;♂️",man_playing_water_polo:"🤽&zwj;♂️",man_scientist:"👨&zwj;🔬",man_shrugging:"🤷&zwj;♂️",man_singer:"👨&zwj;🎤",man_student:"👨&zwj;🎓",man_teacher:"👨&zwj;🏫",man_technologist:"👨&zwj;💻",man_with_gua_pi_mao:"👲",man_with_turban:"👳",tangerine:"🍊",mans_shoe:"👞",mantelpiece_clock:"🕰",maple_leaf:"🍁",martial_arts_uniform:"🥋",mask:"😷",massage_woman:"💆",massage_man:"💆&zwj;♂️",meat_on_bone:"🍖",medal_military:"🎖",medal_sports:"🏅",mega:"📣",melon:"🍈",memo:"📝",men_wrestling:"🤼&zwj;♂️",menorah:"🕎",mens:"🚹",metal:"🤘",metro:"🚇",microphone:"🎤",microscope:"🔬",milk_glass:"🥛",milky_way:"🌌",minibus:"🚐",minidisc:"💽",mobile_phone_off:"📴",money_mouth_face:"🤑",money_with_wings:"💸",moneybag:"💰",monkey:"🐒",monkey_face:"🐵",monorail:"🚝",moon:"🌔",mortar_board:"🎓",mosque:"🕌",motor_boat:"🛥",motor_scooter:"🛵",motorcycle:"🏍",motorway:"🛣",mount_fuji:"🗻",mountain:"⛰",mountain_biking_man:"🚵",mountain_biking_woman:"🚵&zwj;♀️",mountain_cableway:"🚠",mountain_railway:"🚞",mountain_snow:"🏔",mouse:"🐭",mouse2:"🐁",movie_camera:"🎥",moyai:"🗿",mrs_claus:"🤶",muscle:"💪",mushroom:"🍄",musical_keyboard:"🎹",musical_note:"🎵",musical_score:"🎼",mute:"🔇",nail_care:"💅",name_badge:"📛",national_park:"🏞",nauseated_face:"🤢",necktie:"👔",negative_squared_cross_mark:"❎",nerd_face:"🤓",neutral_face:"😐",new:"🆕",new_moon:"🌑",new_moon_with_face:"🌚",newspaper:"📰",newspaper_roll:"🗞",next_track_button:"⏭",ng:"🆖",no_good_man:"🙅&zwj;♂️",no_good_woman:"🙅",night_with_stars:"🌃",no_bell:"🔕",no_bicycles:"🚳",no_entry:"⛔️",no_entry_sign:"🚫",no_mobile_phones:"📵",no_mouth:"😶",no_pedestrians:"🚷",no_smoking:"🚭","non-potable_water":"🚱",nose:"👃",notebook:"📓",notebook_with_decorative_cover:"📔",notes:"🎶",nut_and_bolt:"🔩",o:"⭕️",o2:"🅾️",ocean:"🌊",octopus:"🐙",oden:"🍢",office:"🏢",oil_drum:"🛢",ok:"🆗",ok_hand:"👌",ok_man:"🙆&zwj;♂️",ok_woman:"🙆",old_key:"🗝",older_man:"👴",older_woman:"👵",om:"🕉",on:"🔛",oncoming_automobile:"🚘",oncoming_bus:"🚍",oncoming_police_car:"🚔",oncoming_taxi:"🚖",open_file_folder:"📂",open_hands:"👐",open_mouth:"😮",open_umbrella:"☂️",ophiuchus:"⛎",orange_book:"📙",orthodox_cross:"☦️",outbox_tray:"📤",owl:"🦉",ox:"🐂",package:"📦",page_facing_up:"📄",page_with_curl:"📃",pager:"📟",paintbrush:"🖌",palm_tree:"🌴",pancakes:"🥞",panda_face:"🐼",paperclip:"📎",paperclips:"🖇",parasol_on_ground:"⛱",parking:"🅿️",part_alternation_mark:"〽️",partly_sunny:"⛅️",passenger_ship:"🛳",passport_control:"🛂",pause_button:"⏸",peace_symbol:"☮️",peach:"🍑",peanuts:"🥜",pear:"🍐",pen:"🖊",pencil2:"✏️",penguin:"🐧",pensive:"😔",performing_arts:"🎭",persevere:"😣",person_fencing:"🤺",pouting_woman:"🙎",phone:"☎️",pick:"⛏",pig:"🐷",pig2:"🐖",pig_nose:"🐽",pill:"💊",pineapple:"🍍",ping_pong:"🏓",pisces:"♓️",pizza:"🍕",place_of_worship:"🛐",plate_with_cutlery:"🍽",play_or_pause_button:"⏯",point_down:"👇",point_left:"👈",point_right:"👉",point_up:"☝️",point_up_2:"👆",police_car:"🚓",policewoman:"👮&zwj;♀️",poodle:"🐩",popcorn:"🍿",post_office:"🏣",postal_horn:"📯",postbox:"📮",potable_water:"🚰",potato:"🥔",pouch:"👝",poultry_leg:"🍗",pound:"💷",rage:"😡",pouting_cat:"😾",pouting_man:"🙎&zwj;♂️",pray:"🙏",prayer_beads:"📿",pregnant_woman:"🤰",previous_track_button:"⏮",prince:"🤴",princess:"👸",printer:"🖨",purple_heart:"💜",purse:"👛",pushpin:"📌",put_litter_in_its_place:"🚮",question:"❓",rabbit:"🐰",rabbit2:"🐇",racehorse:"🐎",racing_car:"🏎",radio:"📻",radio_button:"🔘",radioactive:"☢️",railway_car:"🚃",railway_track:"🛤",rainbow:"🌈",rainbow_flag:"🏳️&zwj;🌈",raised_back_of_hand:"🤚",raised_hand_with_fingers_splayed:"🖐",raised_hands:"🙌",raising_hand_woman:"🙋",raising_hand_man:"🙋&zwj;♂️",ram:"🐏",ramen:"🍜",rat:"🐀",record_button:"⏺",recycle:"♻️",red_circle:"🔴",registered:"®️",relaxed:"☺️",relieved:"😌",reminder_ribbon:"🎗",repeat:"🔁",repeat_one:"🔂",rescue_worker_helmet:"⛑",restroom:"🚻",revolving_hearts:"💞",rewind:"⏪",rhinoceros:"🦏",ribbon:"🎀",rice:"🍚",rice_ball:"🍙",rice_cracker:"🍘",rice_scene:"🎑",right_anger_bubble:"🗯",ring:"💍",robot:"🤖",rocket:"🚀",rofl:"🤣",roll_eyes:"🙄",roller_coaster:"🎢",rooster:"🐓",rose:"🌹",rosette:"🏵",rotating_light:"🚨",round_pushpin:"📍",rowing_man:"🚣",rowing_woman:"🚣&zwj;♀️",rugby_football:"🏉",running_man:"🏃",running_shirt_with_sash:"🎽",running_woman:"🏃&zwj;♀️",sa:"🈂️",sagittarius:"♐️",sake:"🍶",sandal:"👡",santa:"🎅",satellite:"📡",saxophone:"🎷",school:"🏫",school_satchel:"🎒",scissors:"✂️",scorpion:"🦂",scorpius:"♏️",scream:"😱",scream_cat:"🙀",scroll:"📜",seat:"💺",secret:"㊙️",see_no_evil:"🙈",seedling:"🌱",selfie:"🤳",shallow_pan_of_food:"🥘",shamrock:"☘️",shark:"🦈",shaved_ice:"🍧",sheep:"🐑",shell:"🐚",shield:"🛡",shinto_shrine:"⛩",ship:"🚢",shirt:"👕",shopping:"🛍",shopping_cart:"🛒",shower:"🚿",shrimp:"🦐",signal_strength:"📶",six_pointed_star:"🔯",ski:"🎿",skier:"⛷",skull:"💀",skull_and_crossbones:"☠️",sleeping:"😴",sleeping_bed:"🛌",sleepy:"😪",slightly_frowning_face:"🙁",slightly_smiling_face:"🙂",slot_machine:"🎰",small_airplane:"🛩",small_blue_diamond:"🔹",small_orange_diamond:"🔸",small_red_triangle:"🔺",small_red_triangle_down:"🔻",smile:"😄",smile_cat:"😸",smiley:"😃",smiley_cat:"😺",smiling_imp:"😈",smirk:"😏",smirk_cat:"😼",smoking:"🚬",snail:"🐌",snake:"🐍",sneezing_face:"🤧",snowboarder:"🏂",snowflake:"❄️",snowman:"⛄️",snowman_with_snow:"☃️",sob:"😭",soccer:"⚽️",soon:"🔜",sos:"🆘",sound:"🔉",space_invader:"👾",spades:"♠️",spaghetti:"🍝",sparkle:"❇️",sparkler:"🎇",sparkles:"✨",sparkling_heart:"💖",speak_no_evil:"🙊",speaker:"🔈",speaking_head:"🗣",speech_balloon:"💬",speedboat:"🚤",spider:"🕷",spider_web:"🕸",spiral_calendar:"🗓",spiral_notepad:"🗒",spoon:"🥄",squid:"🦑",stadium:"🏟",star:"⭐️",star2:"🌟",star_and_crescent:"☪️",star_of_david:"✡️",stars:"🌠",station:"🚉",statue_of_liberty:"🗽",steam_locomotive:"🚂",stew:"🍲",stop_button:"⏹",stop_sign:"🛑",stopwatch:"⏱",straight_ruler:"📏",strawberry:"🍓",stuck_out_tongue:"😛",stuck_out_tongue_closed_eyes:"😝",stuck_out_tongue_winking_eye:"😜",studio_microphone:"🎙",stuffed_flatbread:"🥙",sun_behind_large_cloud:"🌥",sun_behind_rain_cloud:"🌦",sun_behind_small_cloud:"🌤",sun_with_face:"🌞",sunflower:"🌻",sunglasses:"😎",sunny:"☀️",sunrise:"🌅",sunrise_over_mountains:"🌄",surfing_man:"🏄",surfing_woman:"🏄&zwj;♀️",sushi:"🍣",suspension_railway:"🚟",sweat:"😓",sweat_drops:"💦",sweat_smile:"😅",sweet_potato:"🍠",swimming_man:"🏊",swimming_woman:"🏊&zwj;♀️",symbols:"🔣",synagogue:"🕍",syringe:"💉",taco:"🌮",tada:"🎉",tanabata_tree:"🎋",taurus:"♉️",taxi:"🚕",tea:"🍵",telephone_receiver:"📞",telescope:"🔭",tennis:"🎾",tent:"⛺️",thermometer:"🌡",thinking:"🤔",thought_balloon:"💭",ticket:"🎫",tickets:"🎟",tiger:"🐯",tiger2:"🐅",timer_clock:"⏲",tipping_hand_man:"💁&zwj;♂️",tired_face:"😫",tm:"™️",toilet:"🚽",tokyo_tower:"🗼",tomato:"🍅",tongue:"👅",top:"🔝",tophat:"🎩",tornado:"🌪",trackball:"🖲",tractor:"🚜",traffic_light:"🚥",train:"🚋",train2:"🚆",tram:"🚊",triangular_flag_on_post:"🚩",triangular_ruler:"📐",trident:"🔱",triumph:"😤",trolleybus:"🚎",trophy:"🏆",tropical_drink:"🍹",tropical_fish:"🐠",truck:"🚚",trumpet:"🎺",tulip:"🌷",tumbler_glass:"🥃",turkey:"🦃",turtle:"🐢",tv:"📺",twisted_rightwards_arrows:"🔀",two_hearts:"💕",two_men_holding_hands:"👬",two_women_holding_hands:"👭",u5272:"🈹",u5408:"🈴",u55b6:"🈺",u6307:"🈯️",u6708:"🈷️",u6709:"🈶",u6e80:"🈵",u7121:"🈚️",u7533:"🈸",u7981:"🈲",u7a7a:"🈳",umbrella:"☔️",unamused:"😒",underage:"🔞",unicorn:"🦄",unlock:"🔓",up:"🆙",upside_down_face:"🙃",v:"✌️",vertical_traffic_light:"🚦",vhs:"📼",vibration_mode:"📳",video_camera:"📹",video_game:"🎮",violin:"🎻",virgo:"♍️",volcano:"🌋",volleyball:"🏐",vs:"🆚",vulcan_salute:"🖖",walking_man:"🚶",walking_woman:"🚶&zwj;♀️",waning_crescent_moon:"🌘",waning_gibbous_moon:"🌖",warning:"⚠️",wastebasket:"🗑",watch:"⌚️",water_buffalo:"🐃",watermelon:"🍉",wave:"👋",wavy_dash:"〰️",waxing_crescent_moon:"🌒",wc:"🚾",weary:"😩",wedding:"💒",weight_lifting_man:"🏋️",weight_lifting_woman:"🏋️&zwj;♀️",whale:"🐳",whale2:"🐋",wheel_of_dharma:"☸️",wheelchair:"♿️",white_check_mark:"✅",white_circle:"⚪️",white_flag:"🏳️",white_flower:"💮",white_large_square:"⬜️",white_medium_small_square:"◽️",white_medium_square:"◻️",white_small_square:"▫️",white_square_button:"🔳",wilted_flower:"🥀",wind_chime:"🎐",wind_face:"🌬",wine_glass:"🍷",wink:"😉",wolf:"🐺",woman:"👩",woman_artist:"👩&zwj;🎨",woman_astronaut:"👩&zwj;🚀",woman_cartwheeling:"🤸&zwj;♀️",woman_cook:"👩&zwj;🍳",woman_facepalming:"🤦&zwj;♀️",woman_factory_worker:"👩&zwj;🏭",woman_farmer:"👩&zwj;🌾",woman_firefighter:"👩&zwj;🚒",woman_health_worker:"👩&zwj;⚕️",woman_judge:"👩&zwj;⚖️",woman_juggling:"🤹&zwj;♀️",woman_mechanic:"👩&zwj;🔧",woman_office_worker:"👩&zwj;💼",woman_pilot:"👩&zwj;✈️",woman_playing_handball:"🤾&zwj;♀️",woman_playing_water_polo:"🤽&zwj;♀️",woman_scientist:"👩&zwj;🔬",woman_shrugging:"🤷&zwj;♀️",woman_singer:"👩&zwj;🎤",woman_student:"👩&zwj;🎓",woman_teacher:"👩&zwj;🏫",woman_technologist:"👩&zwj;💻",woman_with_turban:"👳&zwj;♀️",womans_clothes:"👚",womans_hat:"👒",women_wrestling:"🤼&zwj;♀️",womens:"🚺",world_map:"🗺",worried:"😟",wrench:"🔧",writing_hand:"✍️",x:"❌",yellow_heart:"💛",yen:"💴",yin_yang:"☯️",yum:"😋",zap:"⚡️",zipper_mouth_face:"🤐",zzz:"💤",octocat:'<img alt=":octocat:" height="20" width="20" align="absmiddle" src="https://assets-cdn.github.com/images/icons/emoji/octocat.png">',showdown:"<span style=\"font-family: 'Anonymous Pro', monospace; text-decoration: underline; text-decoration-style: dashed; text-decoration-color: #3e8b8a;text-underline-position: under;\">S</span>"},n.Converter=function(e){var t={},r=[],c=[],u={},d=i,p={parsed:{},raw:"",format:""};function h(e,t){if(t=t||null,n.helper.isString(e)){if(t=e=n.helper.stdExtName(e),n.extensions[e])return console.warn("DEPRECATION WARNING: "+e+" is an old extension that uses a deprecated loading method.Please inform the developer that the extension should be updated!"),void function(e,t){"function"==typeof e&&(e=e(new n.Converter));n.helper.isArray(e)||(e=[e]);var o=l(e,t);if(!o.valid)throw Error(o.error);for(var a=0;a<e.length;++a)switch(e[a].type){case"lang":r.push(e[a]);break;case"output":c.push(e[a]);break;default:throw Error("Extension loader error: Type unrecognized!!!")}}(n.extensions[e],e);if(n.helper.isUndefined(o[e]))throw Error('Extension "'+e+'" could not be loaded. It was either not found or is not a valid extension.');e=o[e]}"function"==typeof e&&(e=e()),n.helper.isArray(e)||(e=[e]);var a=l(e,t);if(!a.valid)throw Error(a.error);for(var i=0;i<e.length;++i){switch(e[i].type){case"lang":r.push(e[i]);break;case"output":c.push(e[i])}if(e[i].hasOwnProperty("listeners"))for(var s in e[i].listeners)e[i].listeners.hasOwnProperty(s)&&m(s,e[i].listeners[s])}}function m(e,t){if(!n.helper.isString(e))throw Error("Invalid argument in converter.listen() method: name must be a string, but "+typeof e+" given");if("function"!=typeof t)throw Error("Invalid argument in converter.listen() method: callback must be a function, but "+typeof t+" given");u.hasOwnProperty(e)||(u[e]=[]),u[e].push(t)}!function(){for(var r in e=e||{},a)a.hasOwnProperty(r)&&(t[r]=a[r]);if("object"!=typeof e)throw Error("Converter expects the passed parameter to be an object, but "+typeof e+" was passed instead.");for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.extensions&&n.helper.forEach(t.extensions,h)}(),this._dispatch=function(e,t,n,r){if(u.hasOwnProperty(e))for(var o=0;o<u[e].length;++o){var a=u[e][o](e,t,this,n,r);a&&void 0!==a&&(t=a)}return t},this.listen=function(e,t){return m(e,t),this},this.makeHtml=function(e){if(!e)return e;var o={gHtmlBlocks:[],gHtmlMdBlocks:[],gHtmlSpans:[],gUrls:{},gTitles:{},gDimensions:{},gListLevel:0,hashLinkCounts:{},langExtensions:r,outputModifiers:c,converter:this,ghCodeBlocks:[],metadata:{parsed:{},raw:"",format:""}};return e=(e=(e=(e=(e=e.replace(/¨/g,"¨T")).replace(/\$/g,"¨D")).replace(/\r\n/g,"\n")).replace(/\r/g,"\n")).replace(/\u00A0/g,"&nbsp;"),t.smartIndentationFix&&(e=function(e){var t=e.match(/^\s*/)[0].length,n=new RegExp("^\\s{0,"+t+"}","gm");return e.replace(n,"")}(e)),e="\n\n"+e+"\n\n",e=(e=n.subParser("detab")(e,t,o)).replace(/^[ \t]+$/gm,""),n.helper.forEach(r,(function(r){e=n.subParser("runExtension")(r,e,t,o)})),e=n.subParser("metadata")(e,t,o),e=n.subParser("hashPreCodeTags")(e,t,o),e=n.subParser("githubCodeBlocks")(e,t,o),e=n.subParser("hashHTMLBlocks")(e,t,o),e=n.subParser("hashCodeTags")(e,t,o),e=n.subParser("stripLinkDefinitions")(e,t,o),e=n.subParser("blockGamut")(e,t,o),e=n.subParser("unhashHTMLSpans")(e,t,o),e=(e=(e=n.subParser("unescapeSpecialChars")(e,t,o)).replace(/¨D/g,"$$")).replace(/¨T/g,"¨"),e=n.subParser("completeHTMLDocument")(e,t,o),n.helper.forEach(c,(function(r){e=n.subParser("runExtension")(r,e,t,o)})),p=o.metadata,e},this.makeMarkdown=this.makeMd=function(e,t){if(e=(e=(e=e.replace(/\r\n/g,"\n")).replace(/\r/g,"\n")).replace(/>[ \t]+</,">¨NBSP;<"),!t){if(!window||!window.document)throw new Error("HTMLParser is undefined. If in a webworker or nodejs environment, you need to provide a WHATWG DOM and HTML such as JSDOM");t=window.document}var r=t.createElement("div");r.innerHTML=e;var o={preList:function(e){for(var t=e.querySelectorAll("pre"),r=[],o=0;o<t.length;++o)if(1===t[o].childElementCount&&"code"===t[o].firstChild.tagName.toLowerCase()){var a=t[o].firstChild.innerHTML.trim(),i=t[o].firstChild.getAttribute("data-language")||"";if(""===i)for(var s=t[o].firstChild.className.split(" "),l=0;l<s.length;++l){var c=s[l].match(/^language-(.+)$/);if(null!==c){i=c[1];break}}a=n.helper.unescapeHTMLEntities(a),r.push(a),t[o].outerHTML='<precode language="'+i+'" precodenum="'+o.toString()+'"></precode>'}else r.push(t[o].innerHTML),t[o].innerHTML="",t[o].setAttribute("prenum",o.toString());return r}(r)};!function e(t){for(var n=0;n<t.childNodes.length;++n){var r=t.childNodes[n];3===r.nodeType?/\S/.test(r.nodeValue)||/^[ ]+$/.test(r.nodeValue)?(r.nodeValue=r.nodeValue.split("\n").join(" "),r.nodeValue=r.nodeValue.replace(/(\s)+/g,"$1")):(t.removeChild(r),--n):1===r.nodeType&&e(r)}}(r);for(var a=r.childNodes,i="",s=0;s<a.length;s++)i+=n.subParser("makeMarkdown.node")(a[s],o);return i},this.setOption=function(e,n){t[e]=n},this.getOption=function(e){return t[e]},this.getOptions=function(){return t},this.addExtension=function(e,t){h(e,t=t||null)},this.useExtension=function(e){h(e)},this.setFlavor=function(e){if(!s.hasOwnProperty(e))throw Error(e+" flavor was not found");var n=s[e];for(var r in d=e,n)n.hasOwnProperty(r)&&(t[r]=n[r])},this.getFlavor=function(){return d},this.removeExtension=function(e){n.helper.isArray(e)||(e=[e]);for(var t=0;t<e.length;++t){for(var o=e[t],a=0;a<r.length;++a)r[a]===o&&r.splice(a,1);for(var i=0;i<c.length;++i)c[i]===o&&c.splice(i,1)}},this.getAllExtensions=function(){return{language:r,output:c}},this.getMetadata=function(e){return e?p.raw:p.parsed},this.getMetadataFormat=function(){return p.format},this._setMetadataPair=function(e,t){p.parsed[e]=t},this._setMetadataFormat=function(e){p.format=e},this._setMetadataRaw=function(e){p.raw=e}},n.subParser("anchors",(function(e,t,r){var o=function(e,o,a,i,s,l,c){if(n.helper.isUndefined(c)&&(c=""),a=a.toLowerCase(),e.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)i="";else if(!i){if(a||(a=o.toLowerCase().replace(/ ?\n/g," ")),i="#"+a,n.helper.isUndefined(r.gUrls[a]))return e;i=r.gUrls[a],n.helper.isUndefined(r.gTitles[a])||(c=r.gTitles[a])}var u='<a href="'+(i=i.replace(n.helper.regexes.asteriskDashAndColon,n.helper.escapeCharactersCallback))+'"';return""!==c&&null!==c&&(u+=' title="'+(c=(c=c.replace(/"/g,"&quot;")).replace(n.helper.regexes.asteriskDashAndColon,n.helper.escapeCharactersCallback))+'"'),t.openLinksInNewWindow&&!/^#/.test(i)&&(u+=' rel="noopener noreferrer" target="¨E95Eblank"'),u+=">"+o+"</a>"};return e=(e=(e=(e=(e=r.converter._dispatch("anchors.before",e,t,r)).replace(/\[((?:\[[^\]]*]|[^\[\]])*)] ?(?:\n *)?\[(.*?)]()()()()/g,o)).replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<([^>]*)>(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,o)).replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,o)).replace(/\[([^\[\]]+)]()()()()()/g,o),t.ghMentions&&(e=e.replace(/(^|\s)(\\)?(@([a-z\d]+(?:[a-z\d.-]+?[a-z\d]+)*))/gim,(function(e,r,o,a,i){if("\\"===o)return r+a;if(!n.helper.isString(t.ghMentionsLink))throw new Error("ghMentionsLink option must be a string");var s=t.ghMentionsLink.replace(/\{u}/g,i),l="";return t.openLinksInNewWindow&&(l=' rel="noopener noreferrer" target="¨E95Eblank"'),r+'<a href="'+s+'"'+l+">"+a+"</a>"}))),e=r.converter._dispatch("anchors.after",e,t,r)}));var d=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+?\.[^'">\s]+?)()(\1)?(?=\s|$)(?!["<>])/gi,p=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+\.[^'">\s]+?)([.!?,()\[\]])?(\1)?(?=\s|$)(?!["<>])/gi,h=/()<(((https?|ftp|dict):\/\/|www\.)[^'">\s]+)()>()/gi,m=/(^|\s)(?:mailto:)?([A-Za-z0-9!#$%&'*+-/=?^_`{|}~.]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)(?=$|\s)/gim,_=/<()(?:mailto:)?([-.\w]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,f=function(e){return function(t,r,o,a,i,s,l){var c=o=o.replace(n.helper.regexes.asteriskDashAndColon,n.helper.escapeCharactersCallback),u="",d="",p=r||"",h=l||"";return/^www\./i.test(o)&&(o=o.replace(/^www\./i,"http://www.")),e.excludeTrailingPunctuationFromURLs&&s&&(u=s),e.openLinksInNewWindow&&(d=' rel="noopener noreferrer" target="¨E95Eblank"'),p+'<a href="'+o+'"'+d+">"+c+"</a>"+u+h}},g=function(e,t){return function(r,o,a){var i="mailto:";return o=o||"",a=n.subParser("unescapeSpecialChars")(a,e,t),e.encodeEmails?(i=n.helper.encodeEmailAddress(i+a),a=n.helper.encodeEmailAddress(a)):i+=a,o+'<a href="'+i+'">'+a+"</a>"}};n.subParser("autoLinks",(function(e,t,n){return e=(e=(e=n.converter._dispatch("autoLinks.before",e,t,n)).replace(h,f(t))).replace(_,g(t,n)),e=n.converter._dispatch("autoLinks.after",e,t,n)})),n.subParser("simplifiedAutoLinks",(function(e,t,n){return t.simplifiedAutoLink?(e=n.converter._dispatch("simplifiedAutoLinks.before",e,t,n),e=(e=t.excludeTrailingPunctuationFromURLs?e.replace(p,f(t)):e.replace(d,f(t))).replace(m,g(t,n)),e=n.converter._dispatch("simplifiedAutoLinks.after",e,t,n)):e})),n.subParser("blockGamut",(function(e,t,r){return e=r.converter._dispatch("blockGamut.before",e,t,r),e=n.subParser("blockQuotes")(e,t,r),e=n.subParser("headers")(e,t,r),e=n.subParser("horizontalRule")(e,t,r),e=n.subParser("lists")(e,t,r),e=n.subParser("codeBlocks")(e,t,r),e=n.subParser("tables")(e,t,r),e=n.subParser("hashHTMLBlocks")(e,t,r),e=n.subParser("paragraphs")(e,t,r),e=r.converter._dispatch("blockGamut.after",e,t,r)})),n.subParser("blockQuotes",(function(e,t,r){e=r.converter._dispatch("blockQuotes.before",e,t,r),e+="\n\n";var o=/(^ {0,3}>[ \t]?.+\n(.+\n)*\n*)+/gm;return t.splitAdjacentBlockquotes&&(o=/^ {0,3}>[\s\S]*?(?:\n\n)/gm),e=e.replace(o,(function(e){return e=(e=(e=e.replace(/^[ \t]*>[ \t]?/gm,"")).replace(/¨0/g,"")).replace(/^[ \t]+$/gm,""),e=n.subParser("githubCodeBlocks")(e,t,r),e=(e=(e=n.subParser("blockGamut")(e,t,r)).replace(/(^|\n)/g,"$1  ")).replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,(function(e,t){var n=t;return n=(n=n.replace(/^  /gm,"¨0")).replace(/¨0/g,"")})),n.subParser("hashBlock")("<blockquote>\n"+e+"\n</blockquote>",t,r)})),e=r.converter._dispatch("blockQuotes.after",e,t,r)})),n.subParser("codeBlocks",(function(e,t,r){e=r.converter._dispatch("codeBlocks.before",e,t,r);return e=(e=(e+="¨0").replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=¨0))/g,(function(e,o,a){var i=o,s=a,l="\n";return i=n.subParser("outdent")(i,t,r),i=n.subParser("encodeCode")(i,t,r),i=(i=(i=n.subParser("detab")(i,t,r)).replace(/^\n+/g,"")).replace(/\n+$/g,""),t.omitExtraWLInCodeBlocks&&(l=""),i="<pre><code>"+i+l+"</code></pre>",n.subParser("hashBlock")(i,t,r)+s}))).replace(/¨0/,""),e=r.converter._dispatch("codeBlocks.after",e,t,r)})),n.subParser("codeSpans",(function(e,t,r){return void 0===(e=r.converter._dispatch("codeSpans.before",e,t,r))&&(e=""),e=e.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,(function(e,o,a,i){var s=i;return s=(s=s.replace(/^([ \t]*)/g,"")).replace(/[ \t]*$/g,""),s=o+"<code>"+(s=n.subParser("encodeCode")(s,t,r))+"</code>",s=n.subParser("hashHTMLSpans")(s,t,r)})),e=r.converter._dispatch("codeSpans.after",e,t,r)})),n.subParser("completeHTMLDocument",(function(e,t,n){if(!t.completeHTMLDocument)return e;e=n.converter._dispatch("completeHTMLDocument.before",e,t,n);var r="html",o="<!DOCTYPE HTML>\n",a="",i='<meta charset="utf-8">\n',s="",l="";for(var c in void 0!==n.metadata.parsed.doctype&&(o="<!DOCTYPE "+n.metadata.parsed.doctype+">\n","html"!==(r=n.metadata.parsed.doctype.toString().toLowerCase())&&"html5"!==r||(i='<meta charset="utf-8">')),n.metadata.parsed)if(n.metadata.parsed.hasOwnProperty(c))switch(c.toLowerCase()){case"doctype":break;case"title":a="<title>"+n.metadata.parsed.title+"</title>\n";break;case"charset":i="html"===r||"html5"===r?'<meta charset="'+n.metadata.parsed.charset+'">\n':'<meta name="charset" content="'+n.metadata.parsed.charset+'">\n';break;case"language":case"lang":s=' lang="'+n.metadata.parsed[c]+'"',l+='<meta name="'+c+'" content="'+n.metadata.parsed[c]+'">\n';break;default:l+='<meta name="'+c+'" content="'+n.metadata.parsed[c]+'">\n'}return e=o+"<html"+s+">\n<head>\n"+a+i+l+"</head>\n<body>\n"+e.trim()+"\n</body>\n</html>",e=n.converter._dispatch("completeHTMLDocument.after",e,t,n)})),n.subParser("detab",(function(e,t,n){return e=(e=(e=(e=n.converter._dispatch("detab.before",e,t,n)).replace(/\t(?=\t)/g,"    ")).replace(/\t/g,"¨A¨B")).replace(/¨B(.+?)¨A/g,(function(e,t){for(var n=t,r=4-n.length%4,o=0;o<r;o++)n+=" ";return n})),e=(e=e.replace(/¨A/g,"    ")).replace(/¨B/g,""),e=n.converter._dispatch("detab.after",e,t,n)})),n.subParser("ellipsis",(function(e,t,n){return t.ellipsis?(e=(e=n.converter._dispatch("ellipsis.before",e,t,n)).replace(/\.\.\./g,"…"),e=n.converter._dispatch("ellipsis.after",e,t,n)):e})),n.subParser("emoji",(function(e,t,r){if(!t.emoji)return e;return e=(e=r.converter._dispatch("emoji.before",e,t,r)).replace(/:([\S]+?):/g,(function(e,t){return n.helper.emojis.hasOwnProperty(t)?n.helper.emojis[t]:e})),e=r.converter._dispatch("emoji.after",e,t,r)})),n.subParser("encodeAmpsAndAngles",(function(e,t,n){return e=(e=(e=(e=(e=n.converter._dispatch("encodeAmpsAndAngles.before",e,t,n)).replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;")).replace(/<(?![a-z\/?$!])/gi,"&lt;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;"),e=n.converter._dispatch("encodeAmpsAndAngles.after",e,t,n)})),n.subParser("encodeBackslashEscapes",(function(e,t,r){return e=(e=(e=r.converter._dispatch("encodeBackslashEscapes.before",e,t,r)).replace(/\\(\\)/g,n.helper.escapeCharactersCallback)).replace(/\\([`*_{}\[\]()>#+.!~=|:-])/g,n.helper.escapeCharactersCallback),e=r.converter._dispatch("encodeBackslashEscapes.after",e,t,r)})),n.subParser("encodeCode",(function(e,t,r){return e=(e=r.converter._dispatch("encodeCode.before",e,t,r)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/([*_{}\[\]\\=~-])/g,n.helper.escapeCharactersCallback),e=r.converter._dispatch("encodeCode.after",e,t,r)})),n.subParser("escapeSpecialCharsWithinTagAttributes",(function(e,t,r){return e=(e=(e=r.converter._dispatch("escapeSpecialCharsWithinTagAttributes.before",e,t,r)).replace(/<\/?[a-z\d_:-]+(?:[\s]+[\s\S]+?)?>/gi,(function(e){return e.replace(/(.)<\/?code>(?=.)/g,"$1`").replace(/([\\`*_~=|])/g,n.helper.escapeCharactersCallback)}))).replace(/<!(--(?:(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>/gi,(function(e){return e.replace(/([\\`*_~=|])/g,n.helper.escapeCharactersCallback)})),e=r.converter._dispatch("escapeSpecialCharsWithinTagAttributes.after",e,t,r)})),n.subParser("githubCodeBlocks",(function(e,t,r){return t.ghCodeBlocks?(e=r.converter._dispatch("githubCodeBlocks.before",e,t,r),e=(e=(e+="¨0").replace(/(?:^|\n)(?: {0,3})(```+|~~~+)(?: *)([^\s`~]*)\n([\s\S]*?)\n(?: {0,3})\1/g,(function(e,o,a,i){var s=t.omitExtraWLInCodeBlocks?"":"\n";return i=n.subParser("encodeCode")(i,t,r),i="<pre><code"+(a?' class="'+a+" language-"+a+'"':"")+">"+(i=(i=(i=n.subParser("detab")(i,t,r)).replace(/^\n+/g,"")).replace(/\n+$/g,""))+s+"</code></pre>",i=n.subParser("hashBlock")(i,t,r),"\n\n¨G"+(r.ghCodeBlocks.push({text:e,codeblock:i})-1)+"G\n\n"}))).replace(/¨0/,""),r.converter._dispatch("githubCodeBlocks.after",e,t,r)):e})),n.subParser("hashBlock",(function(e,t,n){return e=(e=n.converter._dispatch("hashBlock.before",e,t,n)).replace(/(^\n+|\n+$)/g,""),e="\n\n¨K"+(n.gHtmlBlocks.push(e)-1)+"K\n\n",e=n.converter._dispatch("hashBlock.after",e,t,n)})),n.subParser("hashCodeTags",(function(e,t,r){e=r.converter._dispatch("hashCodeTags.before",e,t,r);return e=n.helper.replaceRecursiveRegExp(e,(function(e,o,a,i){var s=a+n.subParser("encodeCode")(o,t,r)+i;return"¨C"+(r.gHtmlSpans.push(s)-1)+"C"}),"<code\\b[^>]*>","</code>","gim"),e=r.converter._dispatch("hashCodeTags.after",e,t,r)})),n.subParser("hashElement",(function(e,t,n){return function(e,t){var r=t;return r=(r=(r=r.replace(/\n\n/g,"\n")).replace(/^\n/,"")).replace(/\n+$/g,""),r="\n\n¨K"+(n.gHtmlBlocks.push(r)-1)+"K\n\n"}})),n.subParser("hashHTMLBlocks",(function(e,t,r){e=r.converter._dispatch("hashHTMLBlocks.before",e,t,r);var o=["pre","div","h1","h2","h3","h4","h5","h6","blockquote","table","dl","ol","ul","script","noscript","form","fieldset","iframe","math","style","section","header","footer","nav","article","aside","address","audio","canvas","figure","hgroup","output","video","p"],a=function(e,t,n,o){var a=e;return-1!==n.search(/\bmarkdown\b/)&&(a=n+r.converter.makeHtml(t)+o),"\n\n¨K"+(r.gHtmlBlocks.push(a)-1)+"K\n\n"};t.backslashEscapesHTMLTags&&(e=e.replace(/\\<(\/?[^>]+?)>/g,(function(e,t){return"&lt;"+t+"&gt;"})));for(var i=0;i<o.length;++i)for(var s,l=new RegExp("^ {0,3}(<"+o[i]+"\\b[^>]*>)","im"),c="<"+o[i]+"\\b[^>]*>",u="</"+o[i]+">";-1!==(s=n.helper.regexIndexOf(e,l));){var d=n.helper.splitAtIndex(e,s),p=n.helper.replaceRecursiveRegExp(d[1],a,c,u,"im");if(p===d[1])break;e=d[0].concat(p)}return e=e.replace(/(\n {0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,n.subParser("hashElement")(e,t,r)),e=(e=n.helper.replaceRecursiveRegExp(e,(function(e){return"\n\n¨K"+(r.gHtmlBlocks.push(e)-1)+"K\n\n"}),"^ {0,3}\x3c!--","--\x3e","gm")).replace(/(?:\n\n)( {0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,n.subParser("hashElement")(e,t,r)),e=r.converter._dispatch("hashHTMLBlocks.after",e,t,r)})),n.subParser("hashHTMLSpans",(function(e,t,n){function r(e){return"¨C"+(n.gHtmlSpans.push(e)-1)+"C"}return e=(e=(e=(e=(e=n.converter._dispatch("hashHTMLSpans.before",e,t,n)).replace(/<[^>]+?\/>/gi,(function(e){return r(e)}))).replace(/<([^>]+?)>[\s\S]*?<\/\1>/g,(function(e){return r(e)}))).replace(/<([^>]+?)\s[^>]+?>[\s\S]*?<\/\1>/g,(function(e){return r(e)}))).replace(/<[^>]+?>/gi,(function(e){return r(e)})),e=n.converter._dispatch("hashHTMLSpans.after",e,t,n)})),n.subParser("unhashHTMLSpans",(function(e,t,n){e=n.converter._dispatch("unhashHTMLSpans.before",e,t,n);for(var r=0;r<n.gHtmlSpans.length;++r){for(var o=n.gHtmlSpans[r],a=0;/¨C(\d+)C/.test(o);){var i=RegExp.$1;if(o=o.replace("¨C"+i+"C",n.gHtmlSpans[i]),10===a){console.error("maximum nesting of 10 spans reached!!!");break}++a}e=e.replace("¨C"+r+"C",o)}return e=n.converter._dispatch("unhashHTMLSpans.after",e,t,n)})),n.subParser("hashPreCodeTags",(function(e,t,r){e=r.converter._dispatch("hashPreCodeTags.before",e,t,r);return e=n.helper.replaceRecursiveRegExp(e,(function(e,o,a,i){var s=a+n.subParser("encodeCode")(o,t,r)+i;return"\n\n¨G"+(r.ghCodeBlocks.push({text:e,codeblock:s})-1)+"G\n\n"}),"^ {0,3}<pre\\b[^>]*>\\s*<code\\b[^>]*>","^ {0,3}</code>\\s*</pre>","gim"),e=r.converter._dispatch("hashPreCodeTags.after",e,t,r)})),n.subParser("headers",(function(e,t,r){e=r.converter._dispatch("headers.before",e,t,r);var o=isNaN(parseInt(t.headerLevelStart))?1:parseInt(t.headerLevelStart),a=t.smoothLivePreview?/^(.+)[ \t]*\n={2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n=+[ \t]*\n+/gm,i=t.smoothLivePreview?/^(.+)[ \t]*\n-{2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n-+[ \t]*\n+/gm;e=(e=e.replace(a,(function(e,a){var i=n.subParser("spanGamut")(a,t,r),s=t.noHeaderId?"":' id="'+l(a)+'"',c="<h"+o+s+">"+i+"</h"+o+">";return n.subParser("hashBlock")(c,t,r)}))).replace(i,(function(e,a){var i=n.subParser("spanGamut")(a,t,r),s=t.noHeaderId?"":' id="'+l(a)+'"',c=o+1,u="<h"+c+s+">"+i+"</h"+c+">";return n.subParser("hashBlock")(u,t,r)}));var s=t.requireSpaceBeforeHeadingText?/^(#{1,6})[ \t]+(.+?)[ \t]*#*\n+/gm:/^(#{1,6})[ \t]*(.+?)[ \t]*#*\n+/gm;function l(e){var o,a;if(t.customizedHeaderId){var i=e.match(/\{([^{]+?)}\s*$/);i&&i[1]&&(e=i[1])}return o=e,a=n.helper.isString(t.prefixHeaderId)?t.prefixHeaderId:!0===t.prefixHeaderId?"section-":"",t.rawPrefixHeaderId||(o=a+o),o=t.ghCompatibleHeaderId?o.replace(/ /g,"-").replace(/&amp;/g,"").replace(/¨T/g,"").replace(/¨D/g,"").replace(/[&+$,\/:;=?@"#{}|^¨~\[\]`\\*)(%.!'<>]/g,"").toLowerCase():t.rawHeaderId?o.replace(/ /g,"-").replace(/&amp;/g,"&").replace(/¨T/g,"¨").replace(/¨D/g,"$").replace(/["']/g,"-").toLowerCase():o.replace(/[^\w]/g,"").toLowerCase(),t.rawPrefixHeaderId&&(o=a+o),r.hashLinkCounts[o]?o=o+"-"+r.hashLinkCounts[o]++:r.hashLinkCounts[o]=1,o}return e=e.replace(s,(function(e,a,i){var s=i;t.customizedHeaderId&&(s=i.replace(/\s?\{([^{]+?)}\s*$/,""));var c=n.subParser("spanGamut")(s,t,r),u=t.noHeaderId?"":' id="'+l(i)+'"',d=o-1+a.length,p="<h"+d+u+">"+c+"</h"+d+">";return n.subParser("hashBlock")(p,t,r)})),e=r.converter._dispatch("headers.after",e,t,r)})),n.subParser("horizontalRule",(function(e,t,r){e=r.converter._dispatch("horizontalRule.before",e,t,r);var o=n.subParser("hashBlock")("<hr />",t,r);return e=(e=(e=e.replace(/^ {0,2}( ?-){3,}[ \t]*$/gm,o)).replace(/^ {0,2}( ?\*){3,}[ \t]*$/gm,o)).replace(/^ {0,2}( ?_){3,}[ \t]*$/gm,o),e=r.converter._dispatch("horizontalRule.after",e,t,r)})),n.subParser("images",(function(e,t,r){function o(e,t,o,a,i,s,l,c){var u=r.gUrls,d=r.gTitles,p=r.gDimensions;if(o=o.toLowerCase(),c||(c=""),e.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)a="";else if(""===a||null===a){if(""!==o&&null!==o||(o=t.toLowerCase().replace(/ ?\n/g," ")),a="#"+o,n.helper.isUndefined(u[o]))return e;a=u[o],n.helper.isUndefined(d[o])||(c=d[o]),n.helper.isUndefined(p[o])||(i=p[o].width,s=p[o].height)}t=t.replace(/"/g,"&quot;").replace(n.helper.regexes.asteriskDashAndColon,n.helper.escapeCharactersCallback);var h='<img src="'+(a=a.replace(n.helper.regexes.asteriskDashAndColon,n.helper.escapeCharactersCallback))+'" alt="'+t+'"';return c&&n.helper.isString(c)&&(h+=' title="'+(c=c.replace(/"/g,"&quot;").replace(n.helper.regexes.asteriskDashAndColon,n.helper.escapeCharactersCallback))+'"'),i&&s&&(h+=' width="'+(i="*"===i?"auto":i)+'"',h+=' height="'+(s="*"===s?"auto":s)+'"'),h+=" />"}return e=(e=(e=(e=(e=(e=r.converter._dispatch("images.before",e,t,r)).replace(/!\[([^\]]*?)] ?(?:\n *)?\[([\s\S]*?)]()()()()()/g,o)).replace(/!\[([^\]]*?)][ \t]*()\([ \t]?<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,(function(e,t,n,r,a,i,s,l){return o(e,t,n,r=r.replace(/\s/g,""),a,i,s,l)}))).replace(/!\[([^\]]*?)][ \t]*()\([ \t]?<([^>]*)>(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(?:(["'])([^"]*?)\6))?[ \t]?\)/g,o)).replace(/!\[([^\]]*?)][ \t]*()\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,o)).replace(/!\[([^\[\]]+)]()()()()()/g,o),e=r.converter._dispatch("images.after",e,t,r)})),n.subParser("italicsAndBold",(function(e,t,n){function r(e,t,n){return t+e+n}return e=n.converter._dispatch("italicsAndBold.before",e,t,n),e=t.literalMidWordUnderscores?(e=(e=e.replace(/\b___(\S[\s\S]*?)___\b/g,(function(e,t){return r(t,"<strong><em>","</em></strong>")}))).replace(/\b__(\S[\s\S]*?)__\b/g,(function(e,t){return r(t,"<strong>","</strong>")}))).replace(/\b_(\S[\s\S]*?)_\b/g,(function(e,t){return r(t,"<em>","</em>")})):(e=(e=e.replace(/___(\S[\s\S]*?)___/g,(function(e,t){return/\S$/.test(t)?r(t,"<strong><em>","</em></strong>"):e}))).replace(/__(\S[\s\S]*?)__/g,(function(e,t){return/\S$/.test(t)?r(t,"<strong>","</strong>"):e}))).replace(/_([^\s_][\s\S]*?)_/g,(function(e,t){return/\S$/.test(t)?r(t,"<em>","</em>"):e})),e=t.literalMidWordAsterisks?(e=(e=e.replace(/([^*]|^)\B\*\*\*(\S[\s\S]*?)\*\*\*\B(?!\*)/g,(function(e,t,n){return r(n,t+"<strong><em>","</em></strong>")}))).replace(/([^*]|^)\B\*\*(\S[\s\S]*?)\*\*\B(?!\*)/g,(function(e,t,n){return r(n,t+"<strong>","</strong>")}))).replace(/([^*]|^)\B\*(\S[\s\S]*?)\*\B(?!\*)/g,(function(e,t,n){return r(n,t+"<em>","</em>")})):(e=(e=e.replace(/\*\*\*(\S[\s\S]*?)\*\*\*/g,(function(e,t){return/\S$/.test(t)?r(t,"<strong><em>","</em></strong>"):e}))).replace(/\*\*(\S[\s\S]*?)\*\*/g,(function(e,t){return/\S$/.test(t)?r(t,"<strong>","</strong>"):e}))).replace(/\*([^\s*][\s\S]*?)\*/g,(function(e,t){return/\S$/.test(t)?r(t,"<em>","</em>"):e})),e=n.converter._dispatch("italicsAndBold.after",e,t,n)})),n.subParser("lists",(function(e,t,r){function o(e,o){r.gListLevel++,e=e.replace(/\n{2,}$/,"\n");var a=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(¨0| {0,3}([*+-]|\d+[.])[ \t]+))/gm,i=/\n[ \t]*\n(?!¨0)/.test(e+="¨0");return t.disableForced4SpacesIndentedSublists&&(a=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(¨0|\2([*+-]|\d+[.])[ \t]+))/gm),e=(e=e.replace(a,(function(e,o,a,s,l,c,u){u=u&&""!==u.trim();var d=n.subParser("outdent")(l,t,r),p="";return c&&t.tasklists&&(p=' class="task-list-item" style="list-style-type: none;"',d=d.replace(/^[ \t]*\[(x|X| )?]/m,(function(){var e='<input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"';return u&&(e+=" checked"),e+=">"}))),d=d.replace(/^([-*+]|\d\.)[ \t]+[\S\n ]*/g,(function(e){return"¨A"+e})),o||d.search(/\n{2,}/)>-1?(d=n.subParser("githubCodeBlocks")(d,t,r),d=n.subParser("blockGamut")(d,t,r)):(d=(d=n.subParser("lists")(d,t,r)).replace(/\n$/,""),d=(d=n.subParser("hashHTMLBlocks")(d,t,r)).replace(/\n\n+/g,"\n\n"),d=i?n.subParser("paragraphs")(d,t,r):n.subParser("spanGamut")(d,t,r)),d="<li"+p+">"+(d=d.replace("¨A",""))+"</li>\n"}))).replace(/¨0/g,""),r.gListLevel--,o&&(e=e.replace(/\s+$/,"")),e}function a(e,t){if("ol"===t){var n=e.match(/^ *(\d+)\./);if(n&&"1"!==n[1])return' start="'+n[1]+'"'}return""}function i(e,n,r){var i=t.disableForced4SpacesIndentedSublists?/^ ?\d+\.[ \t]/gm:/^ {0,3}\d+\.[ \t]/gm,s=t.disableForced4SpacesIndentedSublists?/^ ?[*+-][ \t]/gm:/^ {0,3}[*+-][ \t]/gm,l="ul"===n?i:s,c="";if(-1!==e.search(l))!function t(u){var d=u.search(l),p=a(e,n);-1!==d?(c+="\n\n<"+n+p+">\n"+o(u.slice(0,d),!!r)+"</"+n+">\n",l="ul"===(n="ul"===n?"ol":"ul")?i:s,t(u.slice(d))):c+="\n\n<"+n+p+">\n"+o(u,!!r)+"</"+n+">\n"}(e);else{var u=a(e,n);c="\n\n<"+n+u+">\n"+o(e,!!r)+"</"+n+">\n"}return c}return e=r.converter._dispatch("lists.before",e,t,r),e+="¨0",e=(e=r.gListLevel?e.replace(/^(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(¨0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,(function(e,t,n){return i(t,n.search(/[*+-]/g)>-1?"ul":"ol",!0)})):e.replace(/(\n\n|^\n?)(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(¨0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,(function(e,t,n,r){return i(n,r.search(/[*+-]/g)>-1?"ul":"ol",!1)}))).replace(/¨0/,""),e=r.converter._dispatch("lists.after",e,t,r)})),n.subParser("metadata",(function(e,t,n){if(!t.metadata)return e;function r(e){n.metadata.raw=e,(e=(e=e.replace(/&/g,"&amp;").replace(/"/g,"&quot;")).replace(/\n {4}/g," ")).replace(/^([\S ]+): +([\s\S]+?)$/gm,(function(e,t,r){return n.metadata.parsed[t]=r,""}))}return e=(e=(e=(e=n.converter._dispatch("metadata.before",e,t,n)).replace(/^\s*«««+(\S*?)\n([\s\S]+?)\n»»»+\n/,(function(e,t,n){return r(n),"¨M"}))).replace(/^\s*---+(\S*?)\n([\s\S]+?)\n---+\n/,(function(e,t,o){return t&&(n.metadata.format=t),r(o),"¨M"}))).replace(/¨M/g,""),e=n.converter._dispatch("metadata.after",e,t,n)})),n.subParser("outdent",(function(e,t,n){return e=(e=(e=n.converter._dispatch("outdent.before",e,t,n)).replace(/^(\t|[ ]{1,4})/gm,"¨0")).replace(/¨0/g,""),e=n.converter._dispatch("outdent.after",e,t,n)})),n.subParser("paragraphs",(function(e,t,r){for(var o=(e=(e=(e=r.converter._dispatch("paragraphs.before",e,t,r)).replace(/^\n+/g,"")).replace(/\n+$/g,"")).split(/\n{2,}/g),a=[],i=o.length,s=0;s<i;s++){var l=o[s];l.search(/¨(K|G)(\d+)\1/g)>=0?a.push(l):l.search(/\S/)>=0&&(l=(l=n.subParser("spanGamut")(l,t,r)).replace(/^([ \t]*)/g,"<p>"),l+="</p>",a.push(l))}for(i=a.length,s=0;s<i;s++){for(var c="",u=a[s],d=!1;/¨(K|G)(\d+)\1/.test(u);){var p=RegExp.$1,h=RegExp.$2;c=(c="K"===p?r.gHtmlBlocks[h]:d?n.subParser("encodeCode")(r.ghCodeBlocks[h].text,t,r):r.ghCodeBlocks[h].codeblock).replace(/\$/g,"$$$$"),u=u.replace(/(\n\n)?¨(K|G)\d+\2(\n\n)?/,c),/^<pre\b[^>]*>\s*<code\b[^>]*>/.test(u)&&(d=!0)}a[s]=u}return e=(e=(e=a.join("\n")).replace(/^\n+/g,"")).replace(/\n+$/g,""),r.converter._dispatch("paragraphs.after",e,t,r)})),n.subParser("runExtension",(function(e,t,n,r){if(e.filter)t=e.filter(t,r.converter,n);else if(e.regex){var o=e.regex;o instanceof RegExp||(o=new RegExp(o,"g")),t=t.replace(o,e.replace)}return t})),n.subParser("spanGamut",(function(e,t,r){return e=r.converter._dispatch("spanGamut.before",e,t,r),e=n.subParser("codeSpans")(e,t,r),e=n.subParser("escapeSpecialCharsWithinTagAttributes")(e,t,r),e=n.subParser("encodeBackslashEscapes")(e,t,r),e=n.subParser("images")(e,t,r),e=n.subParser("anchors")(e,t,r),e=n.subParser("autoLinks")(e,t,r),e=n.subParser("simplifiedAutoLinks")(e,t,r),e=n.subParser("emoji")(e,t,r),e=n.subParser("underline")(e,t,r),e=n.subParser("italicsAndBold")(e,t,r),e=n.subParser("strikethrough")(e,t,r),e=n.subParser("ellipsis")(e,t,r),e=n.subParser("hashHTMLSpans")(e,t,r),e=n.subParser("encodeAmpsAndAngles")(e,t,r),t.simpleLineBreaks?/\n\n¨K/.test(e)||(e=e.replace(/\n+/g,"<br />\n")):e=e.replace(/  +\n/g,"<br />\n"),e=r.converter._dispatch("spanGamut.after",e,t,r)})),n.subParser("strikethrough",(function(e,t,r){return t.strikethrough&&(e=(e=r.converter._dispatch("strikethrough.before",e,t,r)).replace(/(?:~){2}([\s\S]+?)(?:~){2}/g,(function(e,o){return function(e){return t.simplifiedAutoLink&&(e=n.subParser("simplifiedAutoLinks")(e,t,r)),"<del>"+e+"</del>"}(o)})),e=r.converter._dispatch("strikethrough.after",e,t,r)),e})),n.subParser("stripLinkDefinitions",(function(e,t,r){var o=function(o,a,i,s,l,c,u){return a=a.toLowerCase(),e.toLowerCase().split(a).length-1<2?o:(i.match(/^data:.+?\/.+?;base64,/)?r.gUrls[a]=i.replace(/\s/g,""):r.gUrls[a]=n.subParser("encodeAmpsAndAngles")(i,t,r),c?c+u:(u&&(r.gTitles[a]=u.replace(/"|'/g,"&quot;")),t.parseImgDimensions&&s&&l&&(r.gDimensions[a]={width:s,height:l}),""))};return e=(e=(e=(e+="¨0").replace(/^ {0,3}\[([^\]]+)]:[ \t]*\n?[ \t]*<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n\n|(?=¨0)|(?=\n\[))/gm,o)).replace(/^ {0,3}\[([^\]]+)]:[ \t]*\n?[ \t]*<?([^>\s]+)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n+|(?=¨0))/gm,o)).replace(/¨0/,"")})),n.subParser("tables",(function(e,t,r){if(!t.tables)return e;function o(e,o){return"<td"+o+">"+n.subParser("spanGamut")(e,t,r)+"</td>\n"}function a(e){var a,i=e.split("\n");for(a=0;a<i.length;++a)/^ {0,3}\|/.test(i[a])&&(i[a]=i[a].replace(/^ {0,3}\|/,"")),/\|[ \t]*$/.test(i[a])&&(i[a]=i[a].replace(/\|[ \t]*$/,"")),i[a]=n.subParser("codeSpans")(i[a],t,r);var s,l,c,u,d=i[0].split("|").map((function(e){return e.trim()})),p=i[1].split("|").map((function(e){return e.trim()})),h=[],m=[],_=[],f=[];for(i.shift(),i.shift(),a=0;a<i.length;++a)""!==i[a].trim()&&h.push(i[a].split("|").map((function(e){return e.trim()})));if(d.length<p.length)return e;for(a=0;a<p.length;++a)_.push((s=p[a],/^:[ \t]*--*$/.test(s)?' style="text-align:left;"':/^--*[ \t]*:[ \t]*$/.test(s)?' style="text-align:right;"':/^:[ \t]*--*[ \t]*:$/.test(s)?' style="text-align:center;"':""));for(a=0;a<d.length;++a)n.helper.isUndefined(_[a])&&(_[a]=""),m.push((l=d[a],c=_[a],u=void 0,u="",l=l.trim(),(t.tablesHeaderId||t.tableHeaderId)&&(u=' id="'+l.replace(/ /g,"_").toLowerCase()+'"'),"<th"+u+c+">"+(l=n.subParser("spanGamut")(l,t,r))+"</th>\n"));for(a=0;a<h.length;++a){for(var g=[],b=0;b<m.length;++b)n.helper.isUndefined(h[a][b]),g.push(o(h[a][b],_[b]));f.push(g)}return function(e,t){for(var n="<table>\n<thead>\n<tr>\n",r=e.length,o=0;o<r;++o)n+=e[o];for(n+="</tr>\n</thead>\n<tbody>\n",o=0;o<t.length;++o){n+="<tr>\n";for(var a=0;a<r;++a)n+=t[o][a];n+="</tr>\n"}return n+"</tbody>\n</table>\n"}(m,f)}return e=(e=(e=(e=r.converter._dispatch("tables.before",e,t,r)).replace(/\\(\|)/g,n.helper.escapeCharactersCallback)).replace(/^ {0,3}\|?.+\|.+\n {0,3}\|?[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*:?[ \t]*(?:[-=]){2,}[\s\S]+?(?:\n\n|¨0)/gm,a)).replace(/^ {0,3}\|.+\|[ \t]*\n {0,3}\|[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*\n( {0,3}\|.+\|[ \t]*\n)*(?:\n|¨0)/gm,a),e=r.converter._dispatch("tables.after",e,t,r)})),n.subParser("underline",(function(e,t,r){return t.underline?(e=r.converter._dispatch("underline.before",e,t,r),e=(e=t.literalMidWordUnderscores?(e=e.replace(/\b___(\S[\s\S]*?)___\b/g,(function(e,t){return"<u>"+t+"</u>"}))).replace(/\b__(\S[\s\S]*?)__\b/g,(function(e,t){return"<u>"+t+"</u>"})):(e=e.replace(/___(\S[\s\S]*?)___/g,(function(e,t){return/\S$/.test(t)?"<u>"+t+"</u>":e}))).replace(/__(\S[\s\S]*?)__/g,(function(e,t){return/\S$/.test(t)?"<u>"+t+"</u>":e}))).replace(/(_)/g,n.helper.escapeCharactersCallback),e=r.converter._dispatch("underline.after",e,t,r)):e})),n.subParser("unescapeSpecialChars",(function(e,t,n){return e=(e=n.converter._dispatch("unescapeSpecialChars.before",e,t,n)).replace(/¨E(\d+)E/g,(function(e,t){var n=parseInt(t);return String.fromCharCode(n)})),e=n.converter._dispatch("unescapeSpecialChars.after",e,t,n)})),n.subParser("makeMarkdown.blockquote",(function(e,t){var r="";if(e.hasChildNodes())for(var o=e.childNodes,a=o.length,i=0;i<a;++i){var s=n.subParser("makeMarkdown.node")(o[i],t);""!==s&&(r+=s)}return r="> "+(r=r.trim()).split("\n").join("\n> ")})),n.subParser("makeMarkdown.codeBlock",(function(e,t){var n=e.getAttribute("language"),r=e.getAttribute("precodenum");return"```"+n+"\n"+t.preList[r]+"\n```"})),n.subParser("makeMarkdown.codeSpan",(function(e){return"`"+e.innerHTML+"`"})),n.subParser("makeMarkdown.emphasis",(function(e,t){var r="";if(e.hasChildNodes()){r+="*";for(var o=e.childNodes,a=o.length,i=0;i<a;++i)r+=n.subParser("makeMarkdown.node")(o[i],t);r+="*"}return r})),n.subParser("makeMarkdown.header",(function(e,t,r){var o=new Array(r+1).join("#"),a="";if(e.hasChildNodes()){a=o+" ";for(var i=e.childNodes,s=i.length,l=0;l<s;++l)a+=n.subParser("makeMarkdown.node")(i[l],t)}return a})),n.subParser("makeMarkdown.hr",(function(){return"---"})),n.subParser("makeMarkdown.image",(function(e){var t="";return e.hasAttribute("src")&&(t+="!["+e.getAttribute("alt")+"](",t+="<"+e.getAttribute("src")+">",e.hasAttribute("width")&&e.hasAttribute("height")&&(t+=" ="+e.getAttribute("width")+"x"+e.getAttribute("height")),e.hasAttribute("title")&&(t+=' "'+e.getAttribute("title")+'"'),t+=")"),t})),n.subParser("makeMarkdown.links",(function(e,t){var r="";if(e.hasChildNodes()&&e.hasAttribute("href")){var o=e.childNodes,a=o.length;r="[";for(var i=0;i<a;++i)r+=n.subParser("makeMarkdown.node")(o[i],t);r+="](",r+="<"+e.getAttribute("href")+">",e.hasAttribute("title")&&(r+=' "'+e.getAttribute("title")+'"'),r+=")"}return r})),n.subParser("makeMarkdown.list",(function(e,t,r){var o="";if(!e.hasChildNodes())return"";for(var a=e.childNodes,i=a.length,s=e.getAttribute("start")||1,l=0;l<i;++l)if(void 0!==a[l].tagName&&"li"===a[l].tagName.toLowerCase()){o+=("ol"===r?s.toString()+". ":"- ")+n.subParser("makeMarkdown.listItem")(a[l],t),++s}return(o+="\n\x3c!-- --\x3e\n").trim()})),n.subParser("makeMarkdown.listItem",(function(e,t){for(var r="",o=e.childNodes,a=o.length,i=0;i<a;++i)r+=n.subParser("makeMarkdown.node")(o[i],t);return/\n$/.test(r)?r=r.split("\n").join("\n    ").replace(/^ {4}$/gm,"").replace(/\n\n+/g,"\n\n"):r+="\n",r})),n.subParser("makeMarkdown.node",(function(e,t,r){r=r||!1;var o="";if(3===e.nodeType)return n.subParser("makeMarkdown.txt")(e,t);if(8===e.nodeType)return"\x3c!--"+e.data+"--\x3e\n\n";if(1!==e.nodeType)return"";switch(e.tagName.toLowerCase()){case"h1":r||(o=n.subParser("makeMarkdown.header")(e,t,1)+"\n\n");break;case"h2":r||(o=n.subParser("makeMarkdown.header")(e,t,2)+"\n\n");break;case"h3":r||(o=n.subParser("makeMarkdown.header")(e,t,3)+"\n\n");break;case"h4":r||(o=n.subParser("makeMarkdown.header")(e,t,4)+"\n\n");break;case"h5":r||(o=n.subParser("makeMarkdown.header")(e,t,5)+"\n\n");break;case"h6":r||(o=n.subParser("makeMarkdown.header")(e,t,6)+"\n\n");break;case"p":r||(o=n.subParser("makeMarkdown.paragraph")(e,t)+"\n\n");break;case"blockquote":r||(o=n.subParser("makeMarkdown.blockquote")(e,t)+"\n\n");break;case"hr":r||(o=n.subParser("makeMarkdown.hr")(e,t)+"\n\n");break;case"ol":r||(o=n.subParser("makeMarkdown.list")(e,t,"ol")+"\n\n");break;case"ul":r||(o=n.subParser("makeMarkdown.list")(e,t,"ul")+"\n\n");break;case"precode":r||(o=n.subParser("makeMarkdown.codeBlock")(e,t)+"\n\n");break;case"pre":r||(o=n.subParser("makeMarkdown.pre")(e,t)+"\n\n");break;case"table":r||(o=n.subParser("makeMarkdown.table")(e,t)+"\n\n");break;case"code":o=n.subParser("makeMarkdown.codeSpan")(e,t);break;case"em":case"i":o=n.subParser("makeMarkdown.emphasis")(e,t);break;case"strong":case"b":o=n.subParser("makeMarkdown.strong")(e,t);break;case"del":o=n.subParser("makeMarkdown.strikethrough")(e,t);break;case"a":o=n.subParser("makeMarkdown.links")(e,t);break;case"img":o=n.subParser("makeMarkdown.image")(e,t);break;default:o=e.outerHTML+"\n\n"}return o})),n.subParser("makeMarkdown.paragraph",(function(e,t){var r="";if(e.hasChildNodes())for(var o=e.childNodes,a=o.length,i=0;i<a;++i)r+=n.subParser("makeMarkdown.node")(o[i],t);return r=r.trim()})),n.subParser("makeMarkdown.pre",(function(e,t){var n=e.getAttribute("prenum");return"<pre>"+t.preList[n]+"</pre>"})),n.subParser("makeMarkdown.strikethrough",(function(e,t){var r="";if(e.hasChildNodes()){r+="~~";for(var o=e.childNodes,a=o.length,i=0;i<a;++i)r+=n.subParser("makeMarkdown.node")(o[i],t);r+="~~"}return r})),n.subParser("makeMarkdown.strong",(function(e,t){var r="";if(e.hasChildNodes()){r+="**";for(var o=e.childNodes,a=o.length,i=0;i<a;++i)r+=n.subParser("makeMarkdown.node")(o[i],t);r+="**"}return r})),n.subParser("makeMarkdown.table",(function(e,t){var r,o,a="",i=[[],[]],s=e.querySelectorAll("thead>tr>th"),l=e.querySelectorAll("tbody>tr");for(r=0;r<s.length;++r){var c=n.subParser("makeMarkdown.tableCell")(s[r],t),u="---";if(s[r].hasAttribute("style"))switch(s[r].getAttribute("style").toLowerCase().replace(/\s/g,"")){case"text-align:left;":u=":---";break;case"text-align:right;":u="---:";break;case"text-align:center;":u=":---:"}i[0][r]=c.trim(),i[1][r]=u}for(r=0;r<l.length;++r){var d=i.push([])-1,p=l[r].getElementsByTagName("td");for(o=0;o<s.length;++o){var h=" ";void 0!==p[o]&&(h=n.subParser("makeMarkdown.tableCell")(p[o],t)),i[d].push(h)}}var m=3;for(r=0;r<i.length;++r)for(o=0;o<i[r].length;++o){var _=i[r][o].length;_>m&&(m=_)}for(r=0;r<i.length;++r){for(o=0;o<i[r].length;++o)1===r?":"===i[r][o].slice(-1)?i[r][o]=n.helper.padEnd(i[r][o].slice(-1),m-1,"-")+":":i[r][o]=n.helper.padEnd(i[r][o],m,"-"):i[r][o]=n.helper.padEnd(i[r][o],m);a+="| "+i[r].join(" | ")+" |\n"}return a.trim()})),n.subParser("makeMarkdown.tableCell",(function(e,t){var r="";if(!e.hasChildNodes())return"";for(var o=e.childNodes,a=o.length,i=0;i<a;++i)r+=n.subParser("makeMarkdown.node")(o[i],t,!0);return r.trim()})),n.subParser("makeMarkdown.txt",(function(e){var t=e.nodeValue;return t=(t=t.replace(/ +/g," ")).replace(/¨NBSP;/g," "),t=(t=(t=(t=(t=(t=(t=(t=(t=n.helper.unescapeHTMLEntities(t)).replace(/([*_~|`])/g,"\\$1")).replace(/^(\s*)>/g,"\\$1>")).replace(/^#/gm,"\\#")).replace(/^(\s*)([-=]{3,})(\s*)$/,"$1\\$2$3")).replace(/^( {0,3}\d+)\./gm,"$1\\.")).replace(/^( {0,3})([+-])/gm,"$1\\$2")).replace(/]([\s]*)\(/g,"\\]$1\\(")).replace(/^ {0,3}\[([\S \t]*?)]:/gm,"\\[$1]:")}));e.exports?e.exports=n:this.showdown=n}).call(commonjsGlobal)}));function create_fragment$o(e){let t;return{c(){t=element("div")},m(n,r){insert(n,t,r),e[2](t)},p:noop,i:noop,o:noop,d(n){n&&detach(t),e[2](null)}}}function instance$o(e,t,n){let r,o;component_subscribe(e,selectedCollection,(e=>n(3,r=e))),component_subscribe(e,colApi,(e=>n(4,o=e)));let a,{descriptionPath:i}=t;const s=async e=>{if(!e||!a)return;n(0,a.innerHTML="",a);const t=await o.colIdDescPathGetRaw({colId:r,path:e}),i=t.raw.headers.get("Content-Type"),s=await t.value();if("text/html"==i)n(0,a.innerHTML=s,a);else if("text/x-markdown"==i||"text/markdown"==i){let e=new showdown.Converter;n(0,a.innerHTML=e.makeHtml(s),a)}else if("text/plain"==i){const e=s.split(/\r?\n/);for(let t of e){if(t=t.trim(),!t)continue;const e=document.createElement("p");e.innerText=t,a.appendChild(e)}}else n(0,a.innerText=s,a)};return onMount((()=>s(i))),e.$$set=e=>{"descriptionPath"in e&&n(1,i=e.descriptionPath)},e.$$.update=()=>{2&e.$$.dirty&&s(i)},[a,i,function(e){binding_callbacks[e?"unshift":"push"]((()=>{a=e,n(0,a)}))}]}class Description extends SvelteComponent{constructor(e){super(),init(this,e,instance$o,create_fragment$o,safe_not_equal,{descriptionPath:1})}}function create_fragment$n(e){let t;return{c(){t=element("div")},m(n,r){insert(n,t,r),e[2](t)},p:noop,i:noop,o:noop,d(n){n&&detach(t),e[2](null)}}}function instance$n(e,t,n){let r,o,a;component_subscribe(e,selectedCollection,(e=>n(3,r=e))),component_subscribe(e,apiConfig,(e=>n(4,o=e)));let{coverPath:i}=t;const s=e=>{if(!a||!e)return;n(0,a.innerHTML="",a);const t=o.basePath+"/"+r+"/cover/"+encodeURI(e),i=document.createElement("img");i.src=t,a.appendChild(i)};return onMount((()=>s(i))),e.$$set=e=>{"coverPath"in e&&n(1,i=e.coverPath)},e.$$.update=()=>{2&e.$$.dirty&&s(i)},[a,i,function(e){binding_callbacks[e?"unshift":"push"]((()=>{a=e,n(0,a)}))}]}class Cover extends SvelteComponent{constructor(e){super(),init(this,e,instance$n,create_fragment$n,safe_not_equal,{coverPath:1})}}class Debouncer{constructor(e,t){this.callBack=e,this.interval=t}debounce(e){window.clearTimeout(this.timer),this.timer=window.setTimeout(this.callBack,this.interval,[e])}}class Throttler{constructor(e,t){this.callBack=e,this.interval=t,this.skip=!1}throttle(e){this.skip||(this.callBack(e),this.skip=!0,window.setTimeout((()=>{this.skip=!1}),this.interval))}}function create_fragment$m(e){let t,n;return{c(){t=element("span"),n=text(e[0]),attr(t,"class","badge svelte-vu3nmn")},m(e,r){insert(e,t,r),append(t,n)},p(e,[t]){1&t&&set_data(n,e[0])},i:noop,o:noop,d(e){e&&detach(t)}}}function instance$m(e,t,n){let{value:r}=t;return e.$$set=e=>{"value"in e&&n(0,r=e.value)},[r]}class Badge extends SvelteComponent{constructor(e){super(),init(this,e,instance$m,create_fragment$m,safe_not_equal,{value:0})}}function get_each_context$2(e,t,n){const r=e.slice();return r[47]=t[n],r}function get_each_context_1(e,t,n){const r=e.slice();return r[50]=t[n],r[52]=n,r}function get_each_context_2(e,t,n){const r=e.slice();return r[53]=t[n],r}function create_if_block_8$1(e){let t,n,r,o,a,i,s,l,c,u,d,p,h,m;o=new Badge({props:{value:e[3].length}});const _=[create_if_block_9$1,create_else_block$2],f=[];function g(e,t){return e[11]?0:1}s=g(e),l=f[s]=_[s](e);let b=e[3],w=[];for(let t=0;t<b.length;t+=1)w[t]=create_each_block_2(get_each_context_2(e,b,t));const v=e=>transition_out(w[e],1,1,(()=>{w[e]=null}));return{c(){t=element("details"),n=element("summary"),r=text("Subfolders\n          "),create_component(o.$$.fragment),a=space(),i=element("span"),l.c(),u=space(),d=element("ul");for(let e=0;e<w.length;e+=1)w[e].c();attr(i,"class","summary-icons button-like svelte-1gcw2f"),attr(i,"aria-label",c="Sort by "+(e[11]?"Time":"Name")),attr(i,"role","button"),attr(n,"class","svelte-1gcw2f"),attr(d,"class","items-list"),t.open=!0,attr(t,"role","region"),attr(t,"aria-label","Subfolders")},m(l,c){insert(l,t,c),append(t,n),append(n,r),mount_component(o,n,null),append(n,a),append(n,i),f[s].m(i,null),append(t,u),append(t,d);for(let e=0;e<w.length;e+=1)w[e].m(d,null);p=!0,h||(m=listen(i,"click",stop_propagation(prevent_default(e[13]))),h=!0)},p(e,t){const n={};8&t[0]&&(n.value=e[3].length),o.$set(n);let r=s;if(s=g(e),s!==r&&(group_outros(),transition_out(f[r],1,1,(()=>{f[r]=null})),check_outros(),l=f[s],l||(l=f[s]=_[s](e),l.c()),transition_in(l,1),l.m(i,null)),(!p||2048&t[0]&&c!==(c="Sort by "+(e[11]?"Time":"Name")))&&attr(i,"aria-label",c),16396&t[0]){let n;for(b=e[3],n=0;n<b.length;n+=1){const r=get_each_context_2(e,b,n);w[n]?(w[n].p(r,t),transition_in(w[n],1)):(w[n]=create_each_block_2(r),w[n].c(),transition_in(w[n],1),w[n].m(d,null))}for(group_outros(),n=b.length;n<w.length;n+=1)v(n);check_outros()}},i(e){if(!p){transition_in(o.$$.fragment,e),transition_in(l);for(let e=0;e<b.length;e+=1)transition_in(w[e]);p=!0}},o(e){transition_out(o.$$.fragment,e),transition_out(l),w=w.filter(Boolean);for(let e=0;e<w.length;e+=1)transition_out(w[e]);p=!1},d(e){e&&detach(t),destroy_component(o),f[s].d(),destroy_each(w,e),h=!1,m()}}}function create_else_block$2(e){let t,n;return t=new SortAlphabeticalAscending({}),{c(){create_component(t.$$.fragment)},m(e,r){mount_component(t,e,r),n=!0},i(e){n||(transition_in(t.$$.fragment,e),n=!0)},o(e){transition_out(t.$$.fragment,e),n=!1},d(e){destroy_component(t,e)}}}function create_if_block_9$1(e){let t,n;return t=new SortClockAscendingOutline({}),{c(){create_component(t.$$.fragment)},m(e,r){mount_component(t,e,r),n=!0},i(e){n||(transition_in(t.$$.fragment,e),n=!0)},o(e){transition_out(t.$$.fragment,e),n=!1},d(e){destroy_component(t,e)}}}function create_each_block_2(e){let t,n,r,o,a,i;return n=new FolderItem({props:{subfolder:e[53],extended:e[2].type!=FolderType.REGULAR,finished:e[53].finished}}),{c(){t=element("li"),create_component(n.$$.fragment),r=space()},m(s,l){insert(s,t,l),mount_component(n,t,null),append(t,r),o=!0,a||(i=listen(t,"click",(function(){is_function(e[14](e[53].path))&&e[14](e[53].path).apply(this,arguments)})),a=!0)},p(t,r){e=t;const o={};8&r[0]&&(o.subfolder=e[53]),4&r[0]&&(o.extended=e[2].type!=FolderType.REGULAR),8&r[0]&&(o.finished=e[53].finished),n.$set(o)},i(e){o||(transition_in(n.$$.fragment,e),o=!0)},o(e){transition_out(n.$$.fragment,e),o=!1},d(e){e&&detach(t),destroy_component(n),a=!1,i()}}}function create_if_block_6$1(e){let t,n,r,o,a,i,s,l,c,u,d,p,h,m,_=formatTime(e[5])+"";o=new Badge({props:{value:e[4].length}}),s=new ClockOutline({});let f=e[12]&&e[12].folderDownload&&create_if_block_7$1(e),g=e[4],b=[];for(let t=0;t<g.length;t+=1)b[t]=create_each_block_1(get_each_context_1(e,g,t));const w=e=>transition_out(b[e],1,1,(()=>{b[e]=null}));return{c(){t=element("details"),n=element("summary"),r=text("Files\n          "),create_component(o.$$.fragment),a=space(),i=element("span"),create_component(s.$$.fragment),l=space(),c=element("span"),u=text(_),d=space(),f&&f.c(),p=space(),h=element("ul");for(let e=0;e<b.length;e+=1)b[e].c();attr(i,"class","files-duration svelte-1gcw2f"),attr(n,"class","svelte-1gcw2f"),attr(h,"class","items-list"),t.open=!0,attr(t,"role","region"),attr(t,"aria-label","Files")},m(e,_){insert(e,t,_),append(t,n),append(n,r),mount_component(o,n,null),append(n,a),append(n,i),mount_component(s,i,null),append(i,l),append(i,c),append(c,u),append(n,d),f&&f.m(n,null),append(t,p),append(t,h);for(let e=0;e<b.length;e+=1)b[e].m(h,null);m=!0},p(e,t){const r={};if(16&t[0]&&(r.value=e[4].length),o.$set(r),(!m||32&t[0])&&_!==(_=formatTime(e[5])+"")&&set_data(u,_),e[12]&&e[12].folderDownload?f?(f.p(e,t),4096&t[0]&&transition_in(f,1)):(f=create_if_block_7$1(e),f.c(),transition_in(f,1),f.m(n,null)):f&&(group_outros(),transition_out(f,1,1,(()=>{f=null})),check_outros()),65554&t[0]){let n;for(g=e[4],n=0;n<g.length;n+=1){const r=get_each_context_1(e,g,n);b[n]?(b[n].p(r,t),transition_in(b[n],1)):(b[n]=create_each_block_1(r),b[n].c(),transition_in(b[n],1),b[n].m(h,null))}for(group_outros(),n=g.length;n<b.length;n+=1)w(n);check_outros()}},i(e){if(!m){transition_in(o.$$.fragment,e),transition_in(s.$$.fragment,e),transition_in(f);for(let e=0;e<g.length;e+=1)transition_in(b[e]);m=!0}},o(e){transition_out(o.$$.fragment,e),transition_out(s.$$.fragment,e),transition_out(f),b=b.filter(Boolean);for(let e=0;e<b.length;e+=1)transition_out(b[e]);m=!1},d(e){e&&detach(t),destroy_component(o),destroy_component(s),f&&f.d(),destroy_each(b,e)}}}function create_if_block_7$1(e){let t,n,r,o;return r=new BriefcaseDownloadOutline({}),{c(){t=element("a"),n=element("span"),create_component(r.$$.fragment),attr(n,"class","summary-icons svelte-1gcw2f"),attr(n,"aria-label","Download"),attr(t,"href",e[17]()),attr(t,"target","_self")},m(e,a){insert(e,t,a),append(t,n),mount_component(r,n,null),o=!0},p:noop,i(e){o||(transition_in(r.$$.fragment,e),o=!0)},o(e){transition_out(r.$$.fragment,e),o=!1},d(e){e&&detach(t),destroy_component(r)}}}function create_each_block_1(e){let t,n;return t=new FileItem({props:{file:e[50],position:e[52],container:e[1],playFunction:e[16]}}),{c(){create_component(t.$$.fragment)},m(e,r){mount_component(t,e,r),n=!0},p(e,n){const r={};16&n[0]&&(r.file=e[50]),2&n[0]&&(r.container=e[1]),t.$set(r)},i(e){n||(transition_in(t.$$.fragment,e),n=!0)},o(e){transition_out(t.$$.fragment,e),n=!1},d(e){destroy_component(t,e)}}}function create_if_block$4(e){let t,n,r,o=e[10]||e[9]||nonEmpty(e[6]),a=e[7]&&e[8]&&create_if_block_5$2(e),i=o&&create_if_block_1$2(e);return{c(){t=element("div"),a&&a.c(),n=space(),i&&i.c(),attr(t,"class","browser-sidebar svelte-1gcw2f")},m(e,o){insert(e,t,o),a&&a.m(t,null),append(t,n),i&&i.m(t,null),r=!0},p(e,r){e[7]&&e[8]?a?(a.p(e,r),384&r[0]&&transition_in(a,1)):(a=create_if_block_5$2(e),a.c(),transition_in(a,1),a.m(t,n)):a&&(group_outros(),transition_out(a,1,1,(()=>{a=null})),check_outros()),1600&r[0]&&(o=e[10]||e[9]||nonEmpty(e[6])),o?i?(i.p(e,r),1600&r[0]&&transition_in(i,1)):(i=create_if_block_1$2(e),i.c(),transition_in(i,1),i.m(t,null)):i&&(group_outros(),transition_out(i,1,1,(()=>{i=null})),check_outros())},i(e){r||(transition_in(a),transition_in(i),r=!0)},o(e){transition_out(a),transition_out(i),r=!1},d(e){e&&detach(t),a&&a.d(),i&&i.d()}}}function create_if_block_5$2(e){let t,n,r,o,a,i,s,l,c,u,d=formatTime(e[7].position)+"";return r=new PlayCircleOutline({props:{size:"2rem"}}),{c(){t=element("div"),n=element("button"),create_component(r.$$.fragment),o=space(),a=text(e[8]),i=text(" at "),s=text(d),attr(n,"aria-label","Continue on last position in this folder"),attr(n,"class","svelte-1gcw2f"),attr(t,"class","last-position"),attr(t,"id","last-remote-position")},m(d,p){insert(d,t,p),append(t,n),mount_component(r,n,null),append(n,o),append(n,a),append(n,i),append(n,s),l=!0,c||(u=listen(n,"click",e[15]),c=!0)},p(e,t){(!l||256&t[0])&&set_data(a,e[8]),(!l||128&t[0])&&d!==(d=formatTime(e[7].position)+"")&&set_data(s,d)},i(e){l||(transition_in(r.$$.fragment,e),l=!0)},o(e){transition_out(r.$$.fragment,e),l=!1},d(e){e&&detach(t),destroy_component(r),c=!1,u()}}}function create_if_block_1$2(e){let t,n,r,o,a,i,s,l,c=nonEmpty(e[6]),u=e[10]&&create_if_block_4$2(e),d=c&&create_if_block_3$2(e),p=e[9]&&create_if_block_2$2(e);return{c(){t=element("details"),n=element("summary"),n.textContent="Info",r=space(),u&&u.c(),o=space(),d&&d.c(),a=space(),p&&p.c(),attr(n,"class","svelte-1gcw2f"),attr(t,"role","complementary")},m(c,h){insert(c,t,h),append(t,n),append(t,r),u&&u.m(t,null),append(t,o),d&&d.m(t,null),append(t,a),p&&p.m(t,null),t.open=e[0],i=!0,s||(l=listen(t,"toggle",e[21]),s=!0)},p(e,n){e[10]?u?(u.p(e,n),1024&n[0]&&transition_in(u,1)):(u=create_if_block_4$2(e),u.c(),transition_in(u,1),u.m(t,o)):u&&(group_outros(),transition_out(u,1,1,(()=>{u=null})),check_outros()),64&n[0]&&(c=nonEmpty(e[6])),c?d?d.p(e,n):(d=create_if_block_3$2(e),d.c(),d.m(t,a)):d&&(d.d(1),d=null),e[9]?p?(p.p(e,n),512&n[0]&&transition_in(p,1)):(p=create_if_block_2$2(e),p.c(),transition_in(p,1),p.m(t,null)):p&&(group_outros(),transition_out(p,1,1,(()=>{p=null})),check_outros()),1&n[0]&&(t.open=e[0])},i(e){i||(transition_in(u),transition_in(p),i=!0)},o(e){transition_out(u),transition_out(p),i=!1},d(e){e&&detach(t),u&&u.d(),d&&d.d(),p&&p.d(),s=!1,l()}}}function create_if_block_4$2(e){let t,n,r;return n=new Cover({props:{coverPath:e[10]}}),{c(){t=element("div"),create_component(n.$$.fragment),attr(t,"id","folder-cover")},m(e,o){insert(e,t,o),mount_component(n,t,null),r=!0},p(e,t){const r={};1024&t[0]&&(r.coverPath=e[10]),n.$set(r)},i(e){r||(transition_in(n.$$.fragment,e),r=!0)},o(e){transition_out(n.$$.fragment,e),r=!1},d(e){e&&detach(t),destroy_component(n)}}}function create_if_block_3$2(e){let t,n,r,o=sorted(Object.keys(e[6])),a=[];for(let t=0;t<o.length;t+=1)a[t]=create_each_block$2(get_each_context$2(e,o,t));return{c(){t=element("div"),n=element("table"),r=element("tbody");for(let e=0;e<a.length;e+=1)a[e].c();attr(n,"role","grid"),attr(t,"id","folder-tags"),attr(t,"class","svelte-1gcw2f")},m(e,o){insert(e,t,o),append(t,n),append(n,r);for(let e=0;e<a.length;e+=1)a[e].m(r,null)},p(e,t){if(64&t[0]){let n;for(o=sorted(Object.keys(e[6])),n=0;n<o.length;n+=1){const i=get_each_context$2(e,o,n);a[n]?a[n].p(i,t):(a[n]=create_each_block$2(i),a[n].c(),a[n].m(r,null))}for(;n<a.length;n+=1)a[n].d(1);a.length=o.length}},d(e){e&&detach(t),destroy_each(a,e)}}}function create_each_block$2(e){let t,n,r,o,a,i,s,l=e[47]+"",c=e[6][e[47]]+"";return{c(){t=element("tr"),n=element("th"),r=text(l),o=space(),a=element("td"),i=text(c),s=space()},m(e,l){insert(e,t,l),append(t,n),append(n,r),append(t,o),append(t,a),append(a,i),append(t,s)},p(e,t){64&t[0]&&l!==(l=e[47]+"")&&set_data(r,l),64&t[0]&&c!==(c=e[6][e[47]]+"")&&set_data(i,c)},d(e){e&&detach(t)}}}function create_if_block_2$2(e){let t,n,r;return n=new Description({props:{descriptionPath:e[9]}}),{c(){t=element("div"),create_component(n.$$.fragment),attr(t,"id","folder-description")},m(e,o){insert(e,t,o),mount_component(n,t,null),r=!0},p(e,t){const r={};512&t[0]&&(r.descriptionPath=e[9]),n.$set(r)},i(e){r||(transition_in(n.$$.fragment,e),r=!0)},o(e){transition_out(n.$$.fragment,e),r=!1},d(e){e&&detach(t),destroy_component(n)}}}function create_fragment$l(e){let t,n,r,o,a,i=e[3].length>0&&create_if_block_8$1(e),s=e[4].length>0&&create_if_block_6$1(e),l=e[2]&&e[2].type===FolderType.REGULAR&&create_if_block$4(e);return{c(){t=element("div"),n=element("div"),i&&i.c(),r=space(),s&&s.c(),o=space(),l&&l.c(),attr(n,"class","main-browser-panel svelte-1gcw2f"),attr(t,"id","browser"),attr(t,"class","svelte-1gcw2f")},m(e,c){insert(e,t,c),append(t,n),i&&i.m(n,null),append(n,r),s&&s.m(n,null),append(t,o),l&&l.m(t,null),a=!0},p(e,o){e[3].length>0?i?(i.p(e,o),8&o[0]&&transition_in(i,1)):(i=create_if_block_8$1(e),i.c(),transition_in(i,1),i.m(n,r)):i&&(group_outros(),transition_out(i,1,1,(()=>{i=null})),check_outros()),e[4].length>0?s?(s.p(e,o),16&o[0]&&transition_in(s,1)):(s=create_if_block_6$1(e),s.c(),transition_in(s,1),s.m(n,null)):s&&(group_outros(),transition_out(s,1,1,(()=>{s=null})),check_outros()),e[2]&&e[2].type===FolderType.REGULAR?l?(l.p(e,o),4&o[0]&&transition_in(l,1)):(l=create_if_block$4(e),l.c(),transition_in(l,1),l.m(t,null)):l&&(group_outros(),transition_out(l,1,1,(()=>{l=null})),check_outros())},i(e){a||(transition_in(i),transition_in(s),transition_in(l),a=!0)},o(e){transition_out(i),transition_out(s),transition_out(l),a=!1},d(e){e&&detach(t),i&&i.d(),s&&s.d(),l&&l.d()}}}function instance$l(e,t,n){let r,o,a,i,s,l,c,u,d;component_subscribe(e,selectedCollection,(e=>n(25,r=e))),component_subscribe(e,apiConfig,(e=>n(26,o=e))),component_subscribe(e,playList,(e=>n(27,a=e))),component_subscribe(e,currentFolder,(e=>n(2,i=e))),component_subscribe(e,playItem,(e=>n(28,s=e))),component_subscribe(e,isAuthenticated,(e=>n(29,l=e))),component_subscribe(e,group,(e=>n(30,c=e))),component_subscribe(e,colApi,(e=>n(31,u=e))),component_subscribe(e,collections,(e=>n(12,d=e)));const p=getContext("cache"),h=getContext("history"),m=getContext("webSocket");m.addEventListener("message",(e=>{const t=JSON.parse(e.data),n=Object.keys(t)[0],o=t[n];if(WSMessageInType[n]===WSMessageInType.PlayTrackEvent)!function(e,t,n){r!=e&&set_store_value(selectedCollection,r=e,r);const o=splitPath(t).folder;set_store_value(currentFolder,i={value:o,type:FolderType.REGULAR},i),R(o).then((()=>{console.log("folder: "+o),n>=0&&I(n,!0,0)}))}(o.collection,o.path,o.track_position)}));let{container:_}=t,{infoOpen:f=!1}=t;let g=[],b=[];let w,v,y,k,$,x,S,C=!1,A=null,P=!1,E=new window.Intl.Collator(navigator.language);function T(e){return e.sort(((e,t)=>P?e.modified<t.modified?1:e.modified>t.modified?-1:0:E.compare(e.name,t.name)))}async function R(e){var t,o;try{const a=await u.colIdFolderPathGet({colId:r,path:e,group:c||void 0}),l=await(null==p?void 0:p.getCachedPaths(r,e));if(n(4,b=l&&l.length>0?a.files.map((e=>(l.indexOf(e.path)>=0&&(e.cached=!0),e))):a.files),n(3,g=T(a.subfolders)),localStorage.setItem(StorageKeys.LAST_FOLDER,e),n(7,k=a.position),n(8,$=null),k&&b.forEach((e=>{e.path===k.path&&n(8,$=splitExtInName(e).baseName)})),n(5,y=a.totalTime),n(6,A=a.tags),n(9,x=null===(t=a.description)||void 0===t?void 0:t.path),n(10,S=null===(o=a.cover)||void 0===o?void 0:o.path),!s&&void 0===w){const e=localStorage.getItem(StorageKeys.LAST_FILE);if(e){console.debug(`Can try to play ${e} in folder ${i} in collection ${r}`);const t=b.findIndex((t=>t.path===e));if(t>=0){let e;try{e=parseFloat(localStorage.getItem(StorageKeys.LAST_POSITION))}catch(e){console.warn("Invalid last position",e)}M(t,!1,e)}}}w=e,C=!a.isFile&&a.isCollapsed}catch(e){console.error("Cannot load folder",e),404===e.status?set_store_value(currentFolder,i={value:"",type:FolderType.REGULAR},i):401===e.status?set_store_value(isAuthenticated,l=!1,l):(window.alert("Failed to load folder, staying on current"),w&&set_store_value(currentFolder,i={type:FolderType.REGULAR,value:w},i))}finally{v=void 0}}function L(e){return null!=v?{folderType:FolderType.SEARCH,value:v,collection:r,scrollTo:e}:null!=w?{folderType:FolderType.REGULAR,value:w,collection:r,scrollTo:e}:void 0}function I(e,t=!0,n){const o=b[e],l=new PlayItem({file:o,position:e,startPlay:t,time:n});console.log("Action to start to play: "+l.url+" startPlay: "+t),set_store_value(playList,a={files:b,collection:r,folder:i.value,totalTime:y},a),set_store_value(playItem,s=l,s)}function M(e,t=!0,n){if(I(e,t,n),t){let e=formatWSMessage(WSMessageOutType.PlayTrack,{collection:r,path:s.path,track_position:s.position});m.send(JSON.stringify(e))}}const H=[];function z(){return a&&a.collection===r&&a.folder===w}H.push(selectedCollection.subscribe((e=>{null!=e&&(void 0===w?currentFolder||set_store_value(currentFolder,i={value:localStorage.getItem(StorageKeys.LAST_FOLDER)||"",type:FolderType.REGULAR},i):(set_store_value(currentFolder,i={value:"",type:FolderType.REGULAR},i),""===w&&R("")),localStorage.setItem(StorageKeys.LAST_COLLECTION,r.toString()))})));const O=getLocationPath();function B(e){const t=e.item;if(t){const o=e.kind===EventType.FileCached,{collection:i,path:s}=splitUrl(t.originalUrl,O);if(i===r){const e=b.findIndex((e=>e.path==s));if(e>=0){let t=b[e];t.cached=o,n(4,b[e]=t,b)}}if(a){const{folder:e,file:t}=splitPath(s);a.collection==i&&a.folder==e&&playList.update((e=>{const t=e.files.findIndex((e=>e.path==s));return t>=0&&(e.files[t].cached=o),e}))}}}null==p||p.addListener(B);let F=new Debouncer((()=>{h.update(L(_.scrollTop))}),250);const N=()=>F.debounce();return onMount((async()=>{})),onDestroy((()=>{H.forEach((e=>e())),null==p||p.removeListener(B),_.removeEventListener("scroll",N)})),e.$$set=e=>{"container"in e&&n(1,_=e.container),"infoOpen"in e&&n(0,f=e.infoOpen)},e.$$.update=()=>{if(6&e.$$.dirty[0]&&null!=i){let e;const t=i.scrollTo;i.type===FolderType.REGULAR?e=R(i.value):i.type===FolderType.SEARCH&&(e=async function(e){try{const t=await u.colIdSearchGet({colId:r,q:e,group:c});n(3,g=t.subfolders),n(4,b=[]),v=e,n(7,k=void 0),w=void 0,C=!1,n(5,y=void 0),n(6,A=void 0),n(9,x=void 0),n(10,S=void 0)}catch(e){console.error("Cannot search",e),401===e.status?set_store_value(isAuthenticated,l=!1,l):(window.alert("Failed to search"),w&&set_store_value(currentFolder,i={type:FolderType.REGULAR,value:w},i))}}(i.value)),e.then((()=>{h.add(L()),z()||_.scrollTo({top:t||0})}))}2&e.$$.dirty[0]&&(null==_||_.addEventListener("scroll",N))},[f,_,i,g,b,y,A,k,$,x,S,P,d,()=>{n(11,P=!P),n(3,g=T(g))},function(e){return()=>{set_store_value(currentFolder,i={value:e,type:FolderType.REGULAR},i)}},function(){const e=b.findIndex((e=>e.path===k.path));e>=0&&I(e,!0,k.position)},M,function(){return o.basePath+`/${r}/download/${encodeURI(w)}`+(C?"?collapsed":"")},e=>{if(z()){if(e===NavigateTarget.PLAY_ITEM){const e=document.querySelector("div.item.active");if(null!=e){new Scroller(_).scrollToView(e)}}}else set_store_value(selectedCollection,r=a.collection,r),set_store_value(currentFolder,i={value:a.folder,type:FolderType.REGULAR},i)},()=>b,L,function(){f=this.open,n(0,f)}]}class Browser extends SvelteComponent{constructor(e){super(),init(this,e,instance$l,create_fragment$l,safe_not_equal,{container:1,infoOpen:0,navigate:18,getFiles:19,constructHistoryState:20},null,[-1,-1])}get navigate(){return this.$$.ctx[18]}get getFiles(){return this.$$.ctx[19]}get constructHistoryState(){return this.$$.ctx[20]}}function historyEq(e,t){return e.collection===t.collection&&e.folderType===t.folderType&&e.value===t.value}function constructHistoryFragment(e){return`#${e.collection}/${e.folderType===FolderType.SEARCH?"search:":""}${encodeURIComponent(e.value)}`}function parseHistoryFragment(e){const t=/#(\d+)\/(search:)?(.*)/.exec(e);if(t){const e=Number(t[1]);return{folderType:t[2]?FolderType.SEARCH:FolderType.REGULAR,collection:e,value:decodeURIComponent(t[3])}}return null}class HistoryWrapper{constructor(e){this.beforeChange=e,this.onPopup=e=>{const t=e.state;this.beforeChange(),t&&(selectedCollection.set(t.collection),currentFolder.set({type:t.folderType,value:t.value,scrollTo:t.scrollTo}))},window.addEventListener("popstate",this.onPopup)}update(e){e&&history.state&&historyEq(history.state,e)&&window.history.replaceState(e,"")}add(e){!e||history.state&&historyEq(history.state,e)||history.pushState(e,"",constructHistoryFragment(e))}finish(){window.removeEventListener("popstate",this.onPopup)}}function get_each_context$1(e,t,n){const r=e.slice();return r[7]=t[n],r[9]=n,r}function create_each_block$1(e){let t,n,r,o,a,i,s,l,c=e[7]+"";return{c(){t=text("/\n      "),n=element("a"),r=text(c),o=text(" \n      "),attr(n,"href",a=e[2]===FolderType.SEARCH?constructHistoryFragment({folderType:e[2],collection:e[3],value:e[0].value}):constructHistoryFragment({folderType:FolderType.REGULAR,collection:e[3],value:e[1].slice(0,e[9]+1).join("/")})),attr(n,"aria-current",i=e[9]===e[1].length-1?"page":null)},m(a,i){insert(a,t,i),insert(a,n,i),append(n,r),append(n,o),s||(l=listen(n,"click",prevent_default(e[5](e[9]))),s=!0)},p(t,o){e=t,2&o&&c!==(c=e[7]+"")&&set_data(r,c),15&o&&a!==(a=e[2]===FolderType.SEARCH?constructHistoryFragment({folderType:e[2],collection:e[3],value:e[0].value}):constructHistoryFragment({folderType:FolderType.REGULAR,collection:e[3],value:e[1].slice(0,e[9]+1).join("/")}))&&attr(n,"href",a),2&o&&i!==(i=e[9]===e[1].length-1?"page":null)&&attr(n,"aria-current",i)},d(e){e&&detach(t),e&&detach(n),s=!1,l()}}}function create_fragment$k(e){let t,n,r,o,a,i,s,l,c,u=e[1],d=[];for(let t=0;t<u.length;t+=1)d[t]=create_each_block$1(get_each_context$1(e,u,t));return{c(){t=element("nav"),n=element("div"),r=element("a"),o=text("Home"),s=space();for(let e=0;e<d.length;e+=1)d[e].c();attr(r,"href",a=constructHistoryFragment({folderType:FolderType.REGULAR,collection:e[3],value:""})),attr(r,"aria-current",i=0===e[1].length?"page":null),attr(n,"class","breadcrumb svelte-11mkgx1"),attr(t,"aria-label","Breadcrumb"),attr(t,"class","svelte-11mkgx1")},m(a,i){insert(a,t,i),append(t,n),append(n,r),append(r,o),append(n,s);for(let e=0;e<d.length;e+=1)d[e].m(n,null);l||(c=listen(r,"click",prevent_default(e[4])),l=!0)},p(e,[t]){if(8&t&&a!==(a=constructHistoryFragment({folderType:FolderType.REGULAR,collection:e[3],value:""}))&&attr(r,"href",a),2&t&&i!==(i=0===e[1].length?"page":null)&&attr(r,"aria-current",i),47&t){let r;for(u=e[1],r=0;r<u.length;r+=1){const o=get_each_context$1(e,u,r);d[r]?d[r].p(o,t):(d[r]=create_each_block$1(o),d[r].c(),d[r].m(n,null))}for(;r<d.length;r+=1)d[r].d(1);d.length=u.length}},i:noop,o:noop,d(e){e&&detach(t),destroy_each(d,e),l=!1,c()}}}const searchPrefix="Search: ";function instance$k(e,t,n){let r,o;var a;component_subscribe(e,currentFolder,(e=>n(0,r=e))),component_subscribe(e,selectedCollection,(e=>n(3,o=e)));let i=[],s=FolderType.REGULAR;return e.$$.update=()=>{65&e.$$.dirty&&((null==r?void 0:r.type)===FolderType.REGULAR?(n(1,i=(null===n(6,a=r.value)||void 0===a?void 0:a.split("/"))||[]),n(2,s=FolderType.REGULAR)):(null==r?void 0:r.type)===FolderType.SEARCH&&(n(1,i=[searchPrefix+r.value]),n(2,s=FolderType.SEARCH)))},[r,i,s,o,function(){set_store_value(currentFolder,r={value:"",type:FolderType.REGULAR},r)},function(e){return()=>{if(s===FolderType.REGULAR){const t=i.slice(0,e+1).join("/");set_store_value(currentFolder,r={value:t,type:FolderType.REGULAR},r)}else{let e=i[0].substring(searchPrefix.length);set_store_value(currentFolder,r={value:e,type:FolderType.SEARCH},r)}}},a]}class Breadcrumb extends SvelteComponent{constructor(e){super(),init(this,e,instance$k,create_fragment$k,safe_not_equal,{})}}function create_fragment$j(e){let t,n;return{c(){t=svg_element("svg"),n=svg_element("path"),attr(n,"d","M4,12H20V14H4V12M4,9H20V11H4V9M16,4L12,8L8,4H11V1H13V4H16M8,19L12,15L16,19H13V22H11V19H8Z"),attr(n,"fill",e[2]),attr(t,"width",e[0]),attr(t,"height",e[1]),attr(t,"viewBox",e[3])},m(e,r){insert(e,t,r),append(t,n)},p(e,[r]){4&r&&attr(n,"fill",e[2]),1&r&&attr(t,"width",e[0]),2&r&&attr(t,"height",e[1]),8&r&&attr(t,"viewBox",e[3])},i:noop,o:noop,d(e){e&&detach(t)}}}function instance$j(e,t,n){let{size:r="1em"}=t,{width:o=r}=t,{height:a=r}=t,{color:i="currentColor"}=t,{viewBox:s="0 0 24 24"}=t;return e.$$set=e=>{"size"in e&&n(4,r=e.size),"width"in e&&n(0,o=e.width),"height"in e&&n(1,a=e.height),"color"in e&&n(2,i=e.color),"viewBox"in e&&n(3,s=e.viewBox)},[o,a,i,s,r]}class ArrowCollapseVertical extends SvelteComponent{constructor(e){super(),init(this,e,instance$j,create_fragment$j,safe_not_equal,{size:4,width:0,height:1,color:2,viewBox:3})}}function create_fragment$i(e){let t,n;return{c(){t=svg_element("svg"),n=svg_element("path"),attr(n,"d","M16.5,21C13.5,21 12.31,16.76 11.05,12.28C10.14,9.04 9,5 7.5,5C4.11,5 4,11.93 4,12H2C2,11.63 2.06,3 7.5,3C10.5,3 11.71,7.25 12.97,11.74C13.83,14.8 15,19 16.5,19C19.94,19 20.03,12.07 20.03,12H22.03C22.03,12.37 21.97,21 16.5,21Z"),attr(n,"fill",e[2]),attr(t,"width",e[0]),attr(t,"height",e[1]),attr(t,"viewBox",e[3])},m(e,r){insert(e,t,r),append(t,n)},p(e,[r]){4&r&&attr(n,"fill",e[2]),1&r&&attr(t,"width",e[0]),2&r&&attr(t,"height",e[1]),8&r&&attr(t,"viewBox",e[3])},i:noop,o:noop,d(e){e&&detach(t)}}}function instance$i(e,t,n){let{size:r="1em"}=t,{width:o=r}=t,{height:a=r}=t,{color:i="currentColor"}=t,{viewBox:s="0 0 24 24"}=t;return e.$$set=e=>{"size"in e&&n(4,r=e.size),"width"in e&&n(0,o=e.width),"height"in e&&n(1,a=e.height),"color"in e&&n(2,i=e.color),"viewBox"in e&&n(3,s=e.viewBox)},[o,a,i,s,r]}class SineWave extends SvelteComponent{constructor(e){super(),init(this,e,instance$i,create_fragment$i,safe_not_equal,{size:4,width:0,height:1,color:2,viewBox:3})}}function create_fragment$h(e){let t,n;return{c(){t=svg_element("svg"),n=svg_element("path"),attr(n,"d","M20,18H4V8H20M20,6H12L10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6Z"),attr(n,"fill",e[2]),attr(t,"width",e[0]),attr(t,"height",e[1]),attr(t,"viewBox",e[3])},m(e,r){insert(e,t,r),append(t,n)},p(e,[r]){4&r&&attr(n,"fill",e[2]),1&r&&attr(t,"width",e[0]),2&r&&attr(t,"height",e[1]),8&r&&attr(t,"viewBox",e[3])},i:noop,o:noop,d(e){e&&detach(t)}}}function instance$h(e,t,n){let{size:r="1em"}=t,{width:o=r}=t,{height:a=r}=t,{color:i="currentColor"}=t,{viewBox:s="0 0 24 24"}=t;return e.$$set=e=>{"size"in e&&n(4,r=e.size),"width"in e&&n(0,o=e.width),"height"in e&&n(1,a=e.height),"color"in e&&n(2,i=e.color),"viewBox"in e&&n(3,s=e.viewBox)},[o,a,i,s,r]}class FolderOutline extends SvelteComponent{constructor(e){super(),init(this,e,instance$h,create_fragment$h,safe_not_equal,{size:4,width:0,height:1,color:2,viewBox:3})}}function create_fragment$g(e){let t,n;return{c(){t=svg_element("svg"),n=svg_element("path"),attr(n,"d","M14,19H18V5H14M6,19H10V5H6V19Z"),attr(n,"fill",e[2]),attr(t,"width",e[0]),attr(t,"height",e[1]),attr(t,"viewBox",e[3])},m(e,r){insert(e,t,r),append(t,n)},p(e,[r]){4&r&&attr(n,"fill",e[2]),1&r&&attr(t,"width",e[0]),2&r&&attr(t,"height",e[1]),8&r&&attr(t,"viewBox",e[3])},i:noop,o:noop,d(e){e&&detach(t)}}}function instance$g(e,t,n){let{size:r="1em"}=t,{width:o=r}=t,{height:a=r}=t,{color:i="currentColor"}=t,{viewBox:s="0 0 24 24"}=t;return e.$$set=e=>{"size"in e&&n(4,r=e.size),"width"in e&&n(0,o=e.width),"height"in e&&n(1,a=e.height),"color"in e&&n(2,i=e.color),"viewBox"in e&&n(3,s=e.viewBox)},[o,a,i,s,r]}class Pause extends SvelteComponent{constructor(e){super(),init(this,e,instance$g,create_fragment$g,safe_not_equal,{size:4,width:0,height:1,color:2,viewBox:3})}}function create_fragment$f(e){let t,n;return{c(){t=svg_element("svg"),n=svg_element("path"),attr(n,"d","M6,18V6H8V18H6M9.5,12L18,6V18L9.5,12Z"),attr(n,"fill",e[2]),attr(t,"width",e[0]),attr(t,"height",e[1]),attr(t,"viewBox",e[3])},m(e,r){insert(e,t,r),append(t,n)},p(e,[r]){4&r&&attr(n,"fill",e[2]),1&r&&attr(t,"width",e[0]),2&r&&attr(t,"height",e[1]),8&r&&attr(t,"viewBox",e[3])},i:noop,o:noop,d(e){e&&detach(t)}}}function instance$f(e,t,n){let{size:r="1em"}=t,{width:o=r}=t,{height:a=r}=t,{color:i="currentColor"}=t,{viewBox:s="0 0 24 24"}=t;return e.$$set=e=>{"size"in e&&n(4,r=e.size),"width"in e&&n(0,o=e.width),"height"in e&&n(1,a=e.height),"color"in e&&n(2,i=e.color),"viewBox"in e&&n(3,s=e.viewBox)},[o,a,i,s,r]}class SkipPrevious extends SvelteComponent{constructor(e){super(),init(this,e,instance$f,create_fragment$f,safe_not_equal,{size:4,width:0,height:1,color:2,viewBox:3})}}function create_fragment$e(e){let t,n;return{c(){t=svg_element("svg"),n=svg_element("path"),attr(n,"d","M16,18H18V6H16M6,18L14.5,12L6,6V18Z"),attr(n,"fill",e[2]),attr(t,"width",e[0]),attr(t,"height",e[1]),attr(t,"viewBox",e[3])},m(e,r){insert(e,t,r),append(t,n)},p(e,[r]){4&r&&attr(n,"fill",e[2]),1&r&&attr(t,"width",e[0]),2&r&&attr(t,"height",e[1]),8&r&&attr(t,"viewBox",e[3])},i:noop,o:noop,d(e){e&&detach(t)}}}function instance$e(e,t,n){let{size:r="1em"}=t,{width:o=r}=t,{height:a=r}=t,{color:i="currentColor"}=t,{viewBox:s="0 0 24 24"}=t;return e.$$set=e=>{"size"in e&&n(4,r=e.size),"width"in e&&n(0,o=e.width),"height"in e&&n(1,a=e.height),"color"in e&&n(2,i=e.color),"viewBox"in e&&n(3,s=e.viewBox)},[o,a,i,s,r]}class SkipNext extends SvelteComponent{constructor(e){super(),init(this,e,instance$e,create_fragment$e,safe_not_equal,{size:4,width:0,height:1,color:2,viewBox:3})}}function create_fragment$d(e){let t,n;return{c(){t=svg_element("svg"),n=svg_element("path"),attr(n,"d","M12.5,8C9.85,8 7.45,9 5.6,10.6L2,7V16H11L7.38,12.38C8.77,11.22 10.54,10.5 12.5,10.5C16.04,10.5 19.05,12.81 20.1,16L22.47,15.22C21.08,11.03 17.15,8 12.5,8Z"),attr(n,"fill",e[2]),attr(t,"width",e[0]),attr(t,"height",e[1]),attr(t,"viewBox",e[3])},m(e,r){insert(e,t,r),append(t,n)},p(e,[r]){4&r&&attr(n,"fill",e[2]),1&r&&attr(t,"width",e[0]),2&r&&attr(t,"height",e[1]),8&r&&attr(t,"viewBox",e[3])},i:noop,o:noop,d(e){e&&detach(t)}}}function instance$d(e,t,n){let{size:r="1em"}=t,{width:o=r}=t,{height:a=r}=t,{color:i="currentColor"}=t,{viewBox:s="0 0 24 24"}=t;return e.$$set=e=>{"size"in e&&n(4,r=e.size),"width"in e&&n(0,o=e.width),"height"in e&&n(1,a=e.height),"color"in e&&n(2,i=e.color),"viewBox"in e&&n(3,s=e.viewBox)},[o,a,i,s,r]}class Undo extends SvelteComponent{constructor(e){super(),init(this,e,instance$d,create_fragment$d,safe_not_equal,{size:4,width:0,height:1,color:2,viewBox:3})}}function create_fragment$c(e){let t,n;return{c(){t=svg_element("svg"),n=svg_element("path"),attr(n,"d","M18.4,10.6C16.55,9 14.15,8 11.5,8C6.85,8 2.92,11.03 1.54,15.22L3.9,16C4.95,12.81 7.95,10.5 11.5,10.5C13.45,10.5 15.23,11.22 16.62,12.38L13,16H22V7L18.4,10.6Z"),attr(n,"fill",e[2]),attr(t,"width",e[0]),attr(t,"height",e[1]),attr(t,"viewBox",e[3])},m(e,r){insert(e,t,r),append(t,n)},p(e,[r]){4&r&&attr(n,"fill",e[2]),1&r&&attr(t,"width",e[0]),2&r&&attr(t,"height",e[1]),8&r&&attr(t,"viewBox",e[3])},i:noop,o:noop,d(e){e&&detach(t)}}}function instance$c(e,t,n){let{size:r="1em"}=t,{width:o=r}=t,{height:a=r}=t,{color:i="currentColor"}=t,{viewBox:s="0 0 24 24"}=t;return e.$$set=e=>{"size"in e&&n(4,r=e.size),"width"in e&&n(0,o=e.width),"height"in e&&n(1,a=e.height),"color"in e&&n(2,i=e.color),"viewBox"in e&&n(3,s=e.viewBox)},[o,a,i,s,r]}class Redo extends SvelteComponent{constructor(e){super(),init(this,e,instance$c,create_fragment$c,safe_not_equal,{size:4,width:0,height:1,color:2,viewBox:3})}}function create_fragment$b(e){let t,n;return{c(){t=svg_element("svg"),n=svg_element("path"),attr(n,"d","M12 1.38L9.14 12.06C8.8 13.1 9.04 14.29 9.86 15.12C11.04 16.29 12.94 16.29 14.11 15.12C14.9 14.33 15.16 13.2 14.89 12.21M14.6 3.35L15.22 5.68C18.04 6.92 20 9.73 20 13C20 15.21 19.11 17.21 17.66 18.65H17.65C17.26 19.04 17.26 19.67 17.65 20.06C18.04 20.45 18.68 20.45 19.07 20.07C20.88 18.26 22 15.76 22 13C22 8.38 18.86 4.5 14.6 3.35M9.4 3.36C5.15 4.5 2 8.4 2 13C2 15.76 3.12 18.26 4.93 20.07C5.32 20.45 5.95 20.45 6.34 20.06C6.73 19.67 6.73 19.04 6.34 18.65C4.89 17.2 4 15.21 4 13C4 9.65 5.94 6.86 8.79 5.65"),attr(n,"fill",e[2]),attr(t,"width",e[0]),attr(t,"height",e[1]),attr(t,"viewBox",e[3])},m(e,r){insert(e,t,r),append(t,n)},p(e,[r]){4&r&&attr(n,"fill",e[2]),1&r&&attr(t,"width",e[0]),2&r&&attr(t,"height",e[1]),8&r&&attr(t,"viewBox",e[3])},i:noop,o:noop,d(e){e&&detach(t)}}}function instance$b(e,t,n){let{size:r="1em"}=t,{width:o=r}=t,{height:a=r}=t,{color:i="currentColor"}=t,{viewBox:s="0 0 24 24"}=t;return e.$$set=e=>{"size"in e&&n(4,r=e.size),"width"in e&&n(0,o=e.width),"height"in e&&n(1,a=e.height),"color"in e&&n(2,i=e.color),"viewBox"in e&&n(3,s=e.viewBox)},[o,a,i,s,r]}class SpeedometerMedium extends SvelteComponent{constructor(e){super(),init(this,e,instance$b,create_fragment$b,safe_not_equal,{size:4,width:0,height:1,color:2,viewBox:3})}}function create_fragment$a(e){let t,n;return{c(){t=svg_element("svg"),n=svg_element("path"),attr(n,"d","M14,3.23V5.29C16.89,6.15 19,8.83 19,12C19,15.17 16.89,17.84 14,18.7V20.77C18,19.86 21,16.28 21,12C21,7.72 18,4.14 14,3.23M16.5,12C16.5,10.23 15.5,8.71 14,7.97V16C15.5,15.29 16.5,13.76 16.5,12M3,9V15H7L12,20V4L7,9H3Z"),attr(n,"fill",e[2]),attr(t,"width",e[0]),attr(t,"height",e[1]),attr(t,"viewBox",e[3])},m(e,r){insert(e,t,r),append(t,n)},p(e,[r]){4&r&&attr(n,"fill",e[2]),1&r&&attr(t,"width",e[0]),2&r&&attr(t,"height",e[1]),8&r&&attr(t,"viewBox",e[3])},i:noop,o:noop,d(e){e&&detach(t)}}}function instance$a(e,t,n){let{size:r="1em"}=t,{width:o=r}=t,{height:a=r}=t,{color:i="currentColor"}=t,{viewBox:s="0 0 24 24"}=t;return e.$$set=e=>{"size"in e&&n(4,r=e.size),"width"in e&&n(0,o=e.width),"height"in e&&n(1,a=e.height),"color"in e&&n(2,i=e.color),"viewBox"in e&&n(3,s=e.viewBox)},[o,a,i,s,r]}class VolumeHigh extends SvelteComponent{constructor(e){super(),init(this,e,instance$a,create_fragment$a,safe_not_equal,{size:4,width:0,height:1,color:2,viewBox:3})}}function create_fragment$9(e){let t,n;return{c(){t=svg_element("svg"),n=svg_element("path"),attr(n,"d","M7.41,15.41L12,10.83L16.59,15.41L18,14L12,8L6,14L7.41,15.41Z"),attr(n,"fill",e[2]),attr(t,"width",e[0]),attr(t,"height",e[1]),attr(t,"viewBox",e[3])},m(e,r){insert(e,t,r),append(t,n)},p(e,[r]){4&r&&attr(n,"fill",e[2]),1&r&&attr(t,"width",e[0]),2&r&&attr(t,"height",e[1]),8&r&&attr(t,"viewBox",e[3])},i:noop,o:noop,d(e){e&&detach(t)}}}function instance$9(e,t,n){let{size:r="1em"}=t,{width:o=r}=t,{height:a=r}=t,{color:i="currentColor"}=t,{viewBox:s="0 0 24 24"}=t;return e.$$set=e=>{"size"in e&&n(4,r=e.size),"width"in e&&n(0,o=e.width),"height"in e&&n(1,a=e.height),"color"in e&&n(2,i=e.color),"viewBox"in e&&n(3,s=e.viewBox)},[o,a,i,s,r]}class ChevronUp extends SvelteComponent{constructor(e){super(),init(this,e,instance$9,create_fragment$9,safe_not_equal,{size:4,width:0,height:1,color:2,viewBox:3})}}function create_fragment$8(e){let t,n;return{c(){t=svg_element("svg"),n=svg_element("path"),attr(n,"d","M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"),attr(n,"fill",e[2]),attr(t,"width",e[0]),attr(t,"height",e[1]),attr(t,"viewBox",e[3])},m(e,r){insert(e,t,r),append(t,n)},p(e,[r]){4&r&&attr(n,"fill",e[2]),1&r&&attr(t,"width",e[0]),2&r&&attr(t,"height",e[1]),8&r&&attr(t,"viewBox",e[3])},i:noop,o:noop,d(e){e&&detach(t)}}}function instance$8(e,t,n){let{size:r="1em"}=t,{width:o=r}=t,{height:a=r}=t,{color:i="currentColor"}=t,{viewBox:s="0 0 24 24"}=t;return e.$$set=e=>{"size"in e&&n(4,r=e.size),"width"in e&&n(0,o=e.width),"height"in e&&n(1,a=e.height),"color"in e&&n(2,i=e.color),"viewBox"in e&&n(3,s=e.viewBox)},[o,a,i,s,r]}class ChevronDown extends SvelteComponent{constructor(e){super(),init(this,e,instance$8,create_fragment$8,safe_not_equal,{size:4,width:0,height:1,color:2,viewBox:3})}}function create_fragment$7(e){let t,n;return{c(){t=element("div"),n=element("div"),attr(n,"class","cache-bar svelte-7hdto7"),set_style(n,"width","Opx"),attr(t,"class","player-cache svelte-7hdto7")},m(r,o){insert(r,t,o),append(t,n),e[5](n),e[6](t)},p:noop,i:noop,o:noop,d(n){n&&detach(t),e[5](null),e[6](null)}}}function instance$7(e,t,n){let r,o,{offset:a=0}=t,{totalTime:i=0}=t,{ranges:s}=t,l="";function c(){if(!r)return;let e=r.offsetWidth,t=e*a/i;for(;r.firstChild;)r.removeChild(r.firstChild);for(const n of s){let o=n.start,a=n.end;o=t+e*o/i,a=t+e*a/i,a=Math.min(e,a);let s=document.createElement("div");s.setAttribute("class","cache-bar "+l),s.style.left=`${o}px`,s.style.width=a-o+"px",r.appendChild(s)}}return onMount((()=>{l=Array.from(o.classList).filter((e=>e.includes("svelte-")))[0]})),windowSize.subscribe((()=>{r&&c()})),e.$$set=e=>{"offset"in e&&n(2,a=e.offset),"totalTime"in e&&n(3,i=e.totalTime),"ranges"in e&&n(4,s=e.ranges)},e.$$.update=()=>{16&e.$$.dirty&&s&&c()},[r,o,a,i,s,function(e){binding_callbacks[e?"unshift":"push"]((()=>{o=e,n(1,o)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{r=e,n(0,r)}))}]}class CacheIndicator extends SvelteComponent{constructor(e){super(),init(this,e,instance$7,create_fragment$7,safe_not_equal,{offset:2,totalTime:3,ranges:4})}}const MINUTE=6e4,YEAR=31556952e3;function calculateAutorewind(e){const t=Date.now()-e;return t<1e4?0:t<5*MINUTE?2:t<30*MINUTE?15:t<YEAR?30:0}const{isNaN:isNaN_1}=globals;function create_else_block_2$1(e){let t,n;return t=new ChevronUp({props:{size:"48px"}}),{c(){create_component(t.$$.fragment)},m(e,r){mount_component(t,e,r),n=!0},i(e){n||(transition_in(t.$$.fragment,e),n=!0)},o(e){transition_out(t.$$.fragment,e),n=!1},d(e){destroy_component(t,e)}}}function create_if_block_5$1(e){let t,n;return t=new ChevronDown({props:{size:"48px"}}),{c(){create_component(t.$$.fragment)},m(e,r){mount_component(t,e,r),n=!0},i(e){n||(transition_in(t.$$.fragment,e),n=!0)},o(e){transition_out(t.$$.fragment,e),n=!1},d(e){destroy_component(t,e)}}}function create_if_block_4$1(e){let t,n,r,o,a,i,s,l,c,u,d,p,h,m,_,f,g,b,w,v,y,k=e[6].toFixed(1)+"";return o=new VolumeHigh({props:{size:fileIconSize}}),h=new SpeedometerMedium({props:{size:fileIconSize}}),{c(){t=element("div"),n=element("div"),r=element("span"),create_component(o.$$.fragment),a=space(),i=element("input"),s=space(),l=element("span"),c=text(e[7]),u=space(),d=element("div"),p=element("span"),create_component(h.$$.fragment),m=space(),_=element("input"),f=space(),g=element("span"),b=text(k),attr(i,"tabindex","0"),attr(i,"type","range"),attr(i,"name","volume"),attr(i,"id","volume"),attr(i,"min","0"),attr(i,"max","100"),attr(i,"step","1"),attr(i,"aria-label","Volume"),attr(l,"class","control-value"),attr(n,"class","volume-control slider-control extra-control svelte-1e7a55i"),attr(_,"tabindex","0"),attr(_,"type","range"),attr(_,"name","playback-speed"),attr(_,"id","playback-speed"),attr(_,"min","0.5"),attr(_,"max","3"),attr(_,"step","0.1"),attr(_,"aria-label","Playback Speed"),attr(g,"class","control-value"),attr(d,"class","speed-control slider-control extra-control svelte-1e7a55i"),attr(t,"class","extra-controls svelte-1e7a55i")},m(k,$){insert(k,t,$),append(t,n),append(n,r),mount_component(o,r,null),append(n,a),append(n,i),set_input_value(i,e[7]),append(n,s),append(n,l),append(l,c),append(t,u),append(t,d),append(d,p),mount_component(h,p,null),append(d,m),append(d,_),set_input_value(_,e[6]),append(d,f),append(d,g),append(g,b),w=!0,v||(y=[listen(i,"change",e[45]),listen(i,"input",e[45]),listen(i,"change",e[28]),listen(_,"change",e[46]),listen(_,"input",e[46])],v=!0)},p(e,t){128&t[0]&&set_input_value(i,e[7]),(!w||128&t[0])&&set_data(c,e[7]),64&t[0]&&set_input_value(_,e[6]),(!w||64&t[0])&&k!==(k=e[6].toFixed(1)+"")&&set_data(b,k)},i(e){w||(transition_in(o.$$.fragment,e),transition_in(h.$$.fragment,e),w=!0)},o(e){transition_out(o.$$.fragment,e),transition_out(h.$$.fragment,e),w=!1},d(e){e&&detach(t),destroy_component(o),destroy_component(h),v=!1,run_all(y)}}}function create_else_block_1$1(e){let t,n;return t=new SineWave({props:{size:fileIconSize}}),{c(){create_component(t.$$.fragment)},m(e,r){mount_component(t,e,r),n=!0},p:noop,i(e){n||(transition_in(t.$$.fragment,e),n=!0)},o(e){transition_out(t.$$.fragment,e),n=!1},d(e){destroy_component(t,e)}}}function create_if_block_3$1(e){let t,n;return t=new ArrowCollapseVertical({props:{size:fileIconSize}}),{c(){create_component(t.$$.fragment)},m(e,r){mount_component(t,e,r),n=!0},p:noop,i(e){n||(transition_in(t.$$.fragment,e),n=!0)},o(e){transition_out(t.$$.fragment,e),n=!1},d(e){destroy_component(t,e)}}}function create_if_block_2$1(e){let t,n;return t=new Cached({props:{size:fileIconSize}}),{c(){create_component(t.$$.fragment)},m(e,r){mount_component(t,e,r),n=!0},p:noop,i(e){n||(transition_in(t.$$.fragment,e),n=!0)},o(e){transition_out(t.$$.fragment,e),n=!1},d(e){destroy_component(t,e)}}}function create_if_block_1$1(e){let t,n,r,o,a=!1,i=!0;function s(){cancelAnimationFrame(n),t.paused||(n=raf(s),a=!0),e[48].call(t)}return{c(){t=element("audio"),attr(t,"preload","none"),attr(t,"crossorigin","use-credentials"),t.autoplay="",t.muted="",attr(t,"playsinline",""),void 0===e[1]&&add_render_callback((()=>e[47].call(t)))},m(n,a){insert(n,t,a),isNaN_1(e[14])||(t.volume=e[14]),isNaN_1(e[6])||(t.playbackRate=e[6]),e[52](t),r||(o=[listen(t,"durationchange",e[47]),listen(t,"timeupdate",s),listen(t,"play",e[49]),listen(t,"pause",e[49]),listen(t,"volumechange",e[50]),listen(t,"ratechange",e[51]),listen(t,"error",e[27]),listen(t,"ended",e[32])],r=!0)},p(e,n){!a&&8&n[0]&&!isNaN_1(e[3])&&(t.currentTime=e[3]),a=!1,16&n[0]&&i!==(i=e[4])&&t[i?"pause":"play"](),16384&n[0]&&!isNaN_1(e[14])&&(t.volume=e[14]),64&n[0]&&!isNaN_1(e[6])&&(t.playbackRate=e[6])},d(n){n&&detach(t),e[52](null),r=!1,run_all(o)}}}function create_else_block$1(e){let t,n;return t=new Pause({props:{size:controlSize}}),{c(){create_component(t.$$.fragment)},m(e,r){mount_component(t,e,r),n=!0},p:noop,i(e){n||(transition_in(t.$$.fragment,e),n=!0)},o(e){transition_out(t.$$.fragment,e),n=!1},d(e){destroy_component(t,e)}}}function create_if_block$3(e){let t,n;return t=new Play({props:{size:controlSize}}),{c(){create_component(t.$$.fragment)},m(e,r){mount_component(t,e,r),n=!0},p:noop,i(e){n||(transition_in(t.$$.fragment,e),n=!0)},o(e){transition_out(t.$$.fragment,e),n=!1},d(e){destroy_component(t,e)}}}function create_fragment$6(e){let t,n,r,o,a,i,s,l,c,u,d,p,h,m,_,f,g,b,w,v,y,k,$,x,S,C,A,P,E,T,R,L,I,M,H,z,O,B,F,N,j,q,D,U,G,V,W,J,K,X,Q,Z,Y,ee,te,ne,re,oe,ae,ie,se,le,ce,ue,de,pe,he,me,_e,fe,ge,be,we,ve,ye,ke,$e,xe,Se,Ce=(e[19]?e[17]+1:0)+"";const Ae=[create_if_block_5$1,create_else_block_2$1],Pe=[];function Ee(e,t){return e[11]?0:1}r=Ee(e),o=Pe[r]=Ae[r](e);let Te=e[11]&&create_if_block_4$1(e);u=new FolderOutline({props:{size:fileIconSize}});const Re=[create_if_block_2$1,create_if_block_3$1,create_else_block_1$1],Le=[];function Ie(e,t){return e[18]?0:e[8]?1:2}P=Ie(e),E=Le[P]=Re[P](e);let Me=e[26]===e[25]&&create_if_block_1$1(e);ee=new CacheIndicator({props:{ranges:e[13],totalTime:e[2]}}),le=new SkipPrevious({props:{size:controlSize}}),de=new Undo({props:{size:controlSize}});const He=[create_if_block$3,create_else_block$1],ze=[];function Oe(e,t){return e[4]?0:1}return me=Oe(e),_e=ze[me]=He[me](e),we=new Redo({props:{size:controlSize}}),ke=new SkipNext({props:{size:controlSize}}),{c(){t=element("div"),n=element("div"),o.c(),a=space(),Te&&Te.c(),i=space(),s=element("div"),l=element("div"),c=element("label"),create_component(u.$$.fragment),d=space(),p=element("span"),h=text(e[16]),m=space(),_=element("div"),f=element("div"),g=text(e[21]),b=space(),w=element("div"),v=element("progress"),k=space(),$=element("div"),x=text(e[23]),S=space(),C=element("div"),A=element("label"),E.c(),R=space(),L=element("span"),I=text("("),M=element("span"),H=text(Ce),z=text("/"),O=element("span"),B=text(e[19]),F=text(")"),N=space(),j=element("span"),q=text(e[15]),D=space(),U=element("div"),Me&&Me.c(),G=space(),V=element("div"),W=text(e[20]),J=space(),K=element("div"),X=element("div"),Q=element("input"),Y=space(),create_component(ee.$$.fragment),te=space(),ne=element("div"),re=text(e[22]),oe=space(),ae=element("div"),ie=element("div"),se=element("span"),create_component(le.$$.fragment),ce=space(),ue=element("span"),create_component(de.$$.fragment),pe=space(),he=element("span"),_e.c(),ge=space(),be=element("span"),create_component(we.$$.fragment),ve=space(),ye=element("span"),create_component(ke.$$.fragment),attr(n,"tabindex","0"),attr(n,"role","button"),attr(n,"aria-label","More Controls"),attr(n,"aria-expanded",e[11]),attr(n,"class","player-expand-button button-like svelte-1e7a55i"),attr(t,"class","player-separator svelte-1e7a55i"),attr(c,"for","folder-name"),attr(c,"class","icon clickable svelte-1e7a55i"),attr(p,"role","link"),attr(p,"aria-label","Navigate to currently playing folder"),attr(p,"id","folder-name"),attr(p,"class","item-name link-like svelte-1e7a55i"),attr(p,"dir","rtl"),attr(l,"class","item-info svelte-1e7a55i"),attr(l,"id","folder-info"),attr(f,"class","play-time svelte-1e7a55i"),attr(f,"aria-label","Current time in whole folder"),attr(v,"aria-label","Total folder playback progress"),attr(v,"aria-valuetext",y=`${e[21]} of ${e[23]}`),v.value=e[10],attr(v,"max",e[0]),attr(v,"class","svelte-1e7a55i"),attr(w,"class","progress total svelte-1e7a55i"),attr($,"class","total-time svelte-1e7a55i"),attr($,"aria-label","Total playback time of whole folder"),attr(_,"id","total-progress"),attr(_,"class","svelte-1e7a55i"),attr(A,"for","file-name"),attr(A,"class","clickable svelte-1e7a55i"),attr(A,"title",T=e[18]?"Playing cached file":e[8]?"Playing transcoded file":"Playing streamed file"),attr(L,"class","label clickable svelte-1e7a55i"),attr(L,"aria-label","Position of currently playing file in folder"),attr(j,"role","link"),attr(j,"aria-label","Locate currently playing file"),attr(j,"id","file-name"),attr(j,"class","item-name link-like svelte-1e7a55i"),attr(C,"class","item-info svelte-1e7a55i"),attr(C,"id","file-info"),attr(s,"class","info svelte-1e7a55i"),attr(V,"class","play-time svelte-1e7a55i"),attr(V,"aria-label","Current time in file"),attr(Q,"class","allow-global-keys svelte-1e7a55i"),attr(Q,"type","range"),attr(Q,"id","playback-progress"),attr(Q,"min","0"),attr(Q,"max",e[2]),attr(Q,"aria-label","File Playback Time"),attr(Q,"aria-valuetext",Z=`${e[20]} of ${e[22]}`),attr(X,"class","progress-bar svelte-1e7a55i"),attr(K,"class","progress svelte-1e7a55i"),attr(ne,"class","total-time svelte-1e7a55i"),attr(ne,"aria-label","Total time of current file"),attr(U,"class","player svelte-1e7a55i"),attr(se,"tabindex","0"),attr(se,"role","button"),attr(se,"aria-label","Previous"),attr(se,"class","control-button button-like svelte-1e7a55i"),attr(ue,"tabindex","0"),attr(ue,"role","button"),attr(ue,"aria-label","Jump back"),attr(ue,"class","control-button button-like svelte-1e7a55i"),attr(ue,"title","You can also use Left Arrow key"),attr(he,"tabindex","0"),attr(he,"role","button"),attr(he,"aria-label",fe=e[4]?"Play":"Pause"),attr(he,"title","You can also use Space key"),attr(he,"class","control-button button-like svelte-1e7a55i"),toggle_class(he,"blink",e[12]),attr(be,"tabindex","0"),attr(be,"role","button"),attr(be,"aria-label","Jump ahead"),attr(be,"class","control-button button-like svelte-1e7a55i"),attr(be,"title","You can also use Right Arrow key"),attr(ye,"tabindex","0"),attr(ye,"role","button"),attr(ye,"aria-label","Next"),attr(ye,"class","control-button button-like svelte-1e7a55i"),attr(ie,"class","player-controls svelte-1e7a55i"),attr(ae,"class","controls-bar")},m(o,y){insert(o,t,y),append(t,n),Pe[r].m(n,null),insert(o,a,y),Te&&Te.m(o,y),insert(o,i,y),insert(o,s,y),append(s,l),append(l,c),mount_component(u,c,null),append(l,d),append(l,p),append(p,h),append(s,m),append(s,_),append(_,f),append(f,g),append(_,b),append(_,w),append(w,v),append(_,k),append(_,$),append($,x),append(s,S),append(s,C),append(C,A),Le[P].m(A,null),append(C,R),append(C,L),append(L,I),append(L,M),append(M,H),append(L,z),append(L,O),append(O,B),append(L,F),append(C,N),append(C,j),append(j,q),insert(o,D,y),insert(o,U,y),Me&&Me.m(U,null),append(U,G),append(U,V),append(V,W),append(U,J),append(U,K),append(K,X),append(X,Q),set_input_value(Q,e[9]),append(X,Y),mount_component(ee,X,null),append(U,te),append(U,ne),append(ne,re),insert(o,oe,y),insert(o,ae,y),append(ae,ie),append(ie,se),mount_component(le,se,null),append(ie,ce),append(ie,ue),mount_component(de,ue,null),append(ie,pe),append(ie,he),ze[me].m(he,null),append(ie,ge),append(ie,be),mount_component(we,be,null),append(ie,ve),append(ie,ye),mount_component(ke,ye,null),$e=!0,xe||(Se=[listen(n,"click",e[44]),listen(c,"click",e[33]),listen(p,"click",e[33]),listen(A,"click",e[34]),listen(L,"click",e[34]),listen(j,"click",e[34]),listen(Q,"change",e[53]),listen(Q,"input",e[53]),listen(Q,"mousedown",e[29]),listen(Q,"touchstart",e[29],{passive:!0}),listen(Q,"keydown",keydown_handler),listen(se,"click",e[35]),listen(ue,"click",(function(){is_function(e[30](-e[24].jumpBackTime))&&e[30](-e[24].jumpBackTime).apply(this,arguments)})),listen(he,"click",e[31]),listen(be,"click",(function(){is_function(e[30](e[24].jumpForwardTime))&&e[30](e[24].jumpForwardTime).apply(this,arguments)})),listen(ye,"click",e[36])],xe=!0)},p(t,a){let s=r;r=Ee(e=t),r!==s&&(group_outros(),transition_out(Pe[s],1,1,(()=>{Pe[s]=null})),check_outros(),o=Pe[r],o||(o=Pe[r]=Ae[r](e),o.c()),transition_in(o,1),o.m(n,null)),(!$e||2048&a[0])&&attr(n,"aria-expanded",e[11]),e[11]?Te?(Te.p(e,a),2048&a[0]&&transition_in(Te,1)):(Te=create_if_block_4$1(e),Te.c(),transition_in(Te,1),Te.m(i.parentNode,i)):Te&&(group_outros(),transition_out(Te,1,1,(()=>{Te=null})),check_outros()),(!$e||65536&a[0])&&set_data(h,e[16]),(!$e||2097152&a[0])&&set_data(g,e[21]),(!$e||10485760&a[0]&&y!==(y=`${e[21]} of ${e[23]}`))&&attr(v,"aria-valuetext",y),(!$e||1024&a[0])&&(v.value=e[10]),(!$e||1&a[0])&&attr(v,"max",e[0]),(!$e||8388608&a[0])&&set_data(x,e[23]);let l=P;P=Ie(e),P===l?Le[P].p(e,a):(group_outros(),transition_out(Le[l],1,1,(()=>{Le[l]=null})),check_outros(),E=Le[P],E?E.p(e,a):(E=Le[P]=Re[P](e),E.c()),transition_in(E,1),E.m(A,null)),(!$e||262400&a[0]&&T!==(T=e[18]?"Playing cached file":e[8]?"Playing transcoded file":"Playing streamed file"))&&attr(A,"title",T),(!$e||655360&a[0])&&Ce!==(Ce=(e[19]?e[17]+1:0)+"")&&set_data(H,Ce),(!$e||524288&a[0])&&set_data(B,e[19]),(!$e||32768&a[0])&&set_data(q,e[15]),e[26]===e[25]?Me?Me.p(e,a):(Me=create_if_block_1$1(e),Me.c(),Me.m(U,G)):Me&&(Me.d(1),Me=null),(!$e||1048576&a[0])&&set_data(W,e[20]),(!$e||4&a[0])&&attr(Q,"max",e[2]),(!$e||5242880&a[0]&&Z!==(Z=`${e[20]} of ${e[22]}`))&&attr(Q,"aria-valuetext",Z),512&a[0]&&set_input_value(Q,e[9]);const c={};8192&a[0]&&(c.ranges=e[13]),4&a[0]&&(c.totalTime=e[2]),ee.$set(c),(!$e||4194304&a[0])&&set_data(re,e[22]);let u=me;me=Oe(e),me===u?ze[me].p(e,a):(group_outros(),transition_out(ze[u],1,1,(()=>{ze[u]=null})),check_outros(),_e=ze[me],_e?_e.p(e,a):(_e=ze[me]=He[me](e),_e.c()),transition_in(_e,1),_e.m(he,null)),(!$e||16&a[0]&&fe!==(fe=e[4]?"Play":"Pause"))&&attr(he,"aria-label",fe),4096&a[0]&&toggle_class(he,"blink",e[12])},i(e){$e||(transition_in(o),transition_in(Te),transition_in(u.$$.fragment,e),transition_in(E),transition_in(ee.$$.fragment,e),transition_in(le.$$.fragment,e),transition_in(de.$$.fragment,e),transition_in(_e),transition_in(we.$$.fragment,e),transition_in(ke.$$.fragment,e),$e=!0)},o(e){transition_out(o),transition_out(Te),transition_out(u.$$.fragment,e),transition_out(E),transition_out(ee.$$.fragment,e),transition_out(le.$$.fragment,e),transition_out(de.$$.fragment,e),transition_out(_e),transition_out(we.$$.fragment,e),transition_out(ke.$$.fragment,e),$e=!1},d(e){e&&detach(t),Pe[r].d(),e&&detach(a),Te&&Te.d(e),e&&detach(i),e&&detach(s),destroy_component(u),Le[P].d(),e&&detach(D),e&&detach(U),Me&&Me.d(),destroy_component(ee),e&&detach(oe),e&&detach(ae),destroy_component(le),destroy_component(de),ze[me].d(),destroy_component(we),destroy_component(ke),xe=!1,run_all(Se)}}}const fileIconSize="1.5rem",controlSize="48px",keydown_handler=e=>e.preventDefault();function instance$6(e,t,n){let r,o,a,i,s,l,c,u,d,p,h,m,_;component_subscribe(e,playItem,(e=>n(59,c=e))),component_subscribe(e,config,(e=>n(24,u=e))),component_subscribe(e,selectedCollection,(e=>n(60,d=e))),component_subscribe(e,playList,(e=>n(43,p=e))),component_subscribe(e,activeDeviceId,(e=>n(25,h=e))),component_subscribe(e,deviceId,(e=>n(26,m=e))),component_subscribe(e,positionWsApi,(e=>n(61,_=e)));const f=getContext("webSocket");f.addEventListener("message",(e=>{const t=JSON.parse(e.data),r=Object.keys(t)[0],o=t[r];switch(WSMessageInType[r]){case WSMessageInType.RewindToEvent:te(o.time);break;case WSMessageInType.CurrentPosEvent:A&&n(4,A=!1),n(9,K=o.time);break;case WSMessageInType.PauseEvent:n(4,A=!0);break;case WSMessageInType.ResumeEvent:n(4,A=!1);break;case WSMessageInType.PlayTrackEvent:oe(c).then((()=>{console.log("Started play of:",c)}));break;case WSMessageInType.VolumeChangeEvent:n(7,q=o.value)}}));const g=["MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED"],b=e=>e>0&&e<=g.length?g[e-1]:`UNKNOWN_${e}`;const w=createEventDispatcher(),v=getContext("cache");let y,k,$,x,S,C,A,P=!1,E=0;function T(e,t=!1){t&&n(39,E=0);try{L&&n(5,L.currentTime=e-E,L),n(9,K=e)}catch(t){console.error(`Cannot set currentTime, val=${e}, offset=${E}: ${t}`)}}const R=()=>{n(4,A=!0)};let L,I=!1,M=!1,H=[],z=Number(localStorage.getItem(StorageKeys.PLAYBACK_SPEED)||1);function O(){!function(){if(u.autorewind&&K>0){const e=Number(localStorage.getItem(StorageKeys.LAST_POSITION))||0,t=Number(localStorage.getItem(StorageKeys.LAST_PAUSE))||Date.now(),n=Math.abs(K-e),r=calculateAutorewind(t);if(r>0&&n<=1){let e=K-r;e<E&&(e=E),(J||!W||W&&ee(e))&&(console.debug("Autorewind to "+e),T(e,!1))}}}()}function B(){localStorage.setItem(StorageKeys.LAST_PAUSE,Date.now().toString())}let F,N,j,q=Number(localStorage.getItem(StorageKeys.PLAYBACK_VOLUME)||100),D=Number(q/100),U="",G="",V=0,W=!1,J=!1,K=0,X=!1;const Q=()=>{X&&(window.removeEventListener("mouseup",Q),window.removeEventListener("touchend",Q),window.requestAnimationFrame((()=>{if(te(K),m!==h){let e=formatWSMessage(WSMessageOutType.RewindTo,{time:K});f.send(JSON.stringify(e))}setTimeout((()=>{n(42,X=!1)}),200)})))},Z=new Throttler((e=>{localStorage.setItem(StorageKeys.LAST_POSITION,C.toString()),re(),fe()}),800);async function Y(e,t=!1){console.log(`Seeking time on url ${c.url} to time ${e}`);const r=c.url+`&seek=${e}`;let o=!A;n(39,E=e),L&&(n(5,L.src=r,L),n(5,L.currentTime=0,L)),(o||t)&&await ue()}const ee=e=>{let t=e-C;if(L)for(let n=0;n<L.buffered.length;n++){const r=E+L.buffered.start(n),o=E+L.buffered.end(n);if(console.debug(`Checking buffer star ${r} end ${o} for time ${e}`),r<=e&&e<=o)return!0;if(e<r&&t<0){const n=e-r;n>t&&(t=n)}else if(e>o&&t>0){const n=e-o;n<t&&(t=n)}}return!(isNaN(t)||t<0||t>u.transcodingJumpLimit)};function te(e){!W||J||A||ee(e)?T(e):Y(e)}function ne(e){return t=>{let n=K+e;n<0?n=0:A&&n>x&&(n=x),te(n)}}function re(e){if(A&&!e||isNaN(C))return;const t=`/${N}/${F}`;if(_.enqueuePosition(t,C),m===h){let e=formatWSMessage(WSMessageOutType.CurrentPos,{collection:d,path:c.path,track_position:c.position,time:C});f.send(JSON.stringify(e))}}async function oe(e){if(e){let t;if(e.cached){const r=await(null==v?void 0:v.getCachedUrl(e.url));r?(t=r.cachedUrl,console.debug("Playing cached item",t),n(18,J=!0)):(console.warn("Item was removed from cache"),n(18,J=!1),t=e.url)}else t=e.url,n(18,J=!1);L&&n(5,L.src=t,L),localStorage.setItem(StorageKeys.LAST_FILE,e.path),n(39,E=0),null!=e.time&&isFinite(e.time)&&T(e.time),n(2,x=e.duration),n(1,$=0),n(15,U=splitExtInName(e).baseName),F=e.path,n(17,V=e.position),n(8,W=e.transcoded),n(41,j=e.mime),n(16,G=p.folder),N=p.collection,n(38,y=p.files.slice(0,e.position).reduce(((e,t)=>e+t.meta.duration),0)),n(0,k=p.totalTime),e.startPlay?(await de(!0),re()):(n(4,A=!0),M=!1),function(e){if(document.title=`${U} (${e.path})`,"mediaSession"in navigator){const{root:t,path:n}=splitRootPath(splitPath(e.path).folder);navigator.mediaSession.setPositionState(null),navigator.mediaSession.metadata=new MediaMetadata({title:U,album:n,artist:t,artwork:[{src:"favicon.png"}]}),navigator.mediaSession.setActionHandler("seekbackward",ne(-u.jumpBackTime)),navigator.mediaSession.setActionHandler("seekforward",ne(u.jumpForwardTime)),navigator.mediaSession.setActionHandler("previoustrack",me),navigator.mediaSession.setActionHandler("nexttrack",_e)}}(e)}}let ae;const ie=playItem.subscribe(oe),se=playList.subscribe((e=>{e.folder==G&&e.collection==N||window.clearTimeout(ae)}));function le(e,t=!1){if(!v)return;const n=u.cacheAheadFiles,r=[];for(let t=e+1;t<=e+n;t++)if(t<p.files.length){const e=p.files[t];if(!e.cached){const n=new PlayItem({file:e,collection:N,position:t});r.push({url:n.url,folderPosition:n.position,lowPriority:!1})}}t&&!r.length||v.ensureStarted(),v&&r.length&&v.cacheAhead(r,{url:c.url,folderPosition:c.position})}function ce(e){if(!J&&e.kind===EventType.FileCached){const{collection:t,path:r}=splitUrl(e.item.originalUrl,getLocationPath());t===N&&r===F&&function(e,t=!1){console.debug(`Current file ${c.url} gets cached on url ${e.cachedUrl}`);const r=C;L.src,n(5,L.src=e.cachedUrl,L),n(18,J=!0),t?T(r,!0):(n(42,X=!0),ue(),L.addEventListener("canplay",(e=>{n(42,X=!1),T(r,!0)}),{once:!0}))}(e.item,A)}}async function ue(){if(m==h){try{n(12,I=!0),await L.play()}catch(e){console.error("Playback start failed because of error",e)}n(12,I=!1)}else console.debug("This device is not active")}async function de(e=!1){M=!0,W&&!J&&(K>u.transcodingJumpLimit||e&&K>5)?ee(K)?await ue():(console.debug(`Should seek to position ${K}`),await Y(K,!0)):await ue(),function(e,t=!1){window.clearTimeout(ae);const n=Math.min(1e3*u.cacheAheadDelay,1e3*c.duration/2);ae=window.setTimeout(le,n,e,t)}(V,J)}async function pe(){if(re(!0),A){let e=formatWSMessage(WSMessageOutType.Resume,{});f.send(JSON.stringify(e)),L&&await de(),n(4,A=!1)}else{let e=formatWSMessage(WSMessageOutType.Pause,{});f.send(JSON.stringify(e)),n(4,A=!0),L&&(M=!1,L.pause(),n(12,I=!1))}}function he(e,t=!0){if(e>=0&&e<p.files.length){const n=p.files[e],r=new PlayItem({file:n,position:e,startPlay:t,collection:p.collection,time:0});set_store_value(playItem,c=r,c);let o=formatWSMessage(WSMessageOutType.PlayTrack,{collection:d,path:c.path,track_position:c.position});f.send(JSON.stringify(o))}}function me(){he(c.position-1,!A)}function _e(){he(c.position+1,!A)}function fe(){const e=[];for(let t=0;t<L.buffered.length;t++)e.push({start:E+L.buffered.start(t),end:E+L.buffered.end(t)});(()=>{if(H.length!=e.length)return!0;for(let t=0;t<e.length;t++)if(e[t].start!==H[t].start||e[t].end!=H[t].end)return!0;return!1})()&&n(13,H=e)}null==v||v.addListener(ce);let ge=!1;function be(e){"Shift"===e.key&&(ge=!1)}function we(e){if("Shift"===e.key)return void(ge=!0);const t=ge?5:1;if("MediaPause"!==e.key&&"MediaStop"!==e.key)if("MediaPlay"!==e.key)if("MediaPlayPause"==e.key&&pe(),"MediaTrackNext"!==e.key){if("MediaTrackPrevious"!=e.key)return(!["INPUT","SELECT","TEXTAREA"].includes(e.target.tagName)||e.target instanceof HTMLInputElement&&e.target.classList.contains("allow-global-keys"))&&["ArrowLeft","ArrowRight"," "].includes(e.key)?(e.preventDefault(),e.stopPropagation(),"ArrowRight"===e.key?ne(u.jumpForwardTime*t)(null):"ArrowLeft"==e.key?ne(-u.jumpBackTime*t)(null):" "==e.key&&pe(),!1):void 0;me()}else _e();else A&&pe();else R()}window.addEventListener("keydown",we),window.addEventListener("keyup",be),onMount((async()=>{c&&await oe(c)})),onDestroy((()=>{ie(),se(),window.removeEventListener("mouseup",Q),window.removeEventListener("touchend",Q),window.removeEventListener("keydown",we),window.removeEventListener("keyup",be),null==v||v.removeListener(ce),null==L||L.removeEventListener("progress",fe),null==L||L.removeEventListener("play",O),null==L||L.removeEventListener("pause",B)}));return e.$$.update=()=>{if(1&e.$$.dirty[0]&&n(23,r=formatTime(k)),262&e.$$.dirty[0]|1024&e.$$.dirty[1]&&isFinite($)&&(!j.startsWith("audio/m4b")||W)&&$>x&&n(2,x=$),4&e.$$.dirty[0]&&n(22,o=formatTime(x)),8&e.$$.dirty[0]|256&e.$$.dirty[1]&&n(40,C=E+S),640&e.$$.dirty[1]&&n(10,a=(isFinite(y)?y:0)+(isFinite(C)?C:0)),1024&e.$$.dirty[0]&&n(21,i=formatTime(a)),16&e.$$.dirty[0]){const e=null==A?"none":A?"paused":"playing";navigator.mediaSession&&(navigator.mediaSession.playbackState=e)}var t;96&e.$$.dirty[0]&&L&&(z&&(n(5,L.defaultPlaybackRate=z,L),localStorage.setItem(StorageKeys.PLAYBACK_SPEED,z.toString())),L.addEventListener("play",O),L.addEventListener("pause",B),L.addEventListener("progress",fe)),128&e.$$.dirty[0]&&localStorage.setItem(StorageKeys.PLAYBACK_VOLUME,q.toString()),128&e.$$.dirty[0]&&n(14,D=(q||100)/100),2560&e.$$.dirty[1]&&null!=C&&isFinite(C)&&(X||n(9,K=C),isFinite(C)&&isFinite($)&&C<=$&&L&&(null===(t=navigator.mediaSession)||void 0===t||t.setPositionState({duration:$,playbackRate:L.playbackRate,position:C})),Z.throttle(C)),512&e.$$.dirty[0]&&n(20,s=formatTime(K)),4096&e.$$.dirty[1]&&n(19,l=(null==p?void 0:p.files.length)||0)},[k,$,x,S,A,L,z,q,W,K,a,P,I,H,D,U,G,V,J,l,s,i,o,r,u,h,m,function(){n(42,X=!1);const e=L.error;console.error("Player error",e);const t=e.message?`${b(e.code)} : ${e.message}`:b(e.code);alert(`Player Error: ${t}, will reload window`),window.location.reload()},function(){let e=formatWSMessage(WSMessageOutType.VolumeChange,{value:q});f.send(JSON.stringify(e))},()=>{n(42,X=!0),window.addEventListener("mouseup",Q),window.addEventListener("touchend",Q)},ne,pe,function(){if(C<x-60?console.warn(`Playback ended at ${C} before expected duration ${x}, maybe problem with cached version`):console.debug(`File ${c.name} on ${c.path} finished`),M){he(c.position+1);const e=M;M=!1,window.setTimeout((()=>M=e),100)}},function(){w("navigate",NavigateTarget.PLAYLIST_FOLDER)},function(){w("navigate",NavigateTarget.PLAY_ITEM)},me,_e,R,y,E,C,j,X,p,()=>n(11,P=!P),function(){q=to_number(this.value),n(7,q)},function(){z=to_number(this.value),n(6,z)},function(){$=this.duration,n(1,$)},function(){S=this.currentTime,n(3,S)},function(){A=this.paused,n(4,A)},function(){D=this.volume,n(14,D),n(7,q)},function(){z=this.playbackRate,n(6,z)},function(e){binding_callbacks[e?"unshift":"push"]((()=>{L=e,n(5,L),n(6,z)}))},function(){K=to_number(this.value),n(9,K),n(40,C),n(42,X),n(39,E),n(3,S)}]}class Player extends SvelteComponent{constructor(e){super(),init(this,e,instance$6,create_fragment$6,safe_not_equal,{pause:37},null,[-1,-1,-1])}get pause(){return this.$$.ctx[37]}}const get_body_slot_changes=e=>({}),get_body_slot_context=e=>({}),get_header_slot_changes=e=>({}),get_header_slot_context=e=>({});function create_if_block$2(e){let t,n,r;return{c(){t=element("a"),t.textContent="Confirm",attr(t,"href","#confirm"),attr(t,"role","button")},m(o,a){insert(o,t,a),n||(r=listen(t,"click",e[3]),n=!0)},p:noop,d(e){e&&detach(t),n=!1,r()}}}function create_fragment$5(e){let t,n,r,o,a,i,s,l,c,u,d,p,h,m;const _=e[6].header,f=create_slot(_,e,e[5],get_header_slot_context),g=e[6].body,b=create_slot(g,e,e[5],get_body_slot_context);let w=!e[1]&&create_if_block$2(e);return{c(){t=element("dialog"),n=element("article"),r=element("a"),o=space(),a=element("h3"),f&&f.c(),i=space(),s=element("p"),b&&b.c(),l=space(),c=element("footer"),u=element("a"),u.textContent="Cancel",d=space(),w&&w.c(),attr(r,"href","#close"),attr(r,"aria-label","Close"),attr(r,"class","close"),attr(u,"href","#cancel"),attr(u,"role","button"),attr(u,"class","secondary"),attr(t,"id",e[0])},m(_,g){insert(_,t,g),append(t,n),append(n,r),append(n,o),append(n,a),f&&f.m(a,null),append(n,i),append(n,s),b&&b.m(s,null),append(n,l),append(n,c),append(c,u),append(c,d),w&&w.m(c,null),p=!0,h||(m=[listen(r,"click",e[2]),listen(u,"click",e[2])],h=!0)},p(e,[n]){f&&f.p&&(!p||32&n)&&update_slot_base(f,_,e,e[5],p?get_slot_changes(_,e[5],n,get_header_slot_changes):get_all_dirty_from_scope(e[5]),get_header_slot_context),b&&b.p&&(!p||32&n)&&update_slot_base(b,g,e,e[5],p?get_slot_changes(g,e[5],n,get_body_slot_changes):get_all_dirty_from_scope(e[5]),get_body_slot_context),e[1]?w&&(w.d(1),w=null):w?w.p(e,n):(w=create_if_block$2(e),w.c(),w.m(c,null)),(!p||1&n)&&attr(t,"id",e[0])},i(e){p||(transition_in(f,e),transition_in(b,e),p=!0)},o(e){transition_out(f,e),transition_out(b,e),p=!1},d(e){e&&detach(t),f&&f.d(e),b&&b.d(e),w&&w.d(),h=!1,run_all(m)}}}const isScrollbarVisible=()=>document.body.scrollHeight>screen.height,getScrollbarWidth=()=>{const e=document.createElement("div");e.style.visibility="hidden",e.style.overflow="scroll",e.style.msOverflowStyle="scrollbar",document.body.appendChild(e);const t=document.createElement("div");e.appendChild(t);const n=e.offsetWidth-t.offsetWidth;return e.parentNode.removeChild(e),n},isOpenClass="modal-is-open",openingClass="modal-is-opening",closingClass="modal-is-closing",animationDuration=400;function instance$5(e,t,n){let{$$slots:r={},$$scope:o}=t,a=null,{id:i}=t,{confirmAction:s=null}=t,{noConfirm:l=!1}=t;const c=e=>{null==e||e.preventDefault();const t=document.getElementById(i);void 0!==t&&null!=t&&u(t)?p(t):d(t)},u=e=>!(!e.hasAttribute("open")||"false"==e.getAttribute("open")),d=e=>{isScrollbarVisible()&&document.documentElement.style.setProperty("--scrollbar-width",`${getScrollbarWidth()}px`),document.documentElement.classList.add(isOpenClass,openingClass),setTimeout((()=>{a=e,document.documentElement.classList.remove(openingClass)}),animationDuration),e.setAttribute("open",!0)},p=e=>{a=null,document.documentElement.classList.add(closingClass),setTimeout((()=>{document.documentElement.classList.remove(closingClass,isOpenClass),document.documentElement.style.removeProperty("--scrollbar-width"),e.removeAttribute("open")}),animationDuration)},h=e=>{if(null!=a){!a.querySelector("article").contains(e.target)&&p(a)}};document.addEventListener("click",h);const m=e=>{"Escape"===e.key&&null!=a&&p(a)};return document.addEventListener("keydown",m),onDestroy((()=>{document.removeEventListener("click",h),document.removeEventListener("click",m)})),e.$$set=e=>{"id"in e&&n(0,i=e.id),"confirmAction"in e&&n(4,s=e.confirmAction),"noConfirm"in e&&n(1,l=e.noConfirm),"$$scope"in e&&n(5,o=e.$$scope)},[i,l,c,e=>{c(e),s&&s()},s,o,r]}class ConfirmDialog extends SvelteComponent{constructor(e){super(),init(this,e,instance$5,create_fragment$5,safe_not_equal,{id:0,confirmAction:4,noConfirm:1,toggleModal:2})}get toggleModal(){return this.$$.ctx[2]}}async function loadAudioFile(e,t){const n=await fetch(e),r=await n.arrayBuffer();return await t.decodeAudioData(r)}function playBuffer(e,t){const n=t.createBufferSource();n.buffer=e,n.connect(t.destination),n.start()}function createAudioContext(){const e=new(0,window.AudioContext);return"suspended"===e.state&&e.resume(),e}var ShakeType;!function(e){e[e.Orientation=0]="Orientation",e[e.Motion=1]="Motion"}(ShakeType||(ShakeType={}));class Orientation{constructor(e,t,n){this.alpha=e,this.beta=t,this.gamma=n}get maxAbs(){return Math.max(Math.abs(this.alpha),Math.abs(this.beta),Math.abs(this.gamma))}sub(e,t,n){const r=Math.abs(e-t);return r>n?2*n-r:r}delta(e){return new Orientation(this.sub(this.alpha,e.alpha,180),this.sub(this.beta,e.beta,180),this.sub(this.gamma,e.gamma,90))}toString(){return`a: ${this.alpha.toFixed(2)}; b:${this.beta.toFixed(2)}; g: ${this.gamma.toFixed(2)}`}}class ShakeDetector{constructor(e,t=20,n=45){this.accelerationLimit=t,this.orientationChange=n,this.startOrientation=null,this.onOrientationChange=e=>{if(null==this.startOrientation)this.startOrientation=new Orientation(e.alpha,e.beta,e.gamma);else{const t=new Orientation(e.alpha,e.beta,e.gamma);this.startOrientation.delta(t).maxAbs>=45&&(this.cb(ShakeType.Orientation),this.finish())}},this.onMotion=e=>{if(!e.acceleration||null==e.acceleration.x||null==e.acceleration.y||null==!e.acceleration.z)return console.debug("Motion event does not have valid data, stop using it",e),void window.removeEventListener("devicemotion",this.onMotion);Math.sqrt(e.acceleration.x*e.acceleration.x+e.acceleration.y*e.acceleration.y+e.acceleration.z*e.acceleration.z)>this.accelerationLimit&&(this.cb(ShakeType.Motion),this.finish())},this.cb=e,window.addEventListener("deviceorientation",this.onOrientationChange),window.addEventListener("devicemotion",this.onMotion)}finish(){window.removeEventListener("deviceorientation",this.onOrientationChange),window.removeEventListener("devicemotion",this.onMotion)}}function create_fragment$4(e){let t,n,r,o,a,i,s;const l=e[2].default,c=create_slot(l,e,e[1],null);return{c(){t=element("h2"),n=element("span"),c&&c.c(),r=space(),o=element("a"),attr(o,"href","#close"),attr(o,"class","close svelte-143mvpc"),attr(o,"aria-label","Close"),attr(t,"class","svelte-143mvpc")},m(l,u){insert(l,t,u),append(t,n),c&&c.m(n,null),append(t,r),append(t,o),a=!0,i||(s=listen(o,"click",prevent_default(e[0])),i=!0)},p(e,[t]){c&&c.p&&(!a||2&t)&&update_slot_base(c,l,e,e[1],a?get_slot_changes(l,e[1],t,null):get_all_dirty_from_scope(e[1]),null)},i(e){a||(transition_in(c,e),a=!0)},o(e){transition_out(c,e),a=!1},d(e){e&&detach(t),c&&c.d(e),i=!1,s()}}}function instance$4(e,t,n){let{$$slots:r={},$$scope:o}=t;const a=createEventDispatcher();return e.$$set=e=>{"$$scope"in e&&n(1,o=e.$$scope)},[()=>a("close"),o,r]}class ClosableTitle extends SvelteComponent{constructor(e){super(),init(this,e,instance$4,create_fragment$4,safe_not_equal,{})}}function create_default_slot$1(e){let t;return{c(){t=text("Audioserve Preferences")},m(e,n){insert(e,t,n)},d(e){e&&detach(t)}}}function create_if_block$1(e){let t,n,r,o,a,i,s,l,c,u,d,p,h;return{c(){t=element("label"),t.textContent="Files to Cache Ahead",n=space(),r=element("input"),o=space(),a=element("p"),a.textContent="When you start to play file next n files will be loaded to cache on\n        background",i=space(),s=element("label"),s.textContent="Delay before start caching next files (secs)",l=space(),c=element("input"),u=space(),d=element("p"),d.textContent="Wait n seconds after playback start before starting to cache next files\n        (for small files it's half of their duration).",attr(t,"for","cache-ahead"),attr(t,"class","svelte-1v7yi8u"),attr(r,"id","cache-ahead"),attr(r,"aria-describedby","cache-ahead-desc"),attr(r,"type","number"),attr(a,"id","cache-ahead-desc"),attr(a,"class","svelte-1v7yi8u"),attr(s,"for","cache-ahead-delay"),attr(s,"class","svelte-1v7yi8u"),attr(c,"id","cache-ahead-delay"),attr(c,"aria-describedby","cache-ahead-delay-desc"),attr(c,"type","number"),attr(d,"id","cache-ahead-delay-desc"),attr(d,"class","svelte-1v7yi8u")},m(m,_){insert(m,t,_),insert(m,n,_),insert(m,r,_),set_input_value(r,e[0].cacheAheadFiles),insert(m,o,_),insert(m,a,_),insert(m,i,_),insert(m,s,_),insert(m,l,_),insert(m,c,_),set_input_value(c,e[0].cacheAheadDelay),insert(m,u,_),insert(m,d,_),p||(h=[listen(r,"input",e[4]),listen(c,"input",e[5])],p=!0)},p(e,t){1&t&&to_number(r.value)!==e[0].cacheAheadFiles&&set_input_value(r,e[0].cacheAheadFiles),1&t&&to_number(c.value)!==e[0].cacheAheadDelay&&set_input_value(c,e[0].cacheAheadDelay)},d(e){e&&detach(t),e&&detach(n),e&&detach(r),e&&detach(o),e&&detach(a),e&&detach(i),e&&detach(s),e&&detach(l),e&&detach(c),e&&detach(u),e&&detach(d),p=!1,run_all(h)}}}function create_fragment$3(e){let t,n,r,o,a,i,s,l,c,u,d,p,h,m,_,f,g,b,w,v,y,k,$,x,S,C,A,P,E,T,R,L,I,M,H,z,O,B,F,N,j,q,D,U,G,V,W,J,K,X,Q,Z,Y,ee,te,ne,re,oe,ae,ie,se,le,ce,ue,de,pe,he,me,_e,fe,ge,be;n=new ClosableTitle({props:{$$slots:{default:[create_default_slot$1]},$$scope:{ctx:e}}}),n.$on("close",e[3]);let we=e[1]&&create_if_block$1(e);return{c(){t=element("div"),create_component(n.$$.fragment),r=space(),o=element("form"),we&&we.c(),a=space(),i=element("label"),i.textContent="Short Jump Forward (secs)",s=space(),l=element("input"),c=space(),u=element("p"),u.textContent="Time for short foward jump (arc arrow icon right from play/pause button)",d=space(),p=element("label"),p.textContent="Short Jump Backward (secs)",h=space(),m=element("input"),_=space(),f=element("p"),f.textContent="Time for short backward jump (arc arrow icon left from play/pause button)",g=space(),b=element("label"),w=element("input"),v=text("\n      Automatically rewind on playback start"),y=space(),k=element("p"),k.textContent="When you click on Play button current position will be be moved back\n      slightly to better catch up with previous text",$=space(),x=element("label"),x.textContent="Sleep Timer (minutes)",S=space(),C=element("input"),A=space(),P=element("p"),P.textContent="When you click sleep timer icon, n minutes is waited and then playback is\n      paused",E=space(),T=element("label"),T.textContent="Sleep Timer Extension (minutes)",R=space(),L=element("input"),I=space(),M=element("p"),M.textContent="One minute before Sleep Timer finishes (notified by sound) you can extend\n      it by n minutes by shaking device",H=space(),z=element("label"),z.textContent="Maximum history for recently listened (days)",O=space(),B=element("input"),F=space(),N=element("p"),N.textContent="When showing recently listened files from menu only records newer then\n      given number of days are fetched from server. Put zero to fetch all\n      available records.",j=space(),q=element("label"),q.textContent="Playback Position Reporting Period (secs)",D=space(),U=element("input"),G=space(),V=element("p"),V.textContent="When file is being played, playback position is reported every n seconds\n      to server",W=space(),J=element("label"),J.textContent="Transcoding Tolerance Coeficient",K=space(),X=element("input"),Q=space(),Z=element("p"),Z.textContent="If file bitrate is only by x bigger then transcoding limit, transcoding is\n      not used",Y=space(),ee=element("label"),ee.textContent="Transcoding Seek Limit (secs)",te=space(),ne=element("input"),re=space(),oe=element("p"),oe.textContent="If you seek ahead on transcoded file in player (indicated by squaze icon)\n      and jump is bigger theh this limit, then if not already buffred seek will\n      be done on server (which is fast), rather then waiting for intermediate\n      data to load",ae=space(),ie=element("label"),ie.textContent="Mime types to always transcode",se=space(),le=element("input"),ce=space(),ue=element("p"),ue.textContent="List audio Mime types (space separated), that you want always to transcode\n      - e.g. they are not supported by browser on this platform. Typical example\n      would be audio/ogg on iPhone/iPad",de=space(),pe=element("div"),he=element("button"),he.textContent="Cancel",me=space(),_e=element("button"),_e.textContent="Apply",attr(i,"for","jump-fwd"),attr(i,"class","svelte-1v7yi8u"),attr(l,"id","jump-fwd"),attr(l,"aria-describedby","jump-fwd-desc"),attr(l,"type","number"),attr(u,"id","jump-fwd-desc"),attr(u,"class","svelte-1v7yi8u"),attr(p,"for","jump-back"),attr(p,"class","svelte-1v7yi8u"),attr(m,"id","jump-back"),attr(m,"aria-describedby","jump-back-desc"),attr(m,"type","number"),attr(f,"id","jump-back-desc"),attr(f,"class","svelte-1v7yi8u"),attr(w,"id","autorewind"),attr(w,"aria-describedby","autorewind-desc"),attr(w,"type","checkbox"),attr(b,"for","autorewind"),attr(b,"class","svelte-1v7yi8u"),attr(k,"class","no-input svelte-1v7yi8u"),attr(k,"id","autorewind-desc"),attr(x,"for","sleep-time"),attr(x,"class","svelte-1v7yi8u"),attr(C,"id","sleep-time"),attr(C,"aria-describedby","sleep-time-desc"),attr(C,"type","number"),attr(P,"id","sleep-time-desc"),attr(P,"class","svelte-1v7yi8u"),attr(T,"for","sleep-time-extend"),attr(T,"class","svelte-1v7yi8u"),attr(L,"id","sleep-time-extend"),attr(L,"aria-describedby","sleep-time-extend-desc"),attr(L,"type","number"),attr(M,"id","sleep-time-extend-desc"),attr(M,"class","svelte-1v7yi8u"),attr(z,"for","recent-days"),attr(z,"class","svelte-1v7yi8u"),attr(B,"id","recent-days"),attr(B,"aria-describedby","recent-days-desc"),attr(B,"type","number"),attr(N,"id","recent-days-desc"),attr(N,"class","svelte-1v7yi8u"),attr(q,"for","pos-reporting"),attr(q,"class","svelte-1v7yi8u"),attr(U,"id","pos-reporting"),attr(U,"aria-describedby","pos-reporting-desc"),attr(U,"type","number"),attr(V,"id","pos-reporting-desc"),attr(V,"class","svelte-1v7yi8u"),attr(J,"for","trans-tolerance"),attr(J,"class","svelte-1v7yi8u"),attr(X,"id","trans-tolerance"),attr(X,"aria-describedby","trans-tolerance-desc"),attr(X,"type","number"),attr(Z,"id","trans-tolerance-desc"),attr(Z,"class","svelte-1v7yi8u"),attr(ee,"for","trans-jump"),attr(ee,"class","svelte-1v7yi8u"),attr(ne,"id","trans-jump"),attr(ne,"aria-describedby","trans-jump-desc"),attr(ne,"type","number"),attr(oe,"id","trans-jump-desc"),attr(oe,"class","svelte-1v7yi8u"),attr(ie,"for","always-transcode"),attr(ie,"class","svelte-1v7yi8u"),attr(le,"id","always-transcode"),attr(le,"aria-describedby","always-transcode-desc"),attr(le,"type","text"),attr(ue,"id","always-transcode-desc"),attr(ue,"class","svelte-1v7yi8u"),attr(he,"class","secondary"),attr(pe,"class","grid"),attr(t,"id","config-editor"),attr(t,"class","svelte-1v7yi8u")},m(ve,ye){insert(ve,t,ye),mount_component(n,t,null),append(t,r),append(t,o),we&&we.m(o,null),append(o,a),append(o,i),append(o,s),append(o,l),set_input_value(l,e[0].jumpForwardTime),append(o,c),append(o,u),append(o,d),append(o,p),append(o,h),append(o,m),set_input_value(m,e[0].jumpBackTime),append(o,_),append(o,f),append(o,g),append(o,b),append(b,w),w.checked=e[0].autorewind,append(b,v),append(o,y),append(o,k),append(o,$),append(o,x),append(o,S),append(o,C),set_input_value(C,e[0].sleepTimerPeriod),append(o,A),append(o,P),append(o,E),append(o,T),append(o,R),append(o,L),set_input_value(L,e[0].sleepTimerExtend),append(o,I),append(o,M),append(o,H),append(o,z),append(o,O),append(o,B),set_input_value(B,e[0].recentDays),append(o,F),append(o,N),append(o,j),append(o,q),append(o,D),append(o,U),set_input_value(U,e[0].positionReportingPeriod),append(o,G),append(o,V),append(o,W),append(o,J),append(o,K),append(o,X),set_input_value(X,e[0].transcodingTolerance),append(o,Q),append(o,Z),append(o,Y),append(o,ee),append(o,te),append(o,ne),set_input_value(ne,e[0].transcodingJumpLimit),append(o,re),append(o,oe),append(o,ae),append(o,ie),append(o,se),append(o,le),set_input_value(le,e[0].alwaysTranscode),append(o,ce),append(o,ue),append(o,de),append(o,pe),append(pe,he),append(pe,me),append(pe,_e),fe=!0,ge||(be=[listen(l,"input",e[6]),listen(m,"input",e[7]),listen(w,"change",e[8]),listen(C,"input",e[9]),listen(L,"input",e[10]),listen(B,"input",e[11]),listen(U,"input",e[12]),listen(X,"input",e[13]),listen(ne,"input",e[14]),listen(le,"input",e[15]),listen(he,"click",prevent_default(e[3])),listen(_e,"click",prevent_default(e[2]))],ge=!0)},p(e,[t]){const r={};131072&t&&(r.$$scope={dirty:t,ctx:e}),n.$set(r),e[1]&&we.p(e,t),1&t&&to_number(l.value)!==e[0].jumpForwardTime&&set_input_value(l,e[0].jumpForwardTime),1&t&&to_number(m.value)!==e[0].jumpBackTime&&set_input_value(m,e[0].jumpBackTime),1&t&&(w.checked=e[0].autorewind),1&t&&to_number(C.value)!==e[0].sleepTimerPeriod&&set_input_value(C,e[0].sleepTimerPeriod),1&t&&to_number(L.value)!==e[0].sleepTimerExtend&&set_input_value(L,e[0].sleepTimerExtend),1&t&&to_number(B.value)!==e[0].recentDays&&set_input_value(B,e[0].recentDays),1&t&&to_number(U.value)!==e[0].positionReportingPeriod&&set_input_value(U,e[0].positionReportingPeriod),1&t&&to_number(X.value)!==e[0].transcodingTolerance&&set_input_value(X,e[0].transcodingTolerance),1&t&&to_number(ne.value)!==e[0].transcodingJumpLimit&&set_input_value(ne,e[0].transcodingJumpLimit),1&t&&le.value!==e[0].alwaysTranscode&&set_input_value(le,e[0].alwaysTranscode)},i(e){fe||(transition_in(n.$$.fragment,e),fe=!0)},o(e){transition_out(n.$$.fragment,e),fe=!1},d(e){e&&detach(t),destroy_component(n),we&&we.d(),ge=!1,run_all(be)}}}function instance$3(e,t,n){let r=get_store_value(config),o=getContext("cache");const a=createEventDispatcher();return[r,o,()=>{a("finished"),localStorage.setItem(StorageKeys.PREFERENCES,JSON.stringify(r)),config.set(r)},()=>{a("finished")},function(){r.cacheAheadFiles=to_number(this.value),n(0,r)},function(){r.cacheAheadDelay=to_number(this.value),n(0,r)},function(){r.jumpForwardTime=to_number(this.value),n(0,r)},function(){r.jumpBackTime=to_number(this.value),n(0,r)},function(){r.autorewind=this.checked,n(0,r)},function(){r.sleepTimerPeriod=to_number(this.value),n(0,r)},function(){r.sleepTimerExtend=to_number(this.value),n(0,r)},function(){r.recentDays=to_number(this.value),n(0,r)},function(){r.positionReportingPeriod=to_number(this.value),n(0,r)},function(){r.transcodingTolerance=to_number(this.value),n(0,r)},function(){r.transcodingJumpLimit=to_number(this.value),n(0,r)},function(){r.alwaysTranscode=this.value,n(0,r)}]}class ConfigEditor extends SvelteComponent{constructor(e){super(),init(this,e,instance$3,create_fragment$3,safe_not_equal,{})}}function create_fragment$2(e){let t,n,r,o,a,i,s,l,c,u,d,p,h=e[0].folder+"",m=formatTimeAgo(e[0].timestamp)+"",_=formatTime(e[0].position)+"";return{c(){t=element("div"),n=element("h4"),r=text(e[1]),o=space(),a=element("h6"),i=text(h),s=space(),l=element("div"),c=text(m),u=text("\n    (pos. "),d=text(_),p=text(")"),attr(n,"class","title item-header svelte-1q1jmlo"),attr(n,"role","link"),attr(a,"class","subtitle svelte-1q1jmlo"),toggle_class(a,"finished",e[0].folderFinished),attr(l,"class","position-time svelte-1q1jmlo")},m(e,h){insert(e,t,h),append(t,n),append(n,r),append(t,o),append(t,a),append(a,i),append(t,s),append(t,l),append(l,c),append(l,u),append(l,d),append(l,p)},p(e,[t]){2&t&&set_data(r,e[1]),1&t&&h!==(h=e[0].folder+"")&&set_data(i,h),1&t&&toggle_class(a,"finished",e[0].folderFinished),1&t&&m!==(m=formatTimeAgo(e[0].timestamp)+"")&&set_data(c,m),1&t&&_!==(_=formatTime(e[0].position)+"")&&set_data(d,_)},i:noop,o:noop,d(e){e&&detach(t)}}}function instance$2(e,t,n){let r,{position:o}=t;return beforeUpdate((()=>{n(1,r=fileToHumanName(o.file))})),e.$$set=e=>{"position"in e&&n(0,o=e.position)},[o,r]}class PositionItem extends SvelteComponent{constructor(e){super(),init(this,e,instance$2,create_fragment$2,safe_not_equal,{position:0})}}function get_each_context(e,t,n){const r=e.slice();return r[9]=t[n],r}function create_default_slot(e){let t;return{c(){t=text("Recently Listened")},m(e,n){insert(e,t,n)},d(e){e&&detach(t)}}}function create_each_block(e){let t,n,r,o,a;return n=new PositionItem({props:{position:e[9]}}),{c(){t=element("li"),create_component(n.$$.fragment)},m(i,s){insert(i,t,s),mount_component(n,t,null),r=!0,o||(a=listen(t,"click",(function(){is_function(e[2](e[9]))&&e[2](e[9]).apply(this,arguments)})),o=!0)},p(t,r){e=t;const o={};1&r&&(o.position=e[9]),n.$set(o)},i(e){r||(transition_in(n.$$.fragment,e),r=!0)},o(e){transition_out(n.$$.fragment,e),r=!1},d(e){e&&detach(t),destroy_component(n),o=!1,a()}}}function create_fragment$1(e){let t,n,r,o,a,i,s,l;n=new ClosableTitle({props:{$$slots:{default:[create_default_slot]},$$scope:{ctx:e}}}),n.$on("close",e[1]);let c=e[0],u=[];for(let t=0;t<c.length;t+=1)u[t]=create_each_block(get_each_context(e,c,t));const d=e=>transition_out(u[e],1,1,(()=>{u[e]=null}));return{c(){t=element("div"),create_component(n.$$.fragment),r=space(),o=element("details"),a=element("summary"),a.textContent="Files",i=space(),s=element("ul");for(let e=0;e<u.length;e+=1)u[e].c();attr(a,"class","svelte-1gqpxls"),attr(s,"class","items-list"),o.open=!0},m(e,c){insert(e,t,c),mount_component(n,t,null),append(t,r),append(t,o),append(o,a),append(o,i),append(o,s);for(let e=0;e<u.length;e+=1)u[e].m(s,null);l=!0},p(e,[t]){const r={};if(4096&t&&(r.$$scope={dirty:t,ctx:e}),n.$set(r),5&t){let n;for(c=e[0],n=0;n<c.length;n+=1){const r=get_each_context(e,c,n);u[n]?(u[n].p(r,t),transition_in(u[n],1)):(u[n]=create_each_block(r),u[n].c(),transition_in(u[n],1),u[n].m(s,null))}for(group_outros(),n=c.length;n<u.length;n+=1)d(n);check_outros()}},i(e){if(!l){transition_in(n.$$.fragment,e);for(let e=0;e<c.length;e+=1)transition_in(u[e]);l=!0}},o(e){transition_out(n.$$.fragment,e),u=u.filter(Boolean);for(let e=0;e<u.length;e+=1)transition_out(u[e]);l=!1},d(e){e&&detach(t),destroy_component(n),destroy_each(u,e)}}}function instance$1(e,t,n){let r,o,a,i,s;component_subscribe(e,currentFolder,(e=>n(3,r=e))),component_subscribe(e,selectedCollection,(e=>n(4,o=e))),component_subscribe(e,group,(e=>n(5,a=e))),component_subscribe(e,positionsApi,(e=>n(6,i=e))),component_subscribe(e,config,(e=>n(7,s=e)));const l=createEventDispatcher();let c=[];onMount((()=>{let e;s.recentDays&&(e=Date.now()-s.recentDays*DAY_IN_MILIS),i.positionsGroupGet({group:a,to:e}).then((e=>n(0,c=e))).catch((e=>console.error("Cannot fetch recent positions",e)))}));return[c,()=>l("close"),e=>()=>{set_store_value(selectedCollection,o=e.collection,o),set_store_value(currentFolder,r={value:e.folder,type:FolderType.REGULAR},r),localStorage.setItem(StorageKeys.LAST_FOLDER,e.folder),localStorage.setItem(StorageKeys.LAST_FILE,e.file),localStorage.setItem(StorageKeys.LAST_POSITION,e.position.toString())}]}class Recent extends SvelteComponent{constructor(e){super(),init(this,e,instance$1,create_fragment$1,safe_not_equal,{})}}function create_else_block(e){let t,n,r,o,a,i,s,l,c,u,d,p,h,m,_,f,g,b,w,v,y=e[8]&&create_if_block_14(e),k=e[7]&&create_if_block_12(e),$=e[6]&&create_if_block_10(e),x=!e[7]&&!e[6]&&e[9]&&create_if_block_9(e),S=(!e[7]&&!e[6]||!e[9])&&create_if_block_6(e);p=new DevicesOnline({}),m=new Menu_1({}),m.$on("menu",e[19]);const C=[create_if_block_4,create_if_block_5,create_else_block_1],A=[];function P(e,t){return"config"==e[14]?0:"recent"==e[14]?1:2}f=P(e),g=A[f]=C[f](e);let E=e[18]&&create_if_block_3(e);return{c(){t=element("div"),n=element("nav"),y&&y.c(),r=space(),o=element("ul"),a=element("li"),i=element("div"),k&&k.c(),s=space(),$&&$.c(),l=space(),c=element("li"),x&&x.c(),u=space(),S&&S.c(),d=space(),create_component(p.$$.fragment),h=space(),create_component(m.$$.fragment),_=space(),g.c(),b=space(),E&&E.c(),w=empty(),attr(i,"class","search-bar svelte-1xtgt2h"),attr(a,"class","search-bar-box svelte-1xtgt2h"),attr(c,"class","icons svelte-1xtgt2h"),attr(o,"class","right-bar svelte-1xtgt2h"),attr(n,"class","nav-bar"),attr(t,"class","head svelte-1xtgt2h")},m(e,g){insert(e,t,g),append(t,n),y&&y.m(n,null),append(n,r),append(n,o),append(o,a),append(a,i),k&&k.m(i,null),append(i,s),$&&$.m(i,null),append(o,l),append(o,c),x&&x.m(c,null),append(c,u),S&&S.m(c,null),append(c,d),mount_component(p,c,null),append(c,h),mount_component(m,c,null),insert(e,_,g),A[f].m(e,g),insert(e,b,g),E&&E.m(e,g),insert(e,w,g),v=!0},p(e,t){e[8]?y?y.p(e,t):(y=create_if_block_14(e),y.c(),y.m(n,r)):y&&(y.d(1),y=null),e[7]?k?(k.p(e,t),128&t[0]&&transition_in(k,1)):(k=create_if_block_12(e),k.c(),transition_in(k,1),k.m(i,s)):k&&(group_outros(),transition_out(k,1,1,(()=>{k=null})),check_outros()),e[6]?$?($.p(e,t),64&t[0]&&transition_in($,1)):($=create_if_block_10(e),$.c(),transition_in($,1),$.m(i,null)):$&&(group_outros(),transition_out($,1,1,(()=>{$=null})),check_outros()),e[7]||e[6]||!e[9]?x&&(group_outros(),transition_out(x,1,1,(()=>{x=null})),check_outros()):x?(x.p(e,t),704&t[0]&&transition_in(x,1)):(x=create_if_block_9(e),x.c(),transition_in(x,1),x.m(c,u)),(e[7]||e[6])&&e[9]?S&&(group_outros(),transition_out(S,1,1,(()=>{S=null})),check_outros()):S?(S.p(e,t),704&t[0]&&transition_in(S,1)):(S=create_if_block_6(e),S.c(),transition_in(S,1),S.m(c,d));let o=f;f=P(e),f===o?A[f].p(e,t):(group_outros(),transition_out(A[o],1,1,(()=>{A[o]=null})),check_outros(),g=A[f],g?g.p(e,t):(g=A[f]=C[f](e),g.c()),transition_in(g,1),g.m(b.parentNode,b)),e[18]?E?(E.p(e,t),262144&t[0]&&transition_in(E,1)):(E=create_if_block_3(e),E.c(),transition_in(E,1),E.m(w.parentNode,w)):E&&(group_outros(),transition_out(E,1,1,(()=>{E=null})),check_outros())},i(e){v||(transition_in(k),transition_in($),transition_in(x),transition_in(S),transition_in(p.$$.fragment,e),transition_in(m.$$.fragment,e),transition_in(g),transition_in(E),v=!0)},o(e){transition_out(k),transition_out($),transition_out(x),transition_out(S),transition_out(p.$$.fragment,e),transition_out(m.$$.fragment,e),transition_out(g),transition_out(E),v=!1},d(e){e&&detach(t),y&&y.d(),k&&k.d(),$&&$.d(),x&&x.d(),S&&S.d(),destroy_component(p),destroy_component(m),e&&detach(_),A[f].d(e),e&&detach(b),E&&E.d(e),e&&detach(w)}}}function create_if_block_2(e){let t,n;return t=new Login({}),{c(){create_component(t.$$.fragment)},m(e,r){mount_component(t,e,r),n=!0},p:noop,i(e){n||(transition_in(t.$$.fragment,e),n=!0)},o(e){transition_out(t.$$.fragment,e),n=!1},d(e){destroy_component(t,e)}}}function create_if_block_1(e){let t,n,r,o;return{c(){t=element("h2"),t.textContent="Error!",n=space(),r=element("p"),o=text(e[5])},m(e,a){insert(e,t,a),insert(e,n,a),insert(e,r,a),append(r,o)},p(e,t){32&t[0]&&set_data(o,e[5])},i:noop,o:noop,d(e){e&&detach(t),e&&detach(n),e&&detach(r)}}}function create_if_block_14(e){let t,n,r,o;function a(e,t){return e[9]?create_if_block_15:create_else_block_3}let i=a(e),s=i(e);return{c(){t=element("ul"),n=element("li"),r=element("h4"),o=element("a"),s.c(),attr(o,"href","."),attr(r,"class","logo svelte-1xtgt2h")},m(e,a){insert(e,t,a),append(t,n),append(n,r),append(r,o),s.m(o,null)},p(e,t){i!==(i=a(e))&&(s.d(1),s=i(e),s&&(s.c(),s.m(o,null)))},d(e){e&&detach(t),s.d()}}}function create_else_block_3(e){let t;return{c(){t=text("audioserve")},m(e,n){insert(e,t,n)},d(e){e&&detach(t)}}}function create_if_block_15(e){let t;return{c(){t=text("as")},m(e,n){insert(e,t,n)},d(e){e&&detach(t)}}}function create_if_block_12(e){let t,n,r,o;t=new CollectionSelector({props:{selected:e[1]}});let a=e[9]&&create_if_block_13(e);return{c(){create_component(t.$$.fragment),n=space(),a&&a.c(),r=empty()},m(e,i){mount_component(t,e,i),insert(e,n,i),a&&a.m(e,i),insert(e,r,i),o=!0},p(e,n){const o={};2&n[0]&&(o.selected=e[1]),t.$set(o),e[9]?a?(a.p(e,n),512&n[0]&&transition_in(a,1)):(a=create_if_block_13(e),a.c(),transition_in(a,1),a.m(r.parentNode,r)):a&&(group_outros(),transition_out(a,1,1,(()=>{a=null})),check_outros())},i(e){o||(transition_in(t.$$.fragment,e),transition_in(a),o=!0)},o(e){transition_out(t.$$.fragment,e),transition_out(a),o=!1},d(e){destroy_component(t,e),e&&detach(n),a&&a.d(e),e&&detach(r)}}}function create_if_block_13(e){let t,n,r,o,a;return n=new Close({props:{size:"1.6rem"}}),{c(){t=element("span"),create_component(n.$$.fragment),attr(t,"role","button"),attr(t,"class","button-like"),attr(t,"aria-label","Close collection list")},m(i,s){insert(i,t,s),mount_component(n,t,null),r=!0,o||(a=listen(t,"click",e[23]),o=!0)},p:noop,i(e){r||(transition_in(n.$$.fragment,e),r=!0)},o(e){transition_out(n.$$.fragment,e),r=!1},d(e){e&&detach(t),destroy_component(n),o=!1,a()}}}function create_if_block_10(e){let t,n,r,o,a,i,s=e[9]&&create_if_block_11(e);return{c(){t=element("input"),n=space(),s&&s.c(),r=empty(),attr(t,"type","text"),attr(t,"name","search"),attr(t,"placeholder","Search"),attr(t,"class","svelte-1xtgt2h")},m(l,c){insert(l,t,c),set_input_value(t,e[4]),insert(l,n,c),s&&s.m(l,c),insert(l,r,c),o=!0,a||(i=[listen(t,"keyup",e[20]),listen(t,"input",e[30]),action_destroyer(gainFocus.call(null,t))],a=!0)},p(e,n){16&n[0]&&t.value!==e[4]&&set_input_value(t,e[4]),e[9]?s?(s.p(e,n),512&n[0]&&transition_in(s,1)):(s=create_if_block_11(e),s.c(),transition_in(s,1),s.m(r.parentNode,r)):s&&(group_outros(),transition_out(s,1,1,(()=>{s=null})),check_outros())},i(e){o||(transition_in(s),o=!0)},o(e){transition_out(s),o=!1},d(e){e&&detach(t),e&&detach(n),s&&s.d(e),e&&detach(r),a=!1,run_all(i)}}}function create_if_block_11(e){let t,n,r,o,a;return n=new Close({props:{size:"1.6rem"}}),{c(){t=element("span"),create_component(n.$$.fragment),attr(t,"role","button"),attr(t,"class","button-like"),attr(t,"aria-label","Close search")},m(i,s){insert(i,t,s),mount_component(n,t,null),r=!0,o||(a=listen(t,"click",e[23]),o=!0)},p:noop,i(e){r||(transition_in(n.$$.fragment,e),r=!0)},o(e){transition_out(n.$$.fragment,e),r=!1},d(e){e&&detach(t),destroy_component(n),o=!1,a()}}}function create_if_block_9(e){let t,n,r,o,a,i,s,l;return n=new LibraryShelves({props:{size:"1.5rem"}}),a=new Magnify({props:{size:"1.5rem"}}),{c(){t=element("span"),create_component(n.$$.fragment),r=space(),o=element("span"),create_component(a.$$.fragment),attr(t,"role","button"),attr(t,"class","button-like"),attr(t,"aria-label","Open collection list"),attr(o,"role","button"),attr(o,"class","button-like"),attr(o,"aria-label","Open search")},m(c,u){insert(c,t,u),mount_component(n,t,null),insert(c,r,u),insert(c,o,u),mount_component(a,o,null),i=!0,s||(l=[listen(t,"click",e[21]),listen(o,"click",e[22])],s=!0)},p:noop,i(e){i||(transition_in(n.$$.fragment,e),transition_in(a.$$.fragment,e),i=!0)},o(e){transition_out(n.$$.fragment,e),transition_out(a.$$.fragment,e),i=!1},d(e){e&&detach(t),destroy_component(n),e&&detach(r),e&&detach(o),destroy_component(a),s=!1,run_all(l)}}}function create_if_block_6(e){let t,n,r,o,a,i=e[17]>0&&create_if_block_8(e);const s=[create_if_block_7,create_else_block_2],l=[];function c(e,t){return e[12]>0?0:1}return n=c(e),r=l[n]=s[n](e),{c(){i&&i.c(),t=space(),r.c(),o=empty()},m(e,r){i&&i.m(e,r),insert(e,t,r),l[n].m(e,r),insert(e,o,r),a=!0},p(e,a){e[17]>0?i?(i.p(e,a),131072&a[0]&&transition_in(i,1)):(i=create_if_block_8(e),i.c(),transition_in(i,1),i.m(t.parentNode,t)):i&&(group_outros(),transition_out(i,1,1,(()=>{i=null})),check_outros());let u=n;n=c(e),n===u?l[n].p(e,a):(group_outros(),transition_out(l[u],1,1,(()=>{l[u]=null})),check_outros(),r=l[n],r?r.p(e,a):(r=l[n]=s[n](e),r.c()),transition_in(r,1),r.m(o.parentNode,o))},i(e){a||(transition_in(i),transition_in(r),a=!0)},o(e){transition_out(i),transition_out(r),a=!1},d(e){i&&i.d(e),e&&detach(t),l[n].d(e),e&&detach(o)}}}function create_if_block_8(e){let t,n,r,o,a,i,s,l;return n=new DownloadMultiple({props:{size:"1.5rem"}}),{c(){t=element("span"),create_component(n.$$.fragment),r=space(),o=element("span"),a=text(e[17]),attr(o,"class","svelte-1xtgt2h"),attr(t,"role","button"),attr(t,"aria-label","Pending downloads"),attr(t,"class","with-text button-like svelte-1xtgt2h")},m(c,u){insert(c,t,u),mount_component(n,t,null),append(t,r),append(t,o),append(o,a),i=!0,s||(l=listen(t,"click",e[24]),s=!0)},p(e,t){(!i||131072&t[0])&&set_data(a,e[17])},i(e){i||(transition_in(n.$$.fragment,e),i=!0)},o(e){transition_out(n.$$.fragment,e),i=!1},d(e){e&&detach(t),destroy_component(n),s=!1,l()}}}function create_else_block_2(e){let t,n,r,o,a;return n=new AlarmSnooze({props:{size:"1.5rem"}}),{c(){t=element("span"),create_component(n.$$.fragment),attr(t,"role","button"),attr(t,"class","button-like"),attr(t,"aria-label","Start sleep timer")},m(i,s){insert(i,t,s),mount_component(n,t,null),r=!0,o||(a=listen(t,"click",e[26]),o=!0)},p:noop,i(e){r||(transition_in(n.$$.fragment,e),r=!0)},o(e){transition_out(n.$$.fragment,e),r=!1},d(e){e&&detach(t),destroy_component(n),o=!1,a()}}}function create_if_block_7(e){let t,n,r,o,a,i,s,l;return n=new AlarmOff({props:{size:"1.5rem"}}),{c(){t=element("span"),create_component(n.$$.fragment),r=space(),o=element("span"),a=text(e[12]),attr(o,"class","svelte-1xtgt2h"),attr(t,"role","button"),attr(t,"aria-label","Stop sleep timer"),attr(t,"class","with-text button-like svelte-1xtgt2h")},m(c,u){insert(c,t,u),mount_component(n,t,null),append(t,r),append(t,o),append(o,a),i=!0,s||(l=listen(t,"click",e[27]),s=!0)},p(e,t){(!i||4096&t[0])&&set_data(a,e[12])},i(e){i||(transition_in(n.$$.fragment,e),i=!0)},o(e){transition_out(n.$$.fragment,e),i=!1},d(e){e&&detach(t),destroy_component(n),s=!1,l()}}}function create_else_block_1(e){let t,n,r,o,a;t=new Breadcrumb({});let i={container:e[2],infoOpen:!e[9]};return o=new Browser({props:i}),e[33](o),{c(){create_component(t.$$.fragment),n=space(),r=element("div"),create_component(o.$$.fragment),attr(r,"class","browser svelte-1xtgt2h")},m(i,s){mount_component(t,i,s),insert(i,n,s),insert(i,r,s),mount_component(o,r,null),e[34](r),a=!0},p(e,t){const n={};4&t[0]&&(n.container=e[2]),512&t[0]&&(n.infoOpen=!e[9]),o.$set(n)},i(e){a||(transition_in(t.$$.fragment,e),transition_in(o.$$.fragment,e),a=!0)},o(e){transition_out(t.$$.fragment,e),transition_out(o.$$.fragment,e),a=!1},d(a){destroy_component(t,a),a&&detach(n),a&&detach(r),e[33](null),destroy_component(o),e[34](null)}}}function create_if_block_5(e){let t,n,r;return n=new Recent({}),n.$on("close",e[32]),{c(){t=element("div"),create_component(n.$$.fragment),attr(t,"class","browser svelte-1xtgt2h")},m(e,o){insert(e,t,o),mount_component(n,t,null),r=!0},p:noop,i(e){r||(transition_in(n.$$.fragment,e),r=!0)},o(e){transition_out(n.$$.fragment,e),r=!1},d(e){e&&detach(t),destroy_component(n)}}}function create_if_block_4(e){let t,n,r;return n=new ConfigEditor({}),n.$on("finished",e[31]),{c(){t=element("div"),create_component(n.$$.fragment),attr(t,"class","browser svelte-1xtgt2h")},m(e,o){insert(e,t,o),mount_component(n,t,null),r=!0},p:noop,i(e){r||(transition_in(n.$$.fragment,e),r=!0)},o(e){transition_out(n.$$.fragment,e),r=!1},d(e){e&&detach(t),destroy_component(n)}}}function create_if_block_3(e){let t,n,r;return n=new Player({props:{}}),e[35](n),n.$on("navigate",e[36]),{c(){t=element("div"),create_component(n.$$.fragment),attr(t,"class","player svelte-1xtgt2h"),attr(t,"role","region"),attr(t,"aria-label","Player")},m(e,o){insert(e,t,o),mount_component(n,t,null),r=!0},p(e,t){n.$set({})},i(e){r||(transition_in(n.$$.fragment,e),r=!0)},o(e){transition_out(n.$$.fragment,e),r=!1},d(r){r&&detach(t),e[35](null),destroy_component(n)}}}function create_header_slot_1(e){let t;return{c(){t=text("Cancel All Running Loads?")},m(e,n){insert(e,t,n)},d(e){e&&detach(t)}}}function create_body_slot_1(e){let t;return{c(){t=text("Do you want to cancel all currently running loads of audio files?")},m(e,n){insert(e,t,n)},d(e){e&&detach(t)}}}function create_header_slot(e){let t;return{c(){t=text("Audioserve Web Client")},m(e,n){insert(e,t,n)},d(e){e&&detach(t)}}}function create_if_block(e){let t;return{c(){t=element("p"),t.textContent="Cache via service worker is not available",attr(t,"class","red svelte-1xtgt2h")},m(e,n){insert(e,t,n)},d(e){e&&detach(t)}}}function create_body_slot(e){let t,n,r,o,a,i,s,l,c=e[16]?.version+"",u=!e[0]&&create_if_block();return{c(){t=element("p"),t.innerHTML='New PWA client built with Svelte and TypeScript<br/> \n      <a href="https://github.com/izderadicka/audioserve-web">Check it&#39;s site</a>',n=space(),u&&u.c(),r=space(),o=element("p"),o.textContent=`Version: ${APP_VERSION}(${APP_COMMIT})`,a=space(),i=element("p"),s=text("Server Version: "),l=text(c)},m(e,c){insert(e,t,c),insert(e,n,c),u&&u.m(e,c),insert(e,r,c),insert(e,o,c),insert(e,a,c),insert(e,i,c),append(i,s),append(i,l)},p(e,t){e[0]?u&&(u.d(1),u=null):u||(u=create_if_block(),u.c(),u.m(r.parentNode,r)),65536&t[0]&&c!==(c=e[16]?.version+"")&&set_data(l,c)},d(e){e&&detach(t),e&&detach(n),u&&u.d(e),e&&detach(r),e&&detach(o),e&&detach(a),e&&detach(i)}}}function create_fragment(e){let t,n,r,o,a,i,s,l;const c=[create_if_block_1,create_if_block_2,create_else_block],u=[];function d(e,t){return e[5]?0:e[15]?2:1}n=d(e),r=u[n]=c[n](e);let p={id:DOWNLOAD_DIALOG_ID,confirmAction:e[25],$$slots:{body:[create_body_slot_1],header:[create_header_slot_1]},$$scope:{ctx:e}};return a=new ConfirmDialog({props:p}),e[37](a),s=new ConfirmDialog({props:{id:ABOUT_DIALOG_ID,noConfirm:!0,$$slots:{body:[create_body_slot],header:[create_header_slot]},$$scope:{ctx:e}}}),e[38](s),{c(){t=element("main"),r.c(),o=space(),create_component(a.$$.fragment),i=space(),create_component(s.$$.fragment),attr(t,"class","svelte-1xtgt2h")},m(e,r){insert(e,t,r),u[n].m(t,null),insert(e,o,r),mount_component(a,e,r),insert(e,i,r),mount_component(s,e,r),l=!0},p(e,o){let i=n;n=d(e),n===i?u[n].p(e,o):(group_outros(),transition_out(u[i],1,1,(()=>{u[i]=null})),check_outros(),r=u[n],r?r.p(e,o):(r=u[n]=c[n](e),r.c()),transition_in(r,1),r.m(t,null));const l={};2097152&o[1]&&(l.$$scope={dirty:o,ctx:e}),a.$set(l);const p={};65537&o[0]|2097152&o[1]&&(p.$$scope={dirty:o,ctx:e}),s.$set(p)},i(e){l||(transition_in(r),transition_in(a.$$.fragment,e),transition_in(s.$$.fragment,e),l=!0)},o(e){transition_out(r),transition_out(a.$$.fragment,e),transition_out(s.$$.fragment,e),l=!1},d(r){r&&detach(t),u[n].d(),r&&detach(o),e[37](null),destroy_component(a,r),r&&detach(i),e[38](null),destroy_component(s,r)}}}const DOWNLOAD_DIALOG_ID="cancel-prefetch-dialog",ABOUT_DIALOG_ID="about-dialog";function instance(e,t,n){let r,o,a,i,s,l,c,u;component_subscribe(e,config,(e=>n(41,r=e))),component_subscribe(e,selectedCollection,(e=>n(1,o=e))),component_subscribe(e,isAuthenticated,(e=>n(15,a=e))),component_subscribe(e,currentFolder,(e=>n(42,i=e))),component_subscribe(e,collections,(e=>n(16,s=e))),component_subscribe(e,colApi,(e=>n(43,l=e))),component_subscribe(e,pendingDownloads,(e=>n(17,c=e))),component_subscribe(e,playItem,(e=>n(18,u=e)));let{cache:d}=t;d&&(d.maxParallelLoads=r.maxParallelDownload,d.onQueueSizeChanged((e=>pendingDownloads.set(e))),setContext("cache",d));let{initialHash:p}=t,{webSocket:h=new WebSocket(baseWsUrl(!0,3e3)+"/ws")}=t;if(h.addEventListener("open",(()=>{console.log("/ws WebSocket opened");let e=formatWSMessage(WSMessageOutType.RegisterDevice,{name:deviceName()});h.send(JSON.stringify(e))})),h.addEventListener("error",(e=>{console.error("/ws Web socket error",e)})),h.addEventListener("close",(e=>{n(28,h=null),console.debug("/ws Web socket close",e)})),setContext("webSocket",h),p){const e=parseHistoryFragment(p);e&&(set_store_value(selectedCollection,o=e.collection,o),set_store_value(currentFolder,i={type:e.folderType,value:e.value},i))}setContext("history",new HistoryWrapper((()=>{n(14,L="browser")})));const m=localStorage.getItem(StorageKeys.THEME);m&&document.querySelector("html").setAttribute("data-theme",m);const _=baseUrl(isDevelopment);let f,g,b;async function w(){const e=await l.collectionsGet();console.debug("Got collections list",e),set_store_value(collections,s=e,s);let t=parseInt(localStorage.getItem(StorageKeys.LAST_COLLECTION)||"0");t>=e.names.length&&(t=0),set_store_value(selectedCollection,o=t,o)}apiConfig.set(new Configuration({basePath:_,credentials:"include"}));let v=null;onMount((async()=>{try{await w()}catch(e){console.error("Error loading initial lists",e),e instanceof Response?401===e.status?(set_store_value(isAuthenticated,a=!1,a),isAuthenticated.subscribe((async e=>{if(e)try{await w()}catch(e){n(5,v="Fail to load collections after authentication, one reason can be insecure context and API on different origin")}}))):n(5,v=`Unexpected respose from server: ${e.status} ${e.statusText}`):n(5,v=`Cannot contact server: ${e}`)}}));let y,k,$=!0,x=!0,S=!0,C=!1;windowSize.subscribe((e=>{e.width<=770?(C||(n(6,$=!1),n(7,x=!1),n(8,S=!0)),n(9,C=!0)):(n(6,$=!0),n(7,x=!0),n(9,C=!1),n(8,S=!0))}));let A,P,E=0,T=null;const R=()=>{T&&(T.finish(),T=null)};let L="browser";selectedCollection.subscribe((e=>{n(14,L="browser")})),currentFolder.subscribe((e=>{n(14,L="browser")}));return e.$$set=e=>{"cache"in e&&n(0,d=e.cache),"initialHash"in e&&n(29,p=e.initialHash),"webSocket"in e&&n(28,h=e.webSocket)},e.$$.update=()=>{2&e.$$.dirty[0]&&console.debug("Selected collection is "+o)},[d,o,f,g,b,v,$,x,S,C,y,k,E,P,L,a,s,c,u,function(e){const t=e.detail;switch(console.debug("Menu selected",t),t){case"logout":set_store_value(isAuthenticated,a=!1,a),deleteCookie();break;case"switch-theme":const e=otherTheme();document.querySelector("html").setAttribute("data-theme",e),localStorage.setItem(StorageKeys.THEME,e);break;case"clear-cache":Promise.all([null==d?void 0:d.clearCache().then((()=>{d.cancelPendingLoads("",!0)})),null===window||void 0===window?void 0:window.caches.delete(API_CACHE_NAME)]).then((()=>window.location.reload())).catch((e=>console.warn("Error clearing cache "+e)));break;case"show-preferences":n(14,L="config");break;case"about":k.toggleModal();break;case"recent":n(14,L="recent");break;case"download":n(14,L="browser"),function(){if(!d||!g)return;const e=[],t=g.getFiles();for(let n=0;n<t.length;n++){const r=t[n];if(!r.cached){const t=new PlayItem({file:r,collection:o,position:n});e.push({url:t.url,folderPosition:t.position,lowPriority:!0})}}d&&e.length>0&&(console.log(`Try to cache ${e.length} files`),d.cacheAhead(e))}()}},function(e){"Enter"===e.key&&b.length>0&&set_store_value(currentFolder,i={value:b,type:FolderType.SEARCH},i)},function(){x?(n(7,x=!1),n(6,$=!1),n(8,S=!0)):(n(7,x=!0),n(6,$=!1),n(8,S=!1))},function(){$?(n(6,$=!1),n(7,x=!1),n(8,S=!0)):(n(6,$=!0),n(7,x=!1),n(8,S=!1))},function(){n(6,$=!1),n(7,x=!1),n(8,S=!0)},function(e){y.toggleModal(e)},function(){console.debug("Cancel all prefetch loads"),d.cancelPendingLoads("",!0,!0)},async function(){const e=createAudioContext(),t=await loadAudioFile("static/will_sleep_soon.mp3",e),o=await loadAudioFile("static/extended.mp3",e);n(12,E=r.sleepTimerPeriod),A=window.setInterval((()=>{n(12,E-=1),1===E?(playBuffer(t,e),T=new ShakeDetector((t=>{n(12,E+=r.sleepTimerExtend),playBuffer(o,e),R()}))):0===E&&(null==P||P.pause(),window.clearInterval(A),R())}),6e4)},function(){window.clearInterval(A),R(),n(12,E=0)},h,p,function(){b=this.value,n(4,b)},()=>{n(14,L="browser")},()=>n(14,L="browser"),function(e){binding_callbacks[e?"unshift":"push"]((()=>{g=e,n(3,g)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{f=e,n(2,f)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{P=e,n(13,P)}))},e=>g?.navigate(e.detail),function(e){binding_callbacks[e?"unshift":"push"]((()=>{y=e,n(10,y)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{k=e,n(11,k)}))}]}class App extends SvelteComponent{constructor(e){super(),init(this,e,instance,create_fragment,safe_not_equal,{cache:0,initialHash:29,webSocket:28},null,[-1,-1])}}const AUDIO_CACHE_NAME="audio";var CacheMessageKind;!function(e){e[e.Prefetch=1]="Prefetch",e[e.AbortLoads=2]="AbortLoads",e[e.PrefetchCached=10]="PrefetchCached",e[e.ActualCached=11]="ActualCached",e[e.Skipped=12]="Skipped",e[e.Deleted=20]="Deleted",e[e.PrefetchError=30]="PrefetchError",e[e.ActualError=31]="ActualError",e[e.OtherError=39]="OtherError",e[e.Ping=40]="Ping",e[e.Pong=41]="Pong"}(CacheMessageKind||(CacheMessageKind={}));const MAX_QUEUE_SIZE=4096;class QueueItem{constructor(e,t,n){this.url=e,this.lowPriority=t,this.folderPosition=n}}class CacheStorageCache{constructor(e,t,n){this.prefix=t,this.queue=[],this.processing=[],this.listeners=[],this.poller=null,this.emptyPongs=0,this.maxParallelLoads=1,this.maxParallelLoads=n||1,this.updateWorker(e),navigator.serviceWorker.addEventListener("message",(e=>this.processMessageEvent(e)))}startPoller(){null==this.poller&&(this.emptyPongs=0,this.poller=setInterval((()=>{this.worker.postMessage({kind:CacheMessageKind.Ping,data:{}})}),1e4))}stopPoller(){null!=this.poller&&(clearInterval(this.poller),this.emptyPongs=0),this.poller=null}ensureStarted(){this.startPoller()}updateWorker(e){this.worker=e}processMessageEvent(e){const t=e.data;if(t.kind===CacheMessageKind.PrefetchCached||t.kind===CacheMessageKind.ActualCached){this.notifyListeners(EventType.FileCached,t.data);const e=this.queue.length;this.queue=this.queue.filter((e=>!e.url.startsWith(t.data.cachedUrl))),e!==this.queue.length&&this.updateQueueChanged()}else if(t.kind===CacheMessageKind.Deleted)this.notifyListeners(EventType.FileDeleted,t.data);else if(t.kind===CacheMessageKind.Skipped)console.debug(`Prefetch of  ${t.data.originalUrl} skipped as is already being loaded`);else if(t.kind===CacheMessageKind.Pong)if(console.debug("Got PONG from worker: "+JSON.stringify(t.data)),0===t.data.pendingAudio.length)this.processing.length>0&&(console.warn(`${this.processing.length} prefetches were not finished, probably service worker was restarted`,this.processing),this.processing=[],this.updateQueueChanged(),this.processQueue()),this.emptyPongs++,this.emptyPongs>=3&&this.stopPoller();else{this.emptyPongs=0;const e=[];for(let n=0;n<this.processing.length;n++){const r=removeQuery(this.processing[n].url);t.data.pendingAudio.indexOf(r)<0&&(console.warn(`Prefetch of ${r} was not finished in service worker`),e.push(n))}if(e.length>0){for(const t of e)this.processing.splice(t,1);this.updateQueueChanged(),this.processQueue()}}else t.kind===CacheMessageKind.PrefetchError?t.data.error&&"AbortError"===t.data.error.name?console.debug(`Prefetch of ${t.data.originalUrl} was aborted`):console.error("Prefetch error",t.data):console.error("Cache message from service worker error",t);if(t.kind===CacheMessageKind.PrefetchCached||t.kind===CacheMessageKind.PrefetchError||t.kind===CacheMessageKind.Skipped){const e=t.data.originalUrl;this.processing=this.processing.filter((t=>t.url!==e)),this.updateQueueChanged(),this.processQueue()}}prefixPath(e){return this.prefix?this.prefix+e:e}getCachedUrl(e){return caches.open(AUDIO_CACHE_NAME).then((t=>{const n=removeQuery(e);return t.match(n).then((e=>e?{cachedUrl:n,originalUrl:e.url}:null))}))}getCachedPaths(e,t){const n=e.toString().length;return caches.open(AUDIO_CACHE_NAME).then((e=>e.keys())).then((r=>r.map((e=>{const t=new URL(e.url);return decodeURI(t.pathname)})).filter((n=>{const r=this.prefixPath(`/${e}/audio/${t}`),{folder:o}=splitPath(n);return r===o})).map((e=>e.substring((this.prefix.length||0)+n+8)))))}cacheAhead(e,t){var n;if(this.queue.length>MAX_QUEUE_SIZE)return void console.error("Prefecth queue is at max size, cannot add items");const r=this.queue.filter((e=>!0===e.lowPriority)),o=[],a=new Set;for(const i of e){let e,s,l;if("string"==typeof i?(e=i,s=!1):(e=i.url,s=null!==(n=i.lowPriority)&&void 0!==n&&n,l=i.folderPosition),this.processing.find((t=>t.url===e))?console.debug(`Url ${e} is already being prefetched`):(s?r:o).push(new QueueItem(e,s,l)),!s){const n=splitPath(new URL(e).pathname).folder;this.processing.forEach((e=>{const r=splitPath(new URL(e.url).pathname).folder;r!==n?a.add(r):t.folderPosition&&t.folderPosition>e.folderPosition&&a.add(new URL(e.url).pathname)}))}}this.queue=o.concat(r),this.updateQueueChanged(),this.processing.length<this.maxParallelLoads&&this.processQueue(),a.forEach((e=>{this.cancelRunning(e,!0)}))}processQueue(){const e=this.queue.shift();e&&(this.worker.postMessage({kind:CacheMessageKind.Prefetch,data:{url:e.url,folderPosition:e.folderPosition}}),this.processing.push(e),this.startPoller())}cancelPendingLoads(e,t,n){this.queue=e?this.queue.filter((t=>!new URL(t.url).pathname.startsWith(this.prefixPath(e)))):[],this.updateQueueChanged(),t&&this.cancelRunning(e,n)}cancelRunning(e,t){this.worker.postMessage({kind:CacheMessageKind.AbortLoads,data:{pathPrefix:this.prefixPath(e),keepDirect:t}})}addListener(e){this.listeners.push(e)}removeListener(e){const t=this.listeners.findIndex((t=>t===e));t>=0&&this.listeners.splice(t,1)}updateQueueChanged(){this.queueChangedCB&&this.queueChangedCB(this.processing.length+this.queue.length)}onQueueSizeChanged(e){this.queueChangedCB=e}notifyListeners(e,t){this.listeners.forEach((n=>n({kind:e,item:t})))}clearCache(){return caches.delete(AUDIO_CACHE_NAME).then((()=>{}))}}let app;function createApp(e){app=new App({target:document.body,props:{cache:e,initialHash:window.location.hash}})}console.log(`Running app version ${APP_VERSION}(${APP_COMMIT}) in env ${ENVIRONMENT}`);var app$1=app;function reportWorkerStatus(){var e;(null===(e=navigator.serviceWorker)||void 0===e?void 0:e.controller)?console.debug("Service worker state changed to "+navigator.serviceWorker.controller.state):console.error("Service worker is not available")}return"serviceWorker"in navigator?(navigator.serviceWorker.register("./service-worker.js",{scope:"./",type:"module"}).catch((e=>{console.error("Service worker registration failed with "+e,e),createApp(null)})),navigator.serviceWorker.ready.then((e=>{const t=e.active;if(console.debug("Service Worker registration succeeded. Scope is "+e.scope,t),t){t.onstatechange=reportWorkerStatus;const e=new CacheStorageCache(t,getLocationPath());navigator.serviceWorker.oncontrollerchange=()=>{navigator.serviceWorker.controller?(console.debug(`Service worker changed, state is ${navigator.serviceWorker.controller.state}`),navigator.serviceWorker.controller.onstatechange=reportWorkerStatus,e.updateWorker(navigator.serviceWorker.controller)):console.error("No active Service Worker")},createApp(e)}else console.error("Service worker controller is not ready!!!")}))):(console.error("Service worker is not available - will start with no caching"),createApp(null)),"storage"in navigator&&navigator.storage.estimate().then((e=>console.debug("Available storage:",e))),app$1}();
